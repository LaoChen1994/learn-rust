# Rustå­¦ä¹ ç¬”è®°

## 0. å†™åœ¨å‰é¢

### 0.1 ç›¸å…³èµ„æ–™

1. [Rust Programing Language](https://doc.rust-lang.org/book/title-page.html)
2. [æºç åœ°å€](https://github.com/LaoChen1994/learn-rust)https://doc.rust-lang.org/book/title-page.html)

### 0.2 æœ¬ç« å¤§çº²

1. Rustç¯å¢ƒçš„å®‰è£…
2. ç¬¬ä¸€ä¸ªhello Rustç¨‹åº
3. cargoçš„ç®€å•ä½¿ç”¨ï¼ˆåŒ…çš„åˆ›å»ºï¼Œæ‰“åŒ…ï¼Œè¿è¡Œï¼Œæ£€æµ‹æ›´æ–°ï¼‰
4. tomlæ–‡ä»¶ä¸€äº›é…ç½®é¡¹çš„ä½¿ç”¨

## 1. ç¯å¢ƒå®‰è£…

### 1.1 windowså®‰è£…

+ æ­¥éª¤ï¼š 
  
  + C++ç¯å¢ƒå®‰è£…ï¼šæ ¹æ®æ–‡æ¡£ä¸­ï¼Œwindowså¯ä»¥å…ˆè¿›å…¥[visual-cpp-build-tools](https://visualstudio.microsoft.com/zh-hans/visual-cpp-build-tools/)ä¸‹è½½å¯¹åº”çš„å·¥å…·ï¼Œå®‰è£…å®Œæˆåï¼Œé‡å¯ç”µè„‘å³å¯
  + Rustå®‰è£…ï¼š[Rustä¸‹è½½](https://forge.rust-lang.org/infra/other-installation-methods.html)é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬ä¸‹è½½å³å¯
  + æµ‹è¯•ï¼šä½¿ç”¨`rustc --version`èƒ½çœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·å°±æ˜¯å®‰è£…æˆåŠŸå•¦

### 1.2 MacOSå®‰è£…è¿‡ç¨‹

+ æ­¥éª¤ï¼š
  
  + è¿è¡Œå®‰è£…å‘½ä»¤
    
    ```bash
      # è¿è¡Œå‘½ä»¤
      curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
    ```
  
  + æŸ¥çœ‹æç¤ºï¼ŒæˆåŠŸå®‰è£…åï¼Œå‘½ä»¤è¡Œä¼šæç¤º **Rust is installed now. Great!**

## 2. Hello Rust

### 2.1 ç¬¬ä¸€ä¸ªRustä»£ç 

```rust
fn main() {
    println!("hello Rust");
}
```

+ å…³é”®åˆ†æ
  + ç¬¬ä¸€è¡Œçš„fnç”¨äºå£°æ˜ä¸€ä¸ªå‡½æ•°
  + mainå‡½æ•°åœ¨rustå‡½æ•°ä¸­æ˜¯ä½œä¸ºç¬¬ä¸€è¡Œä»£ç æ‰§è¡Œçš„
  + printlnåé¢çš„`!`ï¼Œè¿™æ˜¯macroçš„å®ï¼Œå¦‚æœåŠ äº†`!`ä»£è¡¨ä½ è°ƒç”¨çš„æ˜¯Rustçš„å®è€Œä¸æ˜¯æ™®é€šå‡½æ•°
  + `;`ä»£è¡¨è¯¥è¡Œè¯­å¥ç»“æŸ

### 2.2 ç¼–è¯‘rust

```bash
rustc ./helloRust.ts
```

**ç»“æœ**: ç¼–è¯‘ä¹‹åæˆ‘ä»¬ä¼šæ‹¿åˆ°ä¸¤ä¸ªæ–‡ä»¶`helloRust.exe`å’Œ`helloRust.pdb`

å…¶ä¸­è¿™ä¸ª`exe`æ–‡ä»¶å°±æ˜¯åœ¨windowsä¸Šç›´æ¥å¯ä»¥æ‰§è¡Œçš„æ–‡ä»¶

### 2.3 å’ŒåŠ¨æ€è¯­è¨€çš„åŒºåˆ«

åŠ¨æ€è¯­è¨€ï¼šjsï¼Œpythonï¼Œrubyç­‰éœ€è¦æˆ‘ä»¬åœ¨è¿è¡Œçš„å¹³å°å®‰è£…å¯¹åº”çš„è§£é‡Šå™¨ï¼Œé€šè¿‡è§£é‡Šå™¨å°†ä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç ï¼Œé€šè¿‡å­—èŠ‚ç è§£é‡Šå™¨æ¥è¯»å–å¹¶æ‰§è¡Œå­—èŠ‚ç 

ç¼–è¯‘å‹è¯­è¨€ï¼šå°†ä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹³å°ä¸Šå¯ä»¥ä¸å®‰è£…ä»»ä½•è§£é‡Šå™¨

## 3. Hello Cargo

### 3.1 cargoæ˜¯ä»€ä¹ˆ

1. cargoæ˜¯ä¸€ä¸ªæ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å·¥å…·

2. ç”¨æ¥ç®¡ç†rustå·¥ç¨‹å’Œå¤„ç†è®¸å¤šä»»åŠ¡ï¼ˆæ„å»ºä»£ç ã€ä¸‹è½½åŒ…ï¼‰

3. cargoåœ¨å®‰è£…rustçš„ç¯å¢ƒæ—¶ï¼Œä¼šè‡ªåŠ¨å®‰è£…ï¼Œæ‰€ä»¥è¿™é‡Œçš„è¯ï¼Œç›´æ¥è°ƒç”¨
   
   ```bash
    # å¯ä»¥ç›´æ¥çœ‹åˆ°å¯¹åº”çš„cargoç‰ˆæœ¬
    cargo --version
   ```
   
   > ç±»ä¼¼nodejsä¸­çš„npmï¼Œé€šè¿‡scripsæ¥å¸®æˆ‘ä»¬æ‰§è¡Œç›¸åº”è„šæœ¬ï¼Œé€šè¿‡installæ¥å®‰è£…åŒ…

### 3.2 cargoå·¥ç¨‹çš„åˆ›å»º

#### 3.2.1 åˆ›å»º

ä½¿ç”¨`cargo new [projectName]`æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ç¨‹

```bash
cargo new hello_cargo
```

![](./images/02-hello-rust.png)

#### 3.2.2 ç›®å½•è§£æ

åˆ›å»ºçš„ç›®å½•åŒ…æ‹¬ï¼š

+ cargo.tomlï¼šç”¨äºå®šä¹‰åŒ…å’Œä¿¡æ¯`[package]`å’Œä¾èµ–`[dependencies]`ï¼Œå…¶ä»–è¿˜æœ‰åˆ«çš„é…ç½®å¦‚ä¸‹ï¼š
  
  ![](.\images\03-hello-cargo-toml.png)

+ æºæ–‡ä»¶ç›®å‰æ˜¯æ”¾åœ¨srcçš„ç›®å½•ä¸‹çš„

#### 3.2.3 tomlæ–‡ä»¶ä¸­éœ€è¦æ³¨æ„çš„ç‚¹

`[package]`ä¸‹é¢çš„ä¸€äº›é…ç½®:

+ buildï¼šç”¨äºæŒ‡å®šbuildæ¥æŒ‡å®šè¿™ä¸ªåŒ…ç”¨æºç çš„æ–¹å¼ç¼–è¯‘
  
  > æ¯”å¦‚åœ¨rustä¸­å¼•ç”¨äº†æ¯”å¦‚Cçš„åº“ï¼Œè¿™äº›ä¸œè¥¿ç¼–è¯‘å°±æ”¾åœ¨ä¸€ä¸ªbuild.rsä¸­ï¼Œä¼šé€šè¿‡æºç çš„æ–¹å¼è¿›è¡Œç¼–è¯‘

+ includeå’Œexcludeï¼šç”¨æ¥æŒ‡å®šé‚£äº›åŒ…éœ€è¦è¢«æ‰“åŒ…æˆ–å‘å¸ƒï¼Œå¯ä»¥é€šè¿‡`carge package --list`æ¥æŸ¥çœ‹

+ publish: ç”¨æ¥æŒ‡å®šåŒ…æ˜¯å¦å‘å¸ƒåˆ°åŒ…ä»“åº“ï¼Œ==ä¿æŠ¤åŒ…çš„ç§æœ‰æ€§==

### 3.3 ä½¿ç”¨cargoæ„å»ºå’Œè·‘rustå·¥ç¨‹

#### 3.3.1 æ„å»ºrustå·¥ç¨‹

```bash
cargo build
```

#### 3.3.2 è¿è¡Œcargoå·¥ç¨‹

æ„å»ºæˆåŠŸä¹‹åçš„æ–‡ä»¶éƒ½åœ¨==target/debug/hello_cargo==ä¸‹ï¼Œç›´æ¥è¿è¡Œç›®å½•ä¸‹çš„`exe`æ–‡ä»¶ä¹Ÿå¯ä»¥è¿è¡Œ

```bash
.\target\debug\hello_cargo.exe
```

ä¹Ÿå¯ä»¥é€šè¿‡cargoæ¥è¿è¡Œå¯¹åº”çš„exeæ‰“åŒ…æ–‡ä»¶

```bash
cargo run
```

åœ¨æ‰§è¡Œcargo runçš„æ—¶å€™æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„ç‚¹ï¼š

1. æºæ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œç›´æ¥æ‰§è¡Œcargo buildå‡ºæ¥çš„æ–‡ä»¶

2. å¦‚æœæºæ–‡ä»¶äº§ç”Ÿäº†å˜åŒ–ï¼Œä¼šå…ˆç¼–è¯‘ï¼Œç„¶åå†æ‰§è¡Œ
   
   ![](.\images\03-cargo-build.png)

3. è¿™é‡Œå¯ä»¥é€šè¿‡`cargo check`æ¥æ£€éªŒå½“å‰ç‰ˆæœ¬çš„ç¼–è¯‘åçš„ä»£ç ï¼Œæ˜¯å¦è¿˜æœ‰æ›´æ–°ä¸ºç¼–è¯‘çš„ç‰ˆæœ¬

#### 3.3.3 æ„å»ºå‘å¸ƒç‰ˆæœ¬

é€šè¿‡`--release`æ¥æŒ‡å®šæ„å»ºçš„ç‰ˆæœ¬ä¸ºå‘å¸ƒç‰ˆæœ¬ï¼Œé€šè¿‡`release`æ¥å‘å¸ƒï¼Œä¼šåšå¾ˆå¤šä¼˜åŒ–ï¼Œä½¿rustä»£ç è¿è¡Œæ›´å¿«ï¼Œä½†ä¹Ÿä¼šè®©==æ„å»ºæ—¶é—´æ›´é•¿==ï¼Œå¦å¤–æ„å»ºå‘å¸ƒçš„æ—¶å€™ï¼Œè¿™ä¸ªåœ°æ–¹ç”Ÿæˆçš„æ–‡ä»¶æ˜¯åœ¨targetä¸‹çš„ã€‚

## 4. ä¸€ä¸ªçŸ³å¤´å‰ªåˆ€å¸ƒçš„æ¸¸æˆ

### å†™åœ¨å‰é¢

æˆ‘çœ‹åŸä¹¦é‡Œé¢æŠŠè¿™ä¸€å¼ æ”¾åœ¨å®‰è£…ä¹‹åï¼Œä½†æ˜¯æˆ‘è§‰å¾—æœ‰ç‚¹å›°éš¾äº†ï¼Œå› ä¸ºæœ¬ç« æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹åŒ…æ‹¬ï¼š

1. æ¨¡å—çš„å¼•å…¥ä¸å®‰è£…
2. æ ‡å‡†è¾“å…¥è¾“å‡ºçš„ä½¿ç”¨
3. å˜é‡å®šä¹‰
4. å˜é‡è½¬æ¢
5. æ¨¡å—ä¸­æ–¹æ³•çš„ä½¿ç”¨
6. traitã€modulesã€Structã€Functionæ¦‚å¿µ
7. å¾ªç¯çš„ä½¿ç”¨

**æˆ‘çš„æƒ³æ³•**å¯¹äºä¸€ä¸ªrustçš„å°ç™½æ¥è¯´ï¼Œå…¶å®æˆ‘å¯¹åŸºæœ¬çš„è¯­æ³•éƒ½ä¸å¤ªæ¸…æ¥šï¼Œçœ‹è¿™ä¸€ç« ç¡®å®åªèƒ½çœ‹ä¸ªçƒ­é—¹ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªå°ç™½è¿™ç« çš„ç¬”è®°è¿˜æ˜¯å…ˆæ‹¿ä¸Šæ¥ï¼Œå¾ˆå¤šéƒ½æ˜¯è‡ªå·±æ ¹æ®jsè¿ç§»è¿‡æ¥çš„ä¸€äº›ç†è§£ï¼Œå¯èƒ½å¹¶ä¸æ­£ç¡®ï¼ŒåæœŸå­¦å®Œç›¸åº”çš„çŸ¥è¯†åï¼Œåº”è¯¥ä¹Ÿä¼šåšç›¸åº”çš„è°ƒæ•´ã€‚

### 4.1 éœ€æ±‚åˆ†æ

+ è¿™é‡Œå…¶å®æƒ³åšçš„ä¸€ä»¶äº‹æ˜¯ï¼š
  + éšæœºäº§ç”Ÿä¸€ä¸ªæ•°å­—
  + è®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ•°å­—
  + æ¯”å¯¹ä¸¤ä¸ªæ•°å­—çš„ç»“æœ
  + æ ¹æ®å¯¹æ¯”ç»“æœè¾“å‡ºç›¸åº”çš„å¯¹æ¯”ç»“æœï¼Œä¸€ç›´å¾ªç¯ä¸Šè¿°`æ­¥éª¤äºŒ`å’Œ`æ­¥éª¤ä¸‰`ç›´åˆ°ç”¨æˆ·è¾“å…¥å’Œéšæœºæ•°ç›¸åŒ
  + çŒœä¸­æ•°å­—ï¼Œç»“æŸå¾ªç¯

æ—¢ç„¶çœ‹èµ·æ¥å¾ˆç®€å•çš„éœ€æ±‚ï¼Œé‚£ä¹ˆå°±æ¥codingæŠŠ

### 4.2 éšæœºç”Ÿæˆä¸€ä¸ªæ•°

#### 4.2.1 æ¨¡å—çš„å®‰è£…

å¯ä»¥é€šè¿‡å¼•å…¥`rand`æ¨¡å—çš„æ–¹å¼ï¼Œæ¥å®ç°éšæœºæ•°çš„åˆ›å»ºï¼Œç”±äºè¿™é‡Œrandæ˜¯ä¸ªç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å…ˆå®‰è£…ã€‚

**å®‰è£…æ­¥éª¤**ï¼š

1. åœ¨catgo.tomlçš„packagesä¾èµ–ä¸­ï¼Œå¢åŠ randæ¨¡å—ï¼Œç‰ˆæœ¬ä¸º0.8.3
2. ä½¿ç”¨cargo updateæ›´æ–°ä¸‹é•œåƒ
3. ä½¿ç”¨cargo runçš„æ—¶å€™æ¨¡å—ä¼šè¢«è‡ªåŠ¨å®‰è£…

**æ¢æºæ­¥éª¤**ï¼ˆ[å‚è€ƒæ–‡æ¡£](https://www.cnblogs.com/baby123/p/13260212.html)ï¼‰

1. åœ¨æ ¹ç›®å½•ä¸‹çš„.cargoåˆ›å»ºconfigæ–‡ä»¶
2. æ ¹æ®ä¸Šè¿°ç½‘å€ä¸­å¯¹åº”çš„å†…å®¹å¤åˆ¶è¿‡å»å°±è¡Œ
3. cargo updateä¸€ä¸‹

#### 4.2.2 ä»£ç ç¼–å†™

```rust
use rand::Rng;

fn main() {
    println!("Guess the number!");
    let secret_number_1 = rand::thread_rng().gen_range(1..10);
}
```

**FAQ**ï¼š

*Q1*: ä¸ºä»€ä¹ˆuse rand::Rngä¸å¯¼å…¥çš„æ—¶å€™ï¼Œè¿™ä¸ªgen_rangeå°±æŠ¥é”™ï¼Ÿ

*A1*: å› ä¸º`Rng`è¿™ä¸ª==trait==å®šä¹‰äº†éšæœºæ•°æ–¹æ³•çš„å®ç°ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªåœ°æ–¹ç°æœ‰äº†å®ç°çš„å¼•ç”¨ï¼Œç„¶åè¿™è¾¹è°ƒç”¨gen_rangeæ‰èƒ½è°ƒç”¨

*Q2*: `1..10`å†™æ³•çš„æ„æ€ï¼Ÿ

*A2*:è¿™é‡Œæœ‰ä¸¤ç§å†™æ³•`1..10`å’Œ`1..=10`ï¼Œå‰è€…æ˜¯`[1, 10)`è¿™ä¸ªåŒºé—´ï¼Œåè€…æ˜¯`[1, 10]`è¿™ä¸ªåŒºé—´

*Q3*:å¦‚ä½•å»çœ‹è¿™äº›å‡½æ•°æ€ä¹ˆè°ƒç”¨ï¼Ÿ

*A3*: å¯ä»¥é€šè¿‡`cargo doc --open`æ–¹æ³•æ¥æ‰“å¼€å¸®åŠ©æ–‡æ¡£æ ¹æ®æ–‡æ¡£ä½¿ç”¨å¯¹åº”çš„åŒ…

*Q4*ï¼šå¦‚ä½•è°ƒç”¨è¯¥å‡½æ•°æ–¹æ³•ï¼Ÿ

*A4*: ä½¿ç”¨`::`çš„è¯­æ³•

> è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨rand::tread_rng()ç”Ÿæˆäº†ä¸€ä¸ªåŒºé—´1~10é—´çš„æ•°å­—

### 4.3 è·å–ç”¨æˆ·è¾“å…¥

#### 4.3.1 ä»£ç ç¼–å†™

```rust
use rand::Rng;
// ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“stdä¸­çš„ioæ¨¡å—
// åœ¨jsé‡Œé¢ç›¸å½“äº import { io } from 'std' è¿™ä¸ªç±»æ¯”æ˜¯æˆ‘è‡ªå·±ç†è§£çš„ä¸ä¸€å®šæ­£ç¡®
use std::io;

fn main() {
    // çœç•¥
    println!("Please input your guess");

    let mut guess = String::new();
    io::stdin().read_line(&mut guess).expect("Fail to read line");
}
```

**FAQ**ï¼š

*Q1*: `mut`æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæœ‰mutå’Œæ²¡æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

*A1*: åœ¨rustä¸­æ‰€æœ‰å˜é‡é»˜è®¤æ˜¯immutableçš„ï¼Œæ‰€ä»¥ä½ åº”è¯¥æ‡‚äº†

â€‹        æœ‰mutå®šä¹‰ï¼šä»£è¡¨å‚æ•°æ˜¯mutableçš„

â€‹        æ— mutå®šä¹‰ï¼šä»£è¡¨å‚æ•°æ˜¯immutableçš„

*Q2*: å®ä¾‹å¦‚ä½•åˆ›å»ºï¼Ÿ

*A2*:  é€šè¿‡ç±»`::`æ–¹æ³•çš„æ–¹å¼ï¼Œè¡¨ç¤ºè°ƒç”¨äº†ç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨çš„æ˜¯ä¸€newçš„ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œnewæˆ‘ç†è§£æ˜¯rustä¸­ä¸€ä¸ªé€šç”¨çš„åç§°ï¼Œç”¨æ¥åˆ›å»ºæŸä¸ªç±»æ–°çš„å€¼

*Q3*ï¼šè¿™é‡Œçš„`&mut guess`æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

*A4*: åœ¨rustä¸­ï¼Œè¿™é‡Œé€šè¿‡`&`æ¥è¡¨æ˜æ‹¿çš„æ•°ï¼Œæ˜¯å¯¹åº”æ•°åœ¨å†…å­˜ä¸­çš„**å¼•ç”¨**ï¼Œ`å¯ä»¥ä¿è¯åœ¨ä»£ç ä¸­å¤šä¸ªåœ°æ–¹æ‹¿åŒä¸€ä¸ªå€¼ï¼Œä¸éœ€è¦æ‹·è´å¤šä»½`ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸å¤æ‚çš„ç‰¹æ€§ã€‚

*Q4*: `expect`æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„

*A3*: åœ¨rustä¸­ï¼Œå¾ˆå¤šæ–¹æ³•è¿”å›çš„ç±»å‹æ˜¯Resultï¼Œè¿™ä¸ªç±»å‹çš„æ„æ€æ˜¯ï¼Œå¦‚æœæˆåŠŸå°±è¿”å›ä¸€ä¸ªOkçš„æšä¸¾å€¼ï¼Œå¦‚æœå¤±è´¥å°±è¿”å›ä¸€ä¸ªErrorçš„æšä¸¾å€¼ï¼Œé‚£ä¹ˆè¿™é‡Œå¤±è´¥çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬expectä¼ å…¥äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¤±è´¥çš„msgå°±ä¼šæ˜¯æˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²ï¼Œå¯ç”¨æ¥å®šä½é”™è¯¯ä¿¡æ¯

*Q5*ï¼šResultä¸­çš„å‡ ç§å½¢å¼

*A5*ï¼š

ç±»å‹ä¸€ï¼šæ”¯æŒé€šè¿‡exceptæ–¹æ³•ï¼Œå½“æ‰§è¡Œç»“æœä¸ºæˆåŠŸçš„æ—¶å€™ï¼Œç›´æ¥è·³è¿‡ï¼Œé”™è¯¯çš„æ—¶å€™æŠ›å‡ºexpectä¸­ç»™å‡ºçš„é”™è¯¯ä¿¡æ¯

ç±»å‹äºŒï¼šé€šè¿‡Okå’ŒErrä¸¤ä¸ªå˜é‡ï¼Œæ¥å¯¹æˆåŠŸå’Œå¤±è´¥åˆ†åˆ«åšæ“ä½œï¼Œ**ä½†æ˜¯ç›®å‰å®æµ‹è¿™ç§ç”¨æ³•ï¼Œå°±æ˜¯Errå’ŒOkçš„å†™æ³•è¦é…åˆmatchå…³é”®è¯æ‰èƒ½ç”Ÿæ•ˆ**å…·ä½“ä¾‹å­å¦‚ä¸‹:

```rust
fn main {
    let mut guess = String::new();
    match io::stdin().read_line(&mut guess) {
        Ok(n) => {
            println!("{} bytes read", n);
            println!("{}", guess);
        }
        Err(error) => println!("error: {}", error),
    };
}
```

> æˆ‘ç†è§£æ˜¯ï¼Œç±»ä¼¼Promiseä¸€æ ·ï¼ŒæˆåŠŸé€šè¿‡thençš„å›è°ƒåšä¸€äº›æ“ä½œï¼Œå¤±è´¥é€šè¿‡catchæ¥å¯¹å¼‚å¸¸åšä¸€äº›æ“ä½œï¼Œå½“ç„¶åªæ˜¯è¿™ä¸ªå›è°ƒçš„æ¦‚å¿µï¼Œä¾¿äºç†è§£ï¼Œå…¶å®ä¸¤è€…æ˜¯å®Œå…¨ä¸èƒ½åˆ’ç­‰å·åšå¯¹æ¯”çš„~

### 4.4 å˜é‡ç±»å‹è½¬æ¢

#### 4.4.1 ç±»å‹æ¯”è¾ƒ

ç›®å‰ï¼Œå› ä¸ºæˆ‘ä»¬ä»å‘½ä»¤è¡Œä¸­è·å–çš„guessç±»å‹æ˜¯Stringï¼Œä½†æ˜¯æˆ‘ä»¬å®é™…é€šè¿‡randç”Ÿæˆçš„æ•°å­—æ˜¯Numberç±»å‹ï¼Œè¿™ä¸¤ä¸ªç±»å‹ä¸åŒ¹é…æ˜¯æ— æ³•æ¯”è¾ƒçš„ï¼Œæ‰€ä»¥å¿…é¡»è¿›è¡Œç±»å‹çš„è½¬æ¢ï¼Œ**é™æ€è¯­è¨€å¯¹äºç±»å‹å®šä¹‰çš„ä¸¥è°¨æ€§**

#### 4.4.2 ä»£ç ç¼–å†™

```rust
fn main {
    // çœç•¥
    let guess: u32 = match guess.trim().parse() {
        Ok(num) => num,
        // è¿™ä¸ªcontinueæ˜¯ä¸ºäº†åç»­åšå¾ªç¯çš„æ—¶å€™ï¼Œç›´æ¥è·³è¿‡åç»­æ“ä½œç”¨çš„
        // å…ˆå¿½ç•¥
        Err(_) => continue,
    };
}
```

**FAQ**ï¼š

*Q1*: å¦‚ä½•å®šä¹‰ä¸€ä¸ªå˜é‡çš„ç±»å‹ï¼Ÿ

*A1*: é€šè¿‡ç±»ä¼¼TSä¸­çš„`:`å‘Šè¯‰rustï¼Œè¿™ä¸ªæ•°å­—å˜é‡çš„ç±»å‹ï¼Œè¿™é‡Œçš„`u32`ä»£è¡¨çš„æ˜¯ä¸€ä¸ª32ä½çš„å˜é‡ï¼Œç±»ä¼¼ä¸€ä¸ªæ•°å­—å˜é‡çš„å£°æ˜ã€‚

*Q2*: ä¸ºä»€ä¹ˆuse rand::Rngä¸å¯¼å…¥çš„æ—¶å€™ï¼Œè¿™ä¸ªgen_rangeå°±æŠ¥é”™ï¼Ÿ

*A2*: å› ä¸º`Rng`è¿™ä¸ª==trait==å®šä¹‰äº†éšæœºæ•°æ–¹æ³•çš„å®ç°ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªåœ°æ–¹ç°æœ‰äº†å®ç°çš„å¼•ç”¨ï¼Œç„¶åè¿™è¾¹è°ƒç”¨gen_rangeæ‰èƒ½è°ƒç”¨

ã€ç†è§£ã€‘[å‚è€ƒæ–‡ç« ](https://zhuanlan.zhihu.com/p/106251259)ï¼ˆ==è¿™ä¸ªåœ°æ–¹å¯¹äºæ¨¡å—åŒ–çš„ç†è§£ä¸ä¸€å®šå¯¹ï¼Œåç»­ä¼šæ”¹==ï¼‰

ç°åœ¨æˆ‘çœ‹docä¸­æœ‰è¿™ä¹ˆå‡ ä¸ªæ¨¡å—çš„æ¦‚å¿µï¼š

modulesï¼šæ¨¡å—ï¼Œè¿™é‡Œå°±æ˜¯æˆ‘ä»¬ç”¨åˆ°çš„åº“çš„æ¦‚å¿µï¼Œæ¯”å¦‚randã€stdç­‰ï¼Œè¿™äº›æœ¬èº«åœ¨å£°æ˜çš„æ—¶å€™æ˜¯é€šè¿‡`mod`æ¥å£°æ˜çš„ï¼Œå¼•å…¥çš„å¦‚æœæ˜¯å­æ¨¡å—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`use mod::sub_mod`è¿™æ ·çš„æ–¹å¼æ¥å¼•å…¥å­æ¨¡å—

traitsï¼šæ˜¯ä¸€ä¸ª**æ–¹æ³•çš„é›†åˆ**ï¼ˆè¿™ä¸ªæ˜¯æˆ‘è‡ªå·±çš„ç†è§£ï¼‰ï¼Œå› ä¸ºåœ¨[Rustâ€”â€”ç†è§£trait ï¼ˆä¸€ï¼‰](https://zhuanlan.zhihu.com/p/237560100)è¿™é‡Œç»™å‡ºçš„ä¾‹å­ä¸­ï¼Œå…¶å®æ˜¯åœ¨å®ç°ä¸Šä¼šæ›´åŠ çµæ´»ï¼Œå³å¯ä»¥åœ¨ç‰¹å®šçš„æ¡ä»¶ä¸‹è¡¨ç°å‡ºç‰¹å®šçš„ç‰¹æ€§ï¼Œæ›´åŠ çµæ´»

Functionsï¼šé€šè¿‡`somemod::method`çš„æ–¹æ³•æ¥å¼•ç”¨ï¼Œç›¸åº”æ¨¡å—ä¸‹çš„æ–¹æ³•

*Q3*: trimå’Œparseçš„ç”¨æ³•

*A3*: trimç”¨äºå»é™¤å‰åçš„ç©ºæ ¼å’Œjsä¸­çš„trimç”¨æ³•ä¸€æ ·ï¼Œparseç”¨äºå°†stringè½¬æ¢æˆå¯¹åº”çš„æ•°å­—ç±»å‹ã€‚parseè¿™é‡Œè¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª`Result`ç±»å‹ï¼Œè¿™é‡Œçœ‹ä¸Šå»æ˜¯ä¸æ˜¯ç‰¹åˆ«åƒPromise.thenå’Œcatchå‘¢ã€‚ï¼ˆè¯´çš„å¾ˆå°å£°ï¼Œå¾ˆå¿ƒè™šï¼‰

### 4.5 æ¯”è¾ƒ

#### 4.5.1 matchå…³é”®å­—

å¯¹æ¯”å¤šä¸ªæ•°å€¼ï¼Œç±»ä¼¼switch...caseçš„è¿™ç§è¯­æ³•ï¼Œåœ¨rustä¸­å’Œmatchæœ‰ç‚¹ç±»ä¼¼ï¼Œå…¶ä½œç”¨æ˜¯ï¼Œåœ¨æŸç§åœºæ™¯ä¸‹å¯ä»¥è¿”å›æŸäº›å€¼ã€‚åç»­åº”è¯¥ä¼šè¯¦ç»†çš„ä»‹ç»ï¼ˆè‡³å°‘æ–‡ä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼‰

å…¶å…·ä½“è¯­æ³•æ˜¯: 

```rust
// è¿™é‡Œçš„xxxæ˜¯ä¸€ä¸ªæ“ä½œè¿”å›çš„ç»“æœ
match xxxx() {
    A1(a1) => XXX,
    A2(a2) => XXX,
    A3(a3) => XXX,
}
```

#### 4.5.2 ä»£ç ç¼–å†™

```rust
use std::cmp::Ordering;

fn main () {
    // çœç•¥ä¸Šè¿°ä»£ç 
    // è¿™é‡Œçš„&secret_number_1åªæ˜¯ä¸ºäº†å–ä»–çš„å¼•ç”¨å€¼
    match guess.cmp(&secret_number_1) {
        // å¯¹æ¯”ç»“æœæ˜¯lessçš„è¯
        Ordering::Less => println!("Too Small!"),
        // å¯¹æ¯”ç»“æœæ˜¯greaterçš„è¯
        Ordering::Greater => println!("Too Big!"),
        // ç›¸ç­‰æ€ä¹ˆæ“ä½œ
        Ordering::Equal => {
            println!("You win!");
            // è¿™é‡Œæ˜¯åšloopå¾ªç¯çš„æ—¶å€™ï¼ŒçŒœå¯¹äº†ç›´æ¥è·³å‡ºå¾ªç¯ç”¨çš„
            break;
        }
    }
}
```

**FAQ**ï¼š

*Q1*: Orderingæ˜¯å•¥ï¼Ÿ

*A1*:åªæ˜¯ä¸€ä¸ªæšä¸¾å€¼~ä½†æ˜¯ä¹Ÿè¦å¼•å…¥æ‰èƒ½ç”¨

### 4.6 å®Œæ•´ä»£ç 

```rust
// ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“stdä¸­çš„ioæ¨¡å—
// åœ¨jsé‡Œé¢ç›¸å½“äº import { io } from 'std' è¿™ä¸ªç±»æ¯”æ˜¯æˆ‘è‡ªå·±ç†è§£çš„ä¸ä¸€å®šæ­£ç¡®
use rand::Rng;
use std::cmp::Ordering;
use std::io;

fn main() {
    println!("Guess the number!");

    // è¿™é‡Œæœ‰ä¸ªè¯­æ³•æ²¡å¼„æ˜ç™½
    // ä¸ºä»€ä¹ˆuse rand::Rngä¸å¯¼å…¥çš„æ—¶å€™ï¼Œè¿™ä¸ªgen_rangeå°±æŠ¥é”™
    // ä¸çŸ¥é“è¿™ä¸ªåœ°æ–¹çš„å¯¼å…¥å…³ç³»æ˜¯å’‹æ ·
    // åæœŸè¦å†çœ‹çœ‹
    // æ–‡ä¸­å†™çš„æ˜¯å› ä¸ºRngæ˜¯å®šä¹‰äº†éšæœºæ•°æ–¹æ³•çš„å®ç°
    // æ‰€ä»¥åœ¨è¿™ä¸ªåœ°æ–¹ç°æœ‰äº†å®ç°çš„å¼•ç”¨ï¼Œç„¶åè¿™è¾¹è°ƒç”¨gen_rangeæ‰èƒ½è°ƒç”¨

    // è¿™ç§å†™æ³•æŒ‡çš„æ˜¯ç»™ä¸äº†ä¸€ä¸ªrangeï¼Œ[1, 10)
    let secret_number_1 = rand::thread_rng().gen_range(1..10);
    // è¿™ç§å†™æ³•æ˜¯é—­åŒºé—´[1, 10]
    // let secret_number_2 = rand::thread_rng().gen_range(1..=10);

    loop {
        println!("Please input your guess");
        // å˜é‡å®šä¹‰
        // å’Œjsä¸åŒçš„æ˜¯è¿™é‡Œæœ‰mut
        // åœ¨rustä¸­æ‰€æœ‰å˜é‡é»˜è®¤æ˜¯immutableçš„ï¼Œæ‰€ä»¥ä½ åº”è¯¥æ‡‚äº†
        // æœ‰mutå®šä¹‰ï¼šä»£è¡¨å‚æ•°æ˜¯mutableçš„
        // æ— mutå®šä¹‰ï¼šä»£è¡¨å‚æ•°æ˜¯immutableçš„

        // é€šè¿‡ç±»::æ–¹æ³•çš„æ–¹å¼ï¼Œè¡¨ç¤ºè°ƒç”¨äº†ç±»çš„ä¸€ä¸ªæ–¹æ³•
        // è¿™é‡Œè°ƒç”¨çš„æ˜¯ä¸€newçš„ä¸€ä¸ªæ„é€ å‡½æ•°
        // newæˆ‘ç†è§£æ˜¯rustä¸­ä¸€ä¸ªé€šç”¨çš„åç§°ï¼Œç”¨æ¥åˆ›å»ºæŸä¸ªç±»æ–°çš„å€¼
        let mut guess = String::new();

        // è°ƒç”¨ioæ¨¡å—ä¸­çš„stdinæ–¹æ³•
        // è¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨std::io::stdin
        match io::stdin()
            // è°ƒç”¨read_lineæ–¹æ³•
            // &ä»£è¡¨æ˜¯å¼•ç”¨ç±»å‹ï¼Œç»™å¼•ç”¨èµ‹å€¼ï¼Œä»£ç ä¸­çš„å¤šä¸ªéƒ¨åˆ†æ¥å…¥åŒä¸€ä¸ªå¼•ç”¨å°±æ˜¯åŒä¸€ä¸ªå€¼
            // å› ä¸ºä¹‹å‰å®šä¹‰çš„guessæ˜¯mutableçš„æ‰€ä»¥è¿™é‡Œè¦è¡—ä¸Šmutçš„ä¿®é¥°
            // è¿™é‡Œä¸€å®šè¦æ˜¯mutçš„ç±»å‹ï¼Œå› ä¸ºread_lineè¦æ±‚å°±æ˜¯mutableçš„
            .read_line(&mut guess) {
                Ok(n) => {
                    println!("{} bytes read", n);
                    println!("{}", guess);
                }
                Err(error) => println!("error: {}", error),
            };
            // åœ¨expectçš„å®ç°ä¸­ï¼ŒæˆåŠŸæ‰§è¡Œå°±ä¼šè·³è¿‡ï¼Œæ‰§è¡Œå¤±è´¥ä¼šè¿”å›expectä¼ å…¥çš„error message
            // expectç”¨äºåˆ¤æ–­ä¸Šä¸€ä¸ªæ“ä½œæ˜¯å¦æˆåŠŸ
            // è¿™ä¸ªexpectæ˜¯io::Resultå®šä¹‰çš„
            // .expect("Fail to read line");

        // è¿™é‡Œçš„parseçš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªResult
        // ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡expectæ¥æ€•æ®µæ˜¯å¦æ»¡è¶³äº†è½¬æ¢çš„é¢„æœŸ
        // è½¬æ¢ä¸æˆåŠŸå°±æŠ¥é”™
        // é€šè¿‡ç±»ä¼¼tsçš„ï¼šæ¥å‘Šè¯‰rustï¼Œè¿™ä¸ªå˜é‡æœŸå¾…çš„ç±»å‹
        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        match guess.cmp(&secret_number_1) {
            Ordering::Less => println!("Too Small!"),
            Ordering::Greater => println!("Too Big!"),
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
}
```

### 4.7 æ•ˆæœ

![](.\images\guess.gif)

## 5. é€šç”¨çš„ç¼–ç¨‹æ¦‚å¿µ

### 5.1 å˜é‡å’Œå¯å˜æ€§

#### 5.1.1 æ¦‚å¿µ

å˜é‡ï¼ˆvariablesï¼‰:ç”¨æ¥å­˜å‚¨å€¼çš„ä¸€ä¸ªåœ°æ–¹ï¼ˆStoring values with Variablesï¼‰,é»˜è®¤æ˜¯immutable

å¸¸é‡ï¼ˆconstantsï¼‰:ä»…å¯è¢«èµ‹å€¼ä¸€æ¬¡çš„å˜é‡

å¯å˜æ€§ï¼ˆmutabilityï¼‰ï¼šé€šè¿‡mutæ¥å®šä¹‰ï¼Œä»£è¡¨å€¼å¯å˜çš„å˜é‡ï¼ˆç±»ä¼¼letï¼Œå¯ä»¥è¢«é‡æ–°èµ‹å€¼ï¼‰

ã€é”™è¯¯å†™æ³•ã€‘

```rust
fn main() {
    // let mut a = 6;
    let a = 5;
    println!("the variable is {}", a);
    // è¿™é‡Œrustä¼šæŠ¥é”™
    a = 6;
    println!("the variable is {}", a);
}
```

ã€æ­£ç¡®å†™æ³•ã€‘å½“ä½¿ç”¨mutçš„æ—¶å€™ï¼Œæˆ‘ä»¬å…è®¸å˜é‡çš„å€¼è¢«æ›´æ”¹

```rust
fn main() {
    // é€šè¿‡mutæ¥åŒºåˆ†ç±»ä¼¼constå’Œletçš„æ¦‚å¿µ
    let mut a = 5;
    println!("the variable is {}", a);
    a = 6;
    println!("the variable is {}", a);
}
```

> Itâ€™s important that we get compile-time errors when we attempt to change a value that we previously designated as immutable because this very situation can lead to bugs. If one part of our code operates on the assumption that a value will never change and another part of our code changes that value, itâ€™s possible that the first part of the code wonâ€™t do what it was designed to do. The cause of this kind of bug can be difficult to track down after the fact, especially when the second piece of code changes the value only *sometimes*
> 
> å¤§ä½“çš„æ„æ€å°±æ˜¯ï¼Œä¸ºäº†é¿å…bugå’Œä»£ç ä¸­éé¢„æœŸçš„æˆåˆ†å¦‚æœæˆ‘ä»¬ä¸€ä¸ªå˜é‡å®šä¹‰çš„æ—¶å€™å‡è®¾ä»–æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå…¶å®å¦‚æœå¯¹å…¶äºŒæ¬¡èµ‹å€¼ï¼Œå…¶å®æ˜¯éç¬¦åˆé¢„æœŸçš„ï¼Œæ‰€ä»¥ç¼–è¯‘é˜¶æ®µä¼šæŠ¥é”™

#### 5.1.2 å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«

**Immutableå˜é‡**å’Œ**å¸¸é‡**ä¹‹é—´çš„åŒºåˆ«ï¼š

+ ã€åŒºåˆ«ã€‘mutå…³é”®è¯ä¸èƒ½ç”¨æ¥ä¿®é¥°constçš„å˜é‡ï¼Œconstä¸€ç›´æ˜¯ä¸å¯å˜çš„

+ ã€åŒºåˆ«ã€‘constå…³é”®å­—å¿…é¡»è¦æ³¨é‡Šç±»å‹ï¼Œå°±æ˜¯éœ€è¦ç»™å‡ºç±»å‹çš„è¯´æ˜

+ ã€åŒºåˆ«ã€‘constå…³é”®è¯å¯ä»¥åœ¨ä»»æ„çš„ä½œç”¨åŸŸè¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ

+ ã€åŒºåˆ«ã€‘constçš„èµ‹å€¼ï¼Œåªèƒ½æ˜¯ä¸€ä¸ªå¸¸æ•°çš„è¡¨è¾¾å¼ï¼Œä¸èƒ½æ˜¯åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½è¢«è®¡ç®—å‡ºçš„è¿è¡Œåçš„ç»“æœï¼ˆå°±æ˜¯ä¸èƒ½æ˜¯ä¸€ä¸ªæ ¹æ®è¿è¡Œæ—¶ç¯å¢ƒå‚æ•°ä¸ä¸€æ ·ï¼ŒåŠ¨æ€è®¡ç®—å¾—åˆ°çš„åŠ¨æ€çš„ç»“æœï¼‰

+ ã€éåŒºåˆ«ã€‘å»ºè®®å®šä¹‰å¸¸é‡æ—¶ï¼Œé€šè¿‡`å¤§å†™å­—æ¯`å’Œ`_`çš„æ–¹å¼æ¥å®šä¹‰ï¼Œå˜é‡å®šä¹‰æ—¶å»ºè®®ä½¿ç”¨å°å†™ï¼Œå¹¶ä¸”åœ¨å•è¯é—´é€šè¿‡ä¸‹åˆ’çº¿çš„æ–¹å¼è¿›è¡Œéš”ç¦»çš„æ–¹å¼ï¼Œ**è§„èŒƒæœ‰æ•ˆçš„å‘½åæ–¹å¼è®©æˆ‘ä»¬åœ¨å†™ä»£ç æ—¶å¯¹å˜é‡çš„è¯†åˆ«ä¼šæ›´åŠ å‡†ç¡®ï¼Œåˆ©äºä»£ç çš„ç»´æŠ¤**ã€‚
  
  ```rust
  // å…¨å±€çš„å£°æ˜æ˜¯è¢«å…è®¸çš„
  // åŒºåˆ«äºŒï¼šéœ€è¦é€šè¿‡ `: `æ¥å‘Šè¯‰rustè¿™ä¸ªå¸¸é‡å¯¹åº”çš„ç±»å‹
  // åŒºåˆ«ä¸‰ï¼šå¯ä»¥åœ¨å…¨å±€å®šä¹‰
  const C_C: &str = "_global cc";
  // åŒºåˆ«å››ï¼šåªèƒ½æ˜¯ä¸€ä¸ªå¸¸æ•°è®¡ç®—ç»“æœçš„è¡¨è¾¾å¼
  const THREE_HOURS_IN_SECONDS: u32 = 60 * 60 * 3;
  // åŒºåˆ«ä¸‰ï¼šè¿™ä¸ªé‡Œä½¿ç”¨letä¼šæŠ¥é”™ï¼Œä¸èƒ½å†å…¨å±€å®šä¹‰
  // expected item, found keyword `let`
  let dd = 32;
  
  fn main() {
      const B_BIT: u32 = 3;
      println!("the constant is {}, {}", C_C, B_BIT);
  }
  ```

#### 5.1.3 å˜é‡è¦†ç›–ï¼ˆé˜´å½±ï¼‰

> TIPSï¼š è¿™é‡Œæˆ‘å…¶å®æ›´å€¾å‘äºå°†åŸæ–‡ä¸­çš„shadowingç¿»è¯‘æˆå˜é‡çš„è¦†å†™å’Œä½œç”¨åŸŸï¼Œå› ä¸ºçœ‹ä¸Šå»å’Œjsçš„ä½œç”¨åŸŸçœŸçš„å¾ˆåƒï¼Œå½“ç„¶å¯èƒ½ä¼šä¸ç¬¦åˆrustä¸­çš„å«æ³•

**ä½œç”¨åŸŸçš„å®šä¹‰å’Œç‰¹æ€§**ï¼šé€šè¿‡`{}`å›´èµ·æ¥çš„ä»£ç å—æ˜¯å•ç‹¬çš„ä½œç”¨åŸŸï¼Œåœ¨å†…éƒ¨ä½œç”¨åŸŸå®šä¹‰çš„å˜é‡ï¼Œä¼šè¦†ç›–æ‰ä¸Šå±‚ä½œç”¨åŸŸä¸­æœ‰çš„å‚æ•°ï¼Œå’ŒJSè¡¨ç°ç›¸è¿‘

**å˜é‡çš„è¦†å†™**ï¼šé€šè¿‡`let`å®šä¹‰åŒåçš„å˜é‡æ¥è¦†å†™ä¸Šé¢å·²ç»é€šè¿‡`let`å®šä¹‰çš„å˜é‡ï¼Œå¦‚æœæ˜¯å˜é‡çš„è¦†å†™æ˜¯ä¸è¦æ±‚å‰ååŒåå˜é‡ç±»å‹ç›¸åŒçš„ï¼Œä½†æ˜¯`mut`å˜é‡çš„ä¿®æ”¹ï¼Œéœ€è¦å‰åæœ‰ä¸€å®šçš„ç±»å‹

**æ³¨æ„ç‚¹**ï¼š`let`å®šä¹‰çš„å˜é‡é€šè¿‡`let`åœ¨è¦†å†™å’Œæ˜¯ä¸æ˜¯`mut`çš„å˜é‡å…¶å®æ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºè¿™é‡Œæ˜¯æ–°åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œè€Œä¸æ˜¯å¯¹å·²ç»ä¸å¯å˜çš„å˜é‡è¿›è¡Œèµ‹å€¼ï¼ˆç¼–è¯‘æ—¶ä¸ä¼šæŠ¥é”™ï¼‰ï¼Œæ‰€ä»¥æ˜¯ä¸¤ä¸ªç»´åº¦çš„äº‹æƒ…

```rust
fn main() {
    let x = 5;
    let x = x + 1;

    // ä¹‹å‰æ˜¯strç±»å‹ï¼Œåé¢çš„numberç±»å‹
    // å¦‚æœæ˜¯å®šä¹‰çš„x_str ä¸ºmut
    // åç»­é€šè¿‡èµ‹å€¼ä¿®æ”¹æ˜¯ä¸è¢«å…è®¸çš„
    let x_str = "   ";
    let x_str = x_str.len();

    {
        let x = x * 2;
        // è¿™é‡Œçš„xæ˜¯12
        println!("The inner x Number is {}", x);
    }

    // è¿™é‡Œçš„xæ˜¯12
    println!("The x Number is {}", x);
}
```

### 5. 2 æ•°æ®ç±»å‹

åœ¨rustä¸­çš„æ•°æ®ç±»å‹ä¸»è¦åŒ…æ‹¬ä¸¤ç§ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œç»„åˆç±»å‹ï¼ˆcompoundï¼‰ï¼Œå› ä¸ºrustæœ¬æ¥æ˜¯ä¸€ä¸ª**é™æ€ç±»å‹è¯­è¨€**ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç¼–è¯‘æ—¶å‘Šè¯‰rustæ‰€æœ‰å˜é‡çš„ç±»å‹ï¼Œæ‰€ä»¥åœ¨ç±»å‹è½¬æ¢çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œéœ€è¦è½¬æˆçš„ç±»å‹å£°æ˜ã€‚

#### 5.2.1 æ ‡é‡ç±»å‹

æ ‡é‡ç±»å‹å•è¡¨çš„æ˜¯å•ä¸€çš„å€¼ï¼Œä¸æ˜¯ç»„åˆçš„å€¼ï¼Œå…·ä½“çš„ç±»å‹å¦‚ä¸‹ï¼š

+ æ•´å‹ï¼ˆintegersï¼‰
+ æµ®ç‚¹å‹ï¼ˆfloatï¼‰
+ å¸ƒå°”ç±»å‹
+ å­—ç¬¦ä¸²ç±»å‹

---

##### æ•´å‹ç±»å‹

| é•¿åº¦      | æœ‰ç¬¦å·     | æ— ç¬¦å·     |
| ------- | ------- | ------- |
| 8-bit   | `i8`    | `u8`    |
| 16-bit  | `i16`   | `u16`   |
| 32-bit  | `i32`   | `u32`   |
| 64-bit  | `i64`   | `u64`   |
| 128-bit | `i128`  | `u128`  |
| arch    | `isize` | `usize` |

**æ³¨æ„ç‚¹**

1. æœ‰ç¬¦å·é€šè¿‡`i`å¼€å¤´ï¼Œæ— ç¬¦å·é€šè¿‡`u`å¼€å¤´
2. æ•´å‹çš„åŒºé—´ä¸ºï¼Œæœ‰ç¬¦å·ä¸º -2^n-1^ ~ 2^n-1^ - 1 ï¼Œæ— ç¬¦å·ä¸º0~2^n^ - 1
3. `arch`ä»£è¡¨çš„æ˜¯å½“å‰æ“ä½œç³»ç»Ÿæ¶æ„æœ€å¤§çš„ä½æ•°ï¼Œæ¯”å¦‚x64å°±æ˜¯`u64`, `i64`
4. è¡¨ç¤ºä¸åŒè¿›åˆ¶çš„æ–¹æ³•
   1. åè¿›åˆ¶ï¼š1_000,1000éƒ½æ˜¯åè¿›åˆ¶
   2. åå…­è¿›åˆ¶ï¼š0xff
   3. å…«è¿›åˆ¶ï¼š0o77
   4. äºŒè¿›åˆ¶ï¼š0b1111_0000
   5. å­—èŠ‚ï¼šb'A'
5. å¯¹äºæº¢å‡ºçš„å¤„ç†ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼ˆdebugæ¨¡å¼ï¼‰ä¼šæŠ¥é”™ï¼Œå¼•èµ·ä½ çš„æ³¨æ„ï¼Œä½†æ˜¯å¦‚æœæ˜¯`--release`æ¨¡å¼ä¸‹å¹¶ä¸ä¼šæŠ¥é”™ï¼Œä»–ä¼šæŠŠè¿™ä¸ªå€¼ç½®ä¸ºä½ è¶…è¿‡éƒ¨åˆ†çš„å€¼ï¼Œè¿™æ˜¯å› ä¸ºä»–ä¼šè‡ªåŠ¨åœ¨å¤–éƒ¨å¡«å……ä¸¤ä½ï¼Œæ¥æ¥æ”¶å¯¹åº”çš„å€¼ï¼Œæ‰€ä»¥è™½ç„¶ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦æˆ‘ä»¬å¯¹åŠ å‡å’Œæœ€å¤§æœ€å°å€¼æ¥åšä¸€ä¸‹æ ¡éªŒï¼Œä¸»æµçš„åº“ä¸­éƒ½ä¼šæœ‰ç›¸åº”çš„æ–¹æ³•ï¼š
   1. `wrapping_*`æ¥åšæ•°çš„è¿ç®—
   2. `checked_*`æ¥åˆ¤æ–­æ˜¯å¦æœ‰æº¢å‡ºï¼Œ`None`è¿”å›å€¼ä»£è¡¨æº¢å‡ºäº†
   3. `overflowing_*`è¿”å›å€¼å’Œä¸€ä¸ªå¸ƒå°”å€¼æ¥åˆ¤æ–­æ˜¯å¦æº¢å‡ºäº†
   4. `saturating_*`æ–¹æ³•æ¥ä»£è¡¨æ”¹å€¼åœ¨å®šä¹‰çš„åŒºé—´å†…

---

##### æµ®ç‚¹ç±»å‹

æµ®ç‚¹ç±»å‹çš„å®šä¹‰åªæœ‰ä¸¤ä¸ªæ–¹æ³•`f32`å’Œ`f64`

```rust
fn main () {
    // æ•°å€¼ç±»å‹
    // æµ®ç‚¹é™¤æ³•
    // å¦‚æœä¸æ˜¯2.0 / 3.0è¿”å›çš„æ˜¯0ï¼Œé»˜è®¤ä¸ºæ•´å‹
    // let float_num = 2 / 3;  

    let floorded:f64 = 2.0 / 3.0;
    // è¿™æ ·æ˜¯0.66666
    println!("the float is {}", floorded)
}
```

**æ³¨æ„ç‚¹**

1. é»˜è®¤æ˜¯`f64`ä¸ºäº†ä¿è¯æµ®ç‚¹æ›´é«˜çš„ç²¾åº¦
2. å¦‚æœæ˜¯`2 / 3`çš„å½¢å¼è¿”å›çš„æ˜¯æ•´å‹ï¼Œä¹Ÿå°±æ˜¯0ï¼Œå¦‚æœéœ€è¦å¾—åˆ°å°æ•°ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯`2.0 / 3.0`ä¿è¯å³è¾¹éƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œæœ€åè®¡ç®—ç»“æœæ‰ä¼šæ˜¯æµ®ç‚¹æ•°

---

##### å¸ƒå°”ç±»å‹

ç±»å‹é€šè¿‡`bool`æ¥è¿›è¡Œå®šä¹‰å³å¯ï¼Œç”¨äºæ¡ä»¶æ§åˆ¶ï¼Œè¿™ä¸ªåœ¨`if`çš„æ§åˆ¶æµä¸­ä¼šç”¨åˆ°ï¼Œå’Œæ‰€æœ‰è¯­è¨€çš„éƒ½ç±»ä¼¼

```rust
fn main () {
    let f: bool = false;
}
```

---

##### å­—ç¬¦ä¸²ç±»å‹

rustä¸­çš„å­—ç¬¦ä¸²ç±»å‹æ˜¯æœ€åŸå§‹çš„å­—æ¯ç±»å‹,åŒ…å«ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡è¡¨æƒ…ç­‰å­—ç¬¦ï¼ˆUnicode Scalaræ¯”ASCIIç æ›´ä¸°å¯Œï¼‰

```rust
fn main() {
    let c = 'z';
    let z = 'â„¤';
    let heart_eyed_cat = 'ğŸ˜»';
}
```

#### 5.2.2 ç»„åˆç±»å‹

##### å…ƒç»„ç±»å‹

å…ƒç»„ç±»å‹æ˜¯å°†å¤šä¸ªå…¶ä»–ç±»å‹æ”¾åˆ°ä¸€ä¸ªç»„åˆç±»å‹ä¸­ï¼Œå…ƒç»„çš„ç‰¹ç‚¹ï¼š

+ å›ºå®šçš„é•¿åº¦
+ ä¸€æ¬¡æ€§çš„å®šä¹‰
+ é•¿åº¦ä¸å¯æ”¶ç¼©
+ é€—å·åˆ†éš”çš„åˆ—è¡¨
+ é€šè¿‡`()`æ¥å®šä¹‰

```rust
fn main () {
    // ç»„åˆç±»å‹
    // å…ƒç»„
    let tup: (i32, i8, f64) = (500, 22, 3.14);
    let (t1, t2, t3) = tup;

    println!("tup -> {}, {}, {}", tup.0, tup.1, tup.2);
    println!("tup -> {}, {}, {}", t1, t2, t3);
}
```

**æ³¨æ„ç‚¹**ï¼š

1. å¯ä»¥é€šè¿‡`.`è¯­æ³•æ¥è¿›è¡Œå¯¹åº”ä½ç½®å…ƒç»„æ•°æ®çš„è·å–
2. å¯ä»¥é€šè¿‡è§£æ„çš„æ–¹å¼æ¥å›å»å¯¹åº”ä½ç½®ä¸Šçš„å€¼

---

##### æ•°ç»„ç±»å‹

æ•°ç»„æ˜¯åŒä¸€ç§ç±»å‹çš„å…ƒç´ çš„é›†åˆï¼Œå’Œå…ƒç´ çš„ä¸åŒæ˜¯**å¿…é¡»æ‰€æœ‰å…ƒç´ å…·æœ‰ç›¸åŒçš„ç±»å‹**ï¼Œå…¶ç‰¹ç‚¹ï¼š

+ å…ƒç´ ç±»å‹ç›¸åŒ
+ é€šè¿‡`[]`æ¥å®šä¹‰

```rust
fn main () {
    // æ•°ç»„
    let array1 = [1, 2, 3, 4, 5];
    let array2: [i32;5] = [1, 2, 3, 4, 5]; 
    // å‰ä¸¤ç§æ¯”è¾ƒå¥½ç†è§£ï¼Œè¿™ç§çš„æ„æ€æ˜¯ç”Ÿæˆä¸€ä¸ªæ•´å‹çš„æ•°ç»„ï¼Œé•¿åº¦ä¸º5ï¼Œé»˜è®¤å€¼ä¸º3
    let array3 = [3;5];

    println!("str -> {}", array2[1]);
}
```

**æ³¨æ„ç‚¹**

1. æ¥å…¥æ•°ç»„çš„æ–¹å¼é€šè¿‡ç´¢å¼•æ¥æ¥å…¥ï¼Œä¾‹å¦‚`array2[1]`
2. å¦‚æœè¿™ä¸ªindexæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸€å®šè¦åˆ¤æ–­indexæ˜¯å¦å°äºæ•°ç»„çš„é•¿åº¦ï¼Œä¸ç„¶çš„è¯ç¼–è¯‘çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ çš„indexæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œä½†æ˜¯åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¾ˆæœ‰å¯èƒ½indexè¶…è¿‡äº†æœ€é•¿çš„æ•°ç»„é•¿åº¦æŠ¥é”™ï¼ˆ**è¶Šç•ŒæŠ¥é”™**ï¼‰

### 5.3 å‡½æ•°

#### 5.3.1 å‡½æ•°å®šä¹‰æ–¹å¼

å‡½æ•°çš„å®šä¹‰æ–¹å¼ï¼š

1. é€šè¿‡`fn`å…³é”®å­—è¿›è¡Œå®šä¹‰
2. åœ¨`fn`åè·Ÿä¸Šç›¸åº”çš„å‡½æ•°å
3. é€šè¿‡`{}`æ¥ å®šä¹‰å‡½æ•°ä½“

```rust
fn main () {
    println!("this is main function");
    another_function();
}

fn another_function() {
    println!("this is another function, {}", get_params(3, 4))
}

fn get_params  (a: i32, b: i32) -> i32 {
    return a + b;
}
```

**æ³¨æ„ç‚¹**ï¼š

1. å‡½æ•°çš„è¾“å…¥å¯å®šä¹‰ç±»å‹ï¼Œè¾“å…¥é€šè¿‡`:`æ¥å®šä¹‰ç±»å‹
2. é»˜è®¤çš„å‡½æ•°æ˜¯ä¸å¸¦è¿”å›å€¼çš„ï¼Œå¦‚æœå¸¦ä¸Šè¿”å›å€¼éœ€è¦é€šè¿‡`->`æŒ‡å®šç±»å‹ï¼Œä¸ç„¶ä¼šæŠ¥é”™

#### 5.3.2 å‡½æ•°ä½“åŒ…æ‹¬å£°æ˜å’Œè¡¨è¾¾å¼

Rustæ˜¯ä¸€ä¸ªåŸºäºè¡¨è¾¾å¼çš„è¯­è¨€ï¼Œè¡¨è¾¾å¼å’Œå£°æ˜çš„å®šä¹‰åœ¨è¿™é‡Œå°±ä¸å™è¿°äº†ï¼Œç™¾åº¦è‚¯å®šæ¯”æˆ‘ä¸“ä¸šã€‚

**æ³¨æ„ç‚¹**

1. å£°æ˜å¹¶ä¸ä¼šè¿”å›å€¼ï¼Œæ‰€ä»¥ä¸æ”¯æŒJSä¸­çš„é‚£ç§è¿ç­‰å¼èµ‹å€¼ï¼Œç›®å‰æ˜¯ä¸è¢«å…è®¸çš„~

```rust
fn main() {
    // è¿™é‡Œä¼šæŠ¥é”™`let` expressions in this position are experimental
    let x = (let y = 6);
}
```

2. åœ¨rustä¸­è¡¨è¾¾å¼æ˜¯ä¸éœ€è¦åŒ…å«å°¾åˆ†å·çš„ï¼Œä¸€æ—¦ä½ ä½¿ç”¨äº†å°¾åˆ†å·å°±æŠŠè¡¨è¾¾å¼å˜æˆäº†å£°æ˜

```rust
fn main () {
    println!("this is main function");
    another_function();
    let y = {
        let x = 3;
        // è¿™é‡Œæ²¡æœ‰å°¾åˆ†å·
        // æ‰€ä»¥æ˜¯ä¸ªè¡¨è¾¾å¼ï¼ŒY -> 4
        // å¦‚æœåŠ ä¸Šå°¾åˆ†å·ï¼Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºä»–å…¶å®è¿˜æ˜¯æ²¡æœ‰è¿”å›å€¼
        x+1
    };

    println!("y => {}", y)
}
```

3. å¯ä»¥å°†å‡½æ•°çš„è¿”å›å€¼å’Œè¡¨è¾¾å¼ç»“åˆï¼Œè¿™æ ·å‡½æ•°ä¼šå˜å¾—æ›´åŠ ç®€æ´
   
   ```rust
   fn main () {
       println!("this is main function");
       another_function();
       let y = {
           let x = 3;
           addOne(x)
       };
   
       // y => 4
       println!("y => {}", y)
   }
   
   fn addOne(num: u32) -> u32 {
       num + 1
   }
   ```

### 5.4 æ³¨é‡Š

æ³¨é‡Šä¸»è¦é€šè¿‡`//`æ¥è¿›è¡Œæ³¨é‡Šï¼Œå¦‚æœæ˜¯å¤šè¡Œçš„è¯ï¼Œå°±æ˜¯æ¯ä¸€è¡Œä¹‹æ°”éƒ½éœ€è¦é€šè¿‡`//`æ¥è¿›è¡Œæ³¨é‡Š

### 5.5 æ§åˆ¶æµ

åŸºæœ¬ä¸Šæ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€éƒ½é€ƒä¸å¼€ç›¸å…³çš„æ§åˆ¶æµçš„è¯­æ³•ï¼Œä¾‹å¦‚`if`,å¾ªç¯`loop`ç­‰ï¼Œè¿™ä¸€å°èŠ‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹rustä¸­çš„å¾ªç¯å’Œåˆ¤æ–­è¯­æ³•

#### 5.5.1 ifè¡¨è¾¾å¼

å’Œå…¶ä»–è¯­è¨€ä¸­çš„ifè¡¨è¾¾å¼ä¸€æ ·ï¼Œé€šè¿‡`if`å…³é”®å­—åé¢çš„å£°æ˜ï¼ŒæŒ‡å®šæ¡ä»¶åŒ¹é…åçš„æ“ä½œï¼ŒåŒæ ·ä¹Ÿæ”¯æŒ`else`å’Œ`else if`

```rust
fn main() {
    let number = 5;
    if number < 5 {
        println!("number is less than 5")
    } else if number == 5 {
        println!("number is equal to 5")
    } else {
        println!("number is greater than 5")
    }
}
```

**æ³¨æ„ç‚¹**

1. `if`ä½œä¸ºè¡¨è¾¾å¼ï¼Œå¯ä»¥åœ¨letä¸­ä½¿ç”¨è¾¾åˆ°ä¸‰å…ƒè¡¨è¾¾å¼çš„æ•ˆæœ
   
   ```rust
   fn main() {
       let number = 5;
       let a = if number < 3 {10} else {20};
   
       println!("a -> {}", a)
   }
   ```

2. `1`ä¸­è¿™ç§è¡¨è¾¾å¼è¦å¯ä»¥ä½¿ç”¨ï¼Œæœ‰ä¸ªå‰æå°±æ˜¯æ¯ä¸ªè¡¨è¾¾å¼è¿”å›å€¼çš„ç±»å‹ï¼Œéœ€è¦ç›¸åŒï¼Œä¸ç„¶åœ¨ç¼–è¯‘æ—¶ï¼Œrustç¼–è¯‘å™¨ä¼šæŠ¥é”™

#### 5.5.2 ä½¿ç”¨Loopæ¥å®ç°é‡å¤

rustä¸­æä¾›äº†ä¸‰ç§å¾ªç¯çš„æ–¹å¼ï¼ŒåŒ…æ‹¬`loop`, `while`å’Œ`for`ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹æ¯ä¸€ç§çš„ç”¨æ³•å’Œå†™æ³•

##### loopå¾ªç¯

loopå¾ªç¯çš„ç‰¹ç‚¹æ˜¯ï¼Œä¸ä¼šä¸»åŠ¨ç»“æŸå¾ªç¯ï¼Œç›´åˆ°ä½¿ç”¨äººæ‰‹åŠ¨åœæ­¢ï¼ˆè°ƒç”¨`break`æŒ‡ä»¤ï¼‰æˆ–è€…ç›´æ¥è¿è¡Œ`ctrl + C`æ‰ä¼šåœæ­¢è¯¥å¾ªç¯ï¼Œå…·ä½“ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```rust
fn main() {
    let mut b = 1;
    loop {
        println!("b =>{}", b);
        b += 1;

        if b > 5 {
            break;
        }
    }
}
```

**æ³¨æ„ç‚¹**ï¼š

1. å’Œå…¶ä»–è¯­è¨€ä¸€æ ·ï¼Œrustä¸­æä¾›äº†`break`å’Œ`continue`å…³é”®å­—ï¼Œç”¨æ¥åœæ­¢å¾ªç¯å’Œè·³è¿‡åç»­ä»£ç è¿™ä¸¤ä¸ªæ“ä½œ

2. å¦‚æœéœ€è¦é€€å‡ºæŒ‡å®šçš„å¾ªç¯ï¼Œå¯ä»¥å°†loopçš„çš„è¿”å›å€¼æ‹¿åˆ°ï¼Œå¹¶é€šè¿‡breakæ¥ä¸­ä¸­æ–­
   
   ```rust
   fn loopExit() {
       let mut  count = 0;
       'loop_rlt: loop {
           println!("count -> {}", count);
           let mut inner_count = 10;
   
           loop {
               println!("inner count ->{}", inner_count);
   
               if inner_count == 8 {
                   break;
               }
   
               if inner_count == 9 && count == 2 {
                   break 'loop_rlt;
               }
   
               inner_count -= 1;
           }
   
           count +=1;
       }
   }
   // è¿è¡Œç»“æœ
   // count -> 0
   // inner count ->10
   // inner count ->9
   // inner count ->8
   // count -> 1
   // inner count ->10
   // inner count ->9
   // inner count ->8
   // count -> 2
   // inner count ->10
   // inner count ->9
   ```

3. loopè¿”å›çš„å€¼éœ€è¦é€šè¿‡`'` åŠ ä¸Šå˜é‡ååŠ ä¸Š`:`æ¥æ ‡æ³¨è¿™æ˜¯ä¸€ä¸ªå¾ªç¯æ ‡è®°ï¼Œè¿™æ˜¯ä¸€ä¸ªè§„èŒƒï¼Œä¾‹å¦‚ä¸Šè¿°çš„`'loop_rlt`ï¼Œè¿™æ ·é€šè¿‡`continue`å’Œ`break`æ¥é€€å‡ºå’Œç»§ç»­å¾ªç¯

4. é€šè¿‡`let`å’Œ`break`å¯ä»¥è·å–breakæœ€åæˆ‘ä»¬æƒ³è¦è¾“å‡ºçš„å‡½æ•°å€¼
   
   ```rust
   fn loop_return_value(num: u32) -> u32 {
       let mut count = 1;
   
       let loop_value = loop {
           count+=1;
   
           if count == num {
               break count * 2;
           }
       };
   
       return loop_value
   }
   
   fn main () {
       let rlt: u32 = loop_return_value(30);
       // rlt -> 60
       println!("rlt -> {}", rlt);
   }
   ```

##### whileå¾ªç¯

`while`å¾ªç¯å’Œ`loop`ä¸­ï¼Œä¸€æ ·å¯ä»¥é€šè¿‡`break`æ¥è¿›è¡Œä¸­æ–­ï¼Œå…¶å†™æ³•ä¹Ÿå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å…¶ä»–è¯­è¨€ä¸­çš„`while`ç›¸ä¼¼

```rust
fn main() {
    let mut number = 3;

    while number != 0 {
        println!("{}!", number);

        number -= 1;
    }

    println!("LIFTOFF!!!");
}
```

**æ³¨æ„ç‚¹**ï¼š

1. å¦‚æœæ˜¯ä½¿ç”¨`while`å¾ªç¯éå†æ•°ç»„ç­‰æœ‰ç•Œçš„ç»“æ„ï¼Œå¯èƒ½éœ€è¦å¯¹åŠ¨æ€ç”Ÿæˆçš„indexåšå‡ºåˆ¤æ–­

##### forå¾ªç¯

**for...inå¾ªç¯**

é€šè¿‡whileå¾ªç¯æ¥ä¾¿åˆ©æ•°ç»„å¯èƒ½ä¼šäº§ç”Ÿè¶Šç•Œçš„é—®é¢˜ï¼Œä¸ºäº†é¿å…è¶Šç•Œå¯ä»¥é€šè¿‡`for...in`**çš„æ–¹å¼æ¥è¿›è¡Œ**éå†ï¼Œä¾¿ä¸ä¼šæœ‰è¶Šç•Œçš„é—®é¢˜ï¼Œå› ä¸ºåœ¨whileä¸­æˆ‘ä»¬æ§åˆ¶indexæ˜¯åŠ¨æ€çš„ä¸ç¨³å®šã€‚

```rust
fn for_loop () {
    let a = [1, 2, 3, 4, 5, 6];

    for elem in a {
        println!("loop for -> {}", elem);
    }
}
```

**åˆ©ç”¨Rangeå’Œfor..inçš„ç»„åˆæ¥è¿›è¡Œå¾ªç¯**

é€šè¿‡`for...in`é™¤äº†å®ç°å¯¹é›†åˆç±»å‹çš„æ•°æ®ç»“æ„è¿›è¡Œéå†ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°å¯¹whileé‚£æ ·çš„å¤šæ¬¡å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`range`åŠ `for...in`å¾ªç¯çš„æ–¹å¼

```rust
fn for_loop () {
    for elem in (1..100) {
        println!("item -> {}", elem)
    }
    // item -> 1
    // item -> 2
    // ...
    /// item -> 99
}
```

> ä¸Šè¿°æ–¹å¼å› ä¸ºæ˜¯1..100æ‰€ä»¥åŒºé—´æ˜¯[1, 100)ï¼Œå¦‚æœæƒ³è¦åŒé—­çš„åŒºé—´ï¼Œå†™æ³•åº”è¯¥æ˜¯(1..=100)

#### 5.5.3 ç»ƒä¹ é¢˜

**Fibonacci**

```rust
fn fibonacci(number: u32) -> u32 {
    if number == 1 {
        return 1;
    } else if number == 2 {
        return 1;
    } else {
        return fibonacci(number - 2) + fibonacci(number - 1)
    }
}
```

## 6. ç†è§£æ‰€æœ‰è€…ï¼ˆownershipï¼‰

### å†™åœ¨å‰é¢

åœ¨rustä¸­**æ‰€æœ‰è€…**æ˜¯æœ€ç‹¬ä¸€æ— äºŒçš„ç‰¹æ€§ï¼Œä»–ä½¿å¾—**rustèƒ½ä¿è¯å†…å­˜ä¸­çš„GCæ˜¯å®‰å…¨çš„**ã€‚è¿™é‡Œå°†ä»‹ç»å‡ ä¸ªæ¦‚å¿µï¼š**å€Ÿç”¨ï¼ˆborrowingï¼‰**ã€**åˆ‡ç‰‡ï¼ˆslicesï¼‰**å’Œruståœ¨**å†…å­˜ä¸­çš„æ•°æ®å±•å¼€**

### 6.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰è€…

#### 6.1.1 Rustæ‰€æœ‰è€…å¾—æ¨¡å¼

æ‰€æœ‰è€…æ˜¯Rustæ ¸å¿ƒçš„ç‰¹æ€§ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹åœ¨å†…å­˜GCçš„ç®¡ç†ä¸Šï¼ŒRustæœ‰ä½•ä¸åŒã€‚

**ç°æœ‰çš„GCæ¨¡å¼**

1. ä¸æ–­æŸ¥è¯¢é‚£äº›ä¸å†è¢«ä½¿ç”¨çš„å†…å­˜
2. è®©coderè‡ªå·±åˆ†é…å’Œé‡Šæ”¾å†…å­˜

**Rustçš„æ¨¡å¼**ï¼š ç³»ç»Ÿæ‰€æœ‰è€…æŒ‡å®šè§„åˆ™ï¼Œç¼–è¯‘å™¨å†ç¼–è¯‘æ—¶æ£€æµ‹è§„åˆ™ï¼Œå¦‚æœä¸æŒ‡å®šæ‰€æœ‰è€…ï¼Œè¿è¡Œæ—¶é€Ÿåº¦ä¼šå˜æ…¢ã€‚

> é—®é¢˜æ¥äº†ï¼Œä½œä¸ºä¸€ä¸ªæ–°æ‰‹æˆ‘ä¸çŸ¥é“åº”è¯¥æ€ä¹ˆæŒ‡å®šæˆ‘æ‰€æœ‰è€…çš„è§„åˆ™è¯¥æ€ä¹ˆåŠï¼Ÿ
> 
> å®˜æ–¹å›ç­”ï¼šä½ å°±å¾—å¤šå­¦å¤šç»ƒï¼Œè¶Šæ˜¯æœ‰ç»éªŒå¾—Rustä½¿ç”¨è€…ï¼Œå¯¹æ‰€æœ‰è€…ç†è§£è¶Šæ·±ï¼Œä½ è‡ªç„¶è€Œç„¶ä»£ç å°±ä¼šè¶Šå®‰å…¨å’Œè¶Šæœ‰æ•ˆï¼Œå˜¿å˜¿ã€‚å¬å›ä¸€å¸­è¯ï¼Œçš„ç¡®å¬äº†ä¸€å¸­è¯ã€‚

#### 6.1.2 å †æ ˆçš„ä»‹ç»

è¿™é‡Œå› ä¸ºRustä¸­åœ¨ä½¿ç”¨æ‰€æœ‰è€…çš„æ—¶å€™ï¼Œéƒ¨åˆ†å¯èƒ½éœ€è¦é€šè¿‡å †å’Œæ ˆä¹‹é—´çš„å…³ç³»æ‰èƒ½åšå‡ºåˆé€‚çš„å†³å®šï¼Œå› æ­¤ç®€å•ä»‹ç»ä¸‹ã€‚

**å †**å’Œ**æ ˆ**å…¶å®éƒ½æ˜¯ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­åœ¨å†…å­˜ä¸­ç”¨äºå­˜å‚¨æ•°æ®çš„åœ°æ–¹ã€‚å…·ä½“çš„åŒºåˆ«å¯ä»¥çœ‹[æ ˆå’Œå †çš„åŒºåˆ«](https://blog.csdn.net/u012836896/article/details/89973820)

+ æ ˆçš„ç‰¹ç‚¹
  
  + åå…¥å…ˆå‡ºï¼ˆä¾‹å­ï¼šç­‰ç”µæ¢¯ï¼‰
  + é•¿åº¦å›ºå®šï¼Œæ•°æ®å·²ç›´
  + å­˜å‚¨æ˜¯æœ‰åºçš„
  + è¿ç»­çš„å†…å­˜åŒºåŸŸ
  + pushï¼ˆå­˜æ”¾ï¼‰å’Œaccessï¼ˆæŸ¥è¯¢ï¼‰æ•°æ®æ›´å¿«

+ å †çš„ç‰¹ç‚¹
  
  + é•¿åº¦å¯å˜æˆ–é•¿åº¦æœªçŸ¥
  + å­˜å‚¨æ˜¯æ— åºçš„ï¼Œè‡ªç”±åº¦æ¯”è¾ƒå¤§
  + ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸ
  + pushï¼ˆå­˜æ”¾ï¼‰å’Œaccessï¼ˆæŸ¥è¯¢ï¼‰æ•°æ®æ›´æ…¢

æ ˆçš„å­˜æ”¾æ›´å¿«æ˜¯å› ä¸ºä»–æ˜¯è¿ç»­çš„åŒºåŸŸï¼Œè€Œå †éœ€è¦åˆ†é…å™¨å»æ‰¾å“ªå—ç©ºé—²çš„åŒºåŸŸå¯ä»¥å­˜æ”¾

æ ˆçš„è¯»å–æ›´å—æ˜¯å› ä¸ºï¼Œä¸éœ€è¦ç”¨æŒ‡é’ˆå»æ‰¾åˆ°åº•æ˜¯å“ªä¸ªç¢ç‰‡åŒ–çš„åœ°å€å­˜å‚¨äº†ç›¸å…³çš„å˜é‡

#### 6.1.3 æ‰€æœ‰è€…çš„è§„å®š

1. åœ¨rustä¸­ï¼Œæ¯ä¸€ä¸ªæœ‰å€¼çš„å˜é‡éƒ½ç§°ä¸ºæ‰€æœ‰è€…ï¼ˆownerï¼‰
2. åœ¨åŒä¸€ä¸ªæ—¶é—´éƒ½åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
3. å½“æ‰€æœ‰è€…ç¦»å¼€ä½œç”¨åŸŸï¼Œå€¼ä¹Ÿå°±è¢«åˆ é™¤äº†

#### 6.1.4 å˜é‡ä½œç”¨åŸŸ

æ ¹æ®ä¸Šé¢çš„æ‰€æœ‰è€…è§„å®šæˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå˜é‡åœ¨**å®šä¹‰å‰**å’Œ**ä½œç”¨åŸŸ**å¤–ï¼Œå…¶å®æ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥ä¸€ä¸‹ä»£ç ç¼–è¯‘ä¼šæŠ¥é”™ï¼š

```rust
fn main() {
    {
        // è¿™ä¹‹å‰ä¹Ÿæ— æ•ˆ
        let s = "123"; 
    }

    // æ— æ•ˆçš„valid
    // åœ¨ä½œç”¨åŸŸå¤–äº†
    println!("s -> {}", s)
}
```

#### 6.1.5 String typeçš„ä¾‹å­

å½“æ•°æ®å˜é‡å­˜åœ¨æ ˆä¸­çš„æ—¶å€™ï¼Œæ¯ä¸ªä½œç”¨åŸŸå½“ç»“æŸçš„æ—¶å€™ï¼Œæ ˆä¼šè¢«æ¸…ç©ºï¼Œè¿™æ ·å¦‚æœæˆ‘ä»¬åœ¨å¤šä¸ªä½œç”¨åŸŸä¸­æƒ³è¦ç”¨åˆ°åŒä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å¯èƒ½å°±éœ€è¦copyè‡ªå·±çš„ä»£ç å¤šæ¬¡ï¼Œå¦‚æœæˆ‘ä»¬çš„**æ•°æ®å­˜åœ¨å †ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¼•ç”¨çš„æ—¶å€™ï¼ŒRustä¼šè‡ªå·±å»åˆ¤æ–­ï¼Œä½•æ—¶å°†ä¸ç”¨çš„å †ä¸­çš„æ•°æ®åˆ é™¤**~

è¿™é‡Œé€šè¿‡ä¸€ä¸ª**Stringç±»å‹**çš„æ•°æ®æ¥åšåˆ†æï¼Œæ‰©å±•ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼š

+ å…ˆé€šè¿‡`String::from`æ¥å®ç°å­—ç¬¦ä¸²éœ€è¦å†…å­˜çš„è¯·æ±‚ï¼ˆå †ä¸­ï¼‰
+ é€šè¿‡`push_str`æ¥ä¸ºå¢åŠ ä¸€ä¸ªstringå­—é¢é‡åˆ°Stringä¸Š

```rust
fn main() {
    let mut s = String::from("hello");
    // é€šè¿‡push_strçš„æ–¹å¼æ¥æ‰©å±•å­—ç¬¦ä¸²çš„é•¿åº¦
    s.push_str(", world");

    println!("s -> {}", s);

    // æ²¡æœ‰å¢åŠ å­—ç¬¦ä¸²é•¿åº¦çš„åŠæ³•
    let a = "hello";
}
```

é€šè¿‡`stringå­—é¢é‡`çš„æ–¹å¼å®šä¹‰é€šå¸¸æ˜¯æ”¾åœ¨æ ˆé‡Œé¢ï¼Œå› ä¸ºæ˜¯è¿ç»­çš„ç©ºé—´ä¸€å¼€å§‹çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¸å¯å˜ï¼Œä½†æ˜¯é€šè¿‡`String`æ¥æ„é€ ï¼Œå…¶å®æ˜¯æ”¾åœ¨å †é‡Œé¢ï¼Œæ‰©å±•æ€§æ›´å¼ºï¼ŒèƒŒåå¯¹åº”çš„æ˜¯ä¸¤ç§å†…å­˜ç®¡ç†çš„æ–¹å¼ã€‚

#### 6.1.6 å†…å­˜å’Œåˆ†é…æ–¹å¼

ä»ä¸Šé¢è¿™ä¸ªä¾‹å­æˆ‘ä»¬çŸ¥é“ï¼Œç”±äºæ ˆåˆ†é…çš„å†…å­˜åœ¨ç¼–è¯‘æ—¶å€™å…¶å®æ˜¯å·²çŸ¥é•¿åº¦å’Œå†…å®¹ï¼Œç›¸å½“äºæ˜¯ç¡¬ç¼–ç å†™æ­»åœ¨ä»£ç é‡Œé¢çš„ï¼Œæ‰€ä»¥å…¶å®æ•ˆç‡æ›´é«˜ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬çœŸæ­£ä»£ç é‡Œé¢çš„åœºæ™¯ä¸ä¼šæ˜¯è¿™ä¸ªæ ·å­çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦`String`ç±»å‹æ¥å®šä¹‰å¯å˜çš„å¯ä»¥æ‰©å±•çš„æ–‡æœ¬å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨å †ä¸­å¯¹å…¶è¿›è¡Œå†…å­˜çš„åˆ†é…ï¼š

+ åœ¨è¿è¡Œæ—¶ï¼Œå†…å­˜éœ€è¦é€šè¿‡å†…å­˜åˆ†é…æœºåˆ¶æ¥è¿›è¡Œåˆ†é…
+ å½“æˆ‘ä»¬ä½¿ç”¨`String`ç±»å‹çš„æ—¶å€™å†…å­˜åˆ†é…å™¨ä¸ºæˆ‘ä»¬åˆ†é…å†…å­˜ï¼ˆåˆ©ç”¨`from`æ–¹æ³•æ¥ç”³è¯·å†…å­˜ï¼‰
+ Rustçš„GCç­–ç•¥ï¼Œå½“å˜é‡ä¸å†æ‰€å±äºå½“å‰çš„ä½œç”¨åŸŸï¼Œè¯¥å†…å­˜ä¼šè¢«è‡ªåŠ¨å›æ”¶

#### 6.1.7 æ•°æ®å˜é‡äº¤äº’æ–¹å¼â€”è½¬ç§»(move)

å¯èƒ½çœ‹è¿™ä¸ªæ ‡é¢˜æœ‰ç‚¹è¿·ç³Šï¼Œæˆ‘ä»¬æ¥çœ‹ä»£ç æŠŠï¼Œå…¶å®è®²çš„æ„æ€å°±æ˜¯**ä¸€ä¸ªç›¸åŒçš„å€¼ï¼Œåœ¨ä¸åŒçš„å˜é‡ä¸­é—´èµ‹å€¼æ¥èµ‹å€¼å»**ï¼Œå¦‚æœä¸¤è€…éƒ½æ˜¯æ ‡é‡ç±»å‹çš„è¯ï¼Œå…¶å®`x`ä¸`y`éƒ½ç­‰äº5ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ä»–ä»¬éƒ½æ˜¯æ”¾åœ¨æ ˆé‡Œé¢çš„

```rust
fn main() {
    let x = 5;
    let y = x;

    // è¿™é‡Œä¼šæ‰“å°å‡º x -> 5, y -> 5
    println!("x -> {}, y -> {}", x, y)
}
```

**ç»„åˆç±»å‹**

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ç»„åˆç±»å‹çš„æƒ…å†µï¼š

ç»„åˆç±»å‹ç»„æˆç”±ä¸‰éƒ¨åˆ†ï¼ˆä»¥Stringä¸ºä¾‹ï¼‰ï¼š

+ èµ·å§‹æŒ‡é’ˆï¼ˆptrï¼‰
+ é•¿åº¦ï¼ˆlenï¼‰
+ å®¹é‡ï¼ˆcapacityï¼‰

å½“æˆ‘å°†`s`çš„å€¼moveåˆ°`s2`çš„æ—¶å€™ï¼Œæ“ä½œä¸ºï¼š

+ å¤åˆ¶åŒæ ·ä¸€ä»½çš„`ptr`,`len`å’Œ`capacity`
+ å°†`s2`çš„æŒ‡é’ˆæŒ‡å‘å’Œ`s`åŒæ ·çš„å †æŒ‡é’ˆä½ç½®

ã€æ³¨æ„ã€‘

1. ruståœ¨è¿™é‡Œè¿™ä¸ª`move`çš„æ“ä½œä¸éœ€è¦å°†å †ä¸­çš„å†…å®¹é‡æ–°å¤åˆ¶ä¸€ä»½
2. ä¸ºäº†é¿å…é‡Šæ”¾ä¸¤æ¬¡å†…å­˜å¯èƒ½ä¼šé€ æˆçš„æŠ¥é”™ï¼Œå½“ä½¿ç”¨`move`å°†`s`èµ‹å€¼ç»™`s2`çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™`s`å°±å¤±æ•ˆäº†
3. å› ä¸ºè¿™ç§ç‰¹æ€§åœ¨è¿™ç§åœºæ™¯ä¸‹`s`çš„å€¼èµ‹å€¼ç»™äº†`s2`å…¶å®å€¼å°±`è½¬ç§»`äº†ï¼Œå› ä¸º`s`å¤±æ•ˆï¼Œè¡Œä¸ºçœ‹ä¼¼æ˜¯å¤±æ•ˆäº†`s`æµ…æ‹·è´çš„å¼•ç”¨

```rust
fn main() {
    let mut s = String::from("hello");
    s.push_str(", world");

    let s2 = s;
    // è¿™é‡Œä¼šæŠ¥é”™ï¼Œç›®å‰è¿™é‡Œçš„sæ˜¯å·²ç»è¢«å€Ÿç”¨äº†
    // borrow of moved value: `s` value borrowed here after move
    println!("s -> {}", s);
    println!("s2 -> {}", s2);
}
```

![image-20211216001514254](.\images\move.jpg)

#### 6.1.8 å˜é‡æ•°æ®äº¤äº’çš„æ–¹å¼â€”å…‹éš†ï¼ˆcloneï¼‰

åˆšæ‰è¯´çš„åœºæ™¯ï¼Œ`s2`å°†`s1`åšäº†ä¸€æ¬¡æµ…æ‹·è´ï¼Œå¹¶å°†`s1`çš„æµ…æ‹·è´å¤±æ•ˆï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æƒ³åŒæ—¶ä¿ç•™äºŒè€…ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åšæ·±æ‹·è´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`clone`æ–¹æ³•

```rust
fn main() {
    let mut s = String::from("hello");
    let s2 = s;
    let s3 = s2.clone();
    // è¿™ä¸ªæ—¶å€™ä¸ä¼šæŠ¥é”™
    print!("s2 -> {}, {}", s2, s3);
}
```

è¿™ç§æ–¹æ³•å…¶å®æ˜¯å¯¹**å †çš„æ·±æ‹·è´**ï¼Œå…·ä½“çš„ç¤ºæ„å›¾å¯ä»¥å‚è€ƒ

![image-20211216004515832](.\images\clone.jpg)

#### 6.1.9 æ ˆæ•°æ®èµ‹å€¼â€”æ‹·è´

ä»6.1.7ä¸­çš„ç¬¬ä¸€ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®æ•´å‹`x` -> `y`å€¼ä¹Ÿèµ‹å€¼äº†ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰äº§ç”Ÿ`move`è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

ç†ç”±ä¸»è¦æ˜¯ï¼šRustçš„`Copy`ç‰¹æ€§ï¼Œå¦‚æœä¸€ä¸ªç±»å®ç°äº†`Copy`ç‰¹æ€§ï¼Œè€çš„å˜é‡åœ¨è¢«èµ‹å€¼ç»™äººçš„å˜é‡æ—¶ä¼šå˜å¾—ä¸ç¨³å®šã€‚å…·ä½“åŒ…æ‹¬å“ªäº›å‘¢ï¼Ÿ

+ æ‰€æœ‰çš„æ•´å‹ç±»å‹
+ å¸ƒå°”ç±»å‹
+ æµ®ç‚¹æ•°ç±»å‹
+ å­—ç¬¦ç±»å‹
+ å…ƒç»„

è¿™äº›ç±»å‹åœ¨è¢«èµ‹å€¼çš„æ—¶å€™éƒ½ä¸ä¼šå‘ç”Ÿç±»ä¼¼`s`èµ‹å€¼ç»™`s2`ï¼Œå¯¼è‡´`s`å¤±æ•ˆè¿™ç§é—®é¢˜

#### 6.1.10 æ‰€æœ‰è€…å’Œå‡½æ•°

åœ¨å‡½æ•°ä¼ é€’å®å‚çš„æ—¶å€™ï¼Œå…¶å®æ˜¯å¯¹å‚æ•°çš„èµ‹å€¼ï¼Œæ‰€ä»¥ä¹Ÿä¼šæ»¡è¶³ä¸Šè¿°è¯´çš„æ‹·è´æ—¶å€™çš„é—®é¢˜å—ï¼Œå°±æ˜¯åŸºæœ¬ä¸Šæ‰€æœ‰åŸºç¡€ç±»å‹éƒ½ä¸ä¼šå­˜åœ¨`move`ä½†å¤æ‚ç±»å‹ä¼šå­˜åœ¨`move`çš„é—®é¢˜

```rust
fn main() {
    let s = String::from("hello");  

    takes_ownership(s);
    // è¿™é‡Œç¼–è¯‘ä¼šæŠ¥é”™
    // å› ä¸ºè¿™é‡Œå…¶å®så·²ç»è¢«å‡½æ•°å€Ÿç”¨äº†ã€
    // è¿™ä¸ªæ—¶å€™çš„så·²ç»åå­˜å®äº¡äº† å“ˆå“ˆå“ˆå“ˆ
    println!("x -> {}", s);

    let x = 5;                      
    makes_copy(x);
    // å¦‚æœè¿™é‡Œæ‰“å°xä¸ä¼šæŠ¥é”™ï¼Œå› ä¸ºæ‰€æœ‰æ•´å‹éƒ½ä¸ä¼šmove

}

fn takes_ownership(some_string: String) { // some_string comes into scope
    println!("{}", some_string);
} // Here, some_string goes out of scope and `drop` is called. The backing
  // memory is freed.

fn makes_copy(some_integer: i32) { // some_integer comes into scope
    println!("{}", some_integer);
} // Her
```

#### 6.1.11 ä½œç”¨åŸŸå’Œè¿”å›å€¼

å¦‚æœæ˜¯ç»„åˆç±»å‹å­˜åœ¨`move`çš„ä½†æ˜¯æˆ‘ä»¬ï¼Œé€šè¿‡å‚æ•°ä¼ å…¥ä¹‹åï¼ŒåŸå‚æ•°å·²å¤±æ•ˆï¼Œä½†æ˜¯åç»­è¿˜è¦ç»§ç»­ä½¿ç”¨æ€ä¹ˆåŠï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œç„¶åè§£æ„ç»§ç»­ç”¨ï¼ˆæ„Ÿè§‰è¿™ä¸ªæ“ä½œå¥½å¤šä½™ï¼Œä¸çŸ¥é“åé¢æœ‰æ²¡æœ‰å…¶ä»–çš„å¥½åŠæ³•ï¼‰

```rust
fn main() {
    let s1 = String::from("hello");

    // åˆ©ç”¨å…ƒç»„ç»“æ„æ¥ç»§ç»­ä½¿ç”¨è¿™ä¸ªs1
    let (s2, len) = calculate_length(s1);

    println!("The length of '{}' is {}.", s2, len);
}

fn calculate_length(s: String) -> (String, usize) {
    let length = s.len(); // len() returns the length of a String

    // é€ä¼ è¿”å›sï¼Œä»¥åŠè®¡ç®—çš„ç»“æ„length
    (s, length)
}
```

### 6.2 å¼•ç”¨å’Œå€Ÿç”¨

åœ¨`6.1.10`ä¸­æˆ‘ä»¬çœ‹åˆ°`s`å˜é‡å¤±æ•ˆçš„è¿™ç§åœºæ™¯ï¼Œå«åšå€Ÿç”¨ï¼Œå³è¿™ä¸ªå˜é‡ä»`s`è¢«èµ‹äºˆç»™äº†`s1`

å¼•ç”¨ç±»å‹**å…è®¸æˆ‘ä»¬åœ¨æ²¡æœ‰æ‰€æœ‰è€…**çš„æƒ…å†µä¸‹æ‹¿åˆ°éƒ¨åˆ†å€¼ï¼ˆè¿™å¥è¯å…¶å®æˆ‘æ²¡ä»ä»£ç é‡Œé¢æ‰¾åˆ°å®é™…çš„ä¾‹å­ï¼Œå¦‚æœæœ‰å¤§ä½¬çš„è¯ï¼Œå¯ä»¥ç»™æˆ‘æŒ‡ç‚¹ä¸€ä¸‹ï¼‰

å¦‚æœæˆ‘ä»¬æƒ³è¦`s1`å’Œ`s`åŒæ—¶æœ‰ç”¨å‘¢ï¼Ÿ

+ ç¬¬ä¸€ç§ä½¿ç”¨ä¹‹å‰**è¿”å›å˜é‡** + **å…ƒç»„è§£æ„**çš„åŠæ³•æ¥ç»§ç»­æ‹¿åˆ°å¦ä¸€ä¸ªå€¼ï¼ˆ*å€Ÿç”¨éœ€è¦å°†å€¼é€šè¿‡å‡½æ•°è¿”å›å€¼çš„æ–¹å¼è¿˜ç»™å˜é‡*ï¼‰
+ ä½¿ç”¨**å¼•ç”¨**ï¼Œå¼•ç”¨çš„ä½¿ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨å…³é”®å­—`&`

```rust
fn main() {
    let s1 = String::from("hello");
    let len = calculate_length(&s1);

    println!("The length of '{}' is {}", s1, len);
}

fn calculate_length (s: &String) -> usize {
    s.len()
}
```

#### 6.2.1 å¼•ç”¨çš„åŸç†

å°†å¼•ç”¨å€¼å¾—æŒ‡é’ˆæŒ‡å‘å¯¹åº”çš„å¼•ç”¨å˜é‡ï¼Œç„¶åå¼•ç”¨å˜é‡å…¶å®æ˜¯æŒ‡å‘å¯¹åº”å †ä¸­çš„å€¼çš„ï¼Œå…·ä½“çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![](.\images\heap-reference.jpg)

#### 6.2.2 å˜é‡çš„å¼•ç”¨

ä¸ä»…å‡½æ•°å¯ä»¥é€šè¿‡å¼•ç”¨çš„æ–¹å¼ï¼Œæ™®é€šå˜é‡åŸæ¥`move`çš„æ“ä½œä¹Ÿå¯ä»¥æ”¹æˆå¼•ç”¨ï¼Œè¿™ä¸ªæ—¶å€™æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. åœ¨moveçš„å˜é‡å‰ï¼Œå¢åŠ `&`ç¬¦å·å³å¯
2. è¿™ä¸ªæ—¶å€™`s2`å…¶å®å°±æ˜¯ç±»ä¼¼`s1`çš„`copy`çš„ç»“æœï¼Œä½†æ˜¯åœ¨å†…éƒ¨ä»£è¡¨çš„æ˜¯åŒä¸€ä¸ªç»“æœ
3. å˜é‡çš„å€Ÿç”¨ä¸éœ€è¦â€œè¿˜â€

```rust
fn main() {
    let mut s1 = String::from("hello");
    s1.push_str(", world");

    let s2 = &s1;
    println!("the str is {}", s2);
}
```

#### 6.2.3 å¯å˜çš„å¼•ç”¨

ç›®å‰æˆ‘ä»¬å­¦ä¹ äº†å¼•ç”¨ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³ä¸ºå¼•ç”¨å˜é‡ï¼Œè¿›è¡Œæ“ä½œï¼Œå³å¯å˜çš„å¼•ç”¨ç±»å‹æˆ‘ä»¬è¦æ€ä¹ˆåšçš„ï¼Œæ¥çœ‹ä¸ª**é”™è¯¯**çš„ä¾‹å­ï¼š

```rust
fn main() {
    let mut s1 = String::from("hello");
    add_str(&s1);
    println!("the str -> {}", s1);
}

fn add_str(s: &String) {
    // è¿™é‡Œç¼–è¯‘ä¼šæŠ¥é”™
    // å› ä¸ºé»˜è®¤è¿™é‡Œçš„sæ˜¯ä¸ªä¸å¯å˜çš„å˜é‡ï¼Œé»˜è®¤éƒ½æ˜¯ä¸å¯å˜çš„
    s.push_str("rust");
}
```

å¯å˜çš„å¼•ç”¨åªéœ€è¦åœ¨`&`åï¼Œå¢åŠ `mut`å…³é”®å­—å³å¯ï¼Œè¯·çœ‹**æ­£ç¡®çš„**ç¤ºèŒƒ:

+ åœ¨è°ƒç”¨å‡½æ•°çš„åœ°æ–¹å¢åŠ `&mut`
+ åœ¨å‡½æ•°å®šä¹‰æ—¶å¢åŠ `&mut`
+ åŒæ—¶åªèƒ½è¢«å¼•ç”¨ä¸€æ¬¡

```rust
fn main() {
    let mut s1 = String::from("hello");

    add_str(&mut s1);

    println!("s1 -> {}", s1);

}

fn add_str(s: &mut String) {
    s.push_str(", rust");
}
```

#### 6.2.4 åªèƒ½æœ‰ä¸€æ¬¡å¼•ç”¨

è¿™ä¸ªåœ°æ–¹å…¶å®æ˜¯å’Œå˜é‡çš„å¼•ç”¨åœ¨æ–‡ä¸­æ˜¯ä¸€ç« ï¼Œä½†æ˜¯æ¯”è¾ƒå®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥å•ç‹¬å†™ä¸€ä¸‹ï¼Œåœ¨ä½¿ç”¨å¼•ç”¨çš„æ—¶å€™æœ‰ä¸€ä¸ªé‡è¦çš„è§„åˆ™**å¯¹ä¸€ä¸ªæ•°æ®åœ¨åŒä¸€æ—¶é—´ï¼ˆä½œç”¨åŸŸï¼‰åªèƒ½æœ‰ä¸€ä¸ªå¯å˜çš„å¼•ç”¨**ï¼Œä¸ç„¶ä¸ç¬¦åˆè¿™ä¸ªè§„åˆ™ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œç¼–è¯‘è¿‡ä¸äº†ã€‚ï¼ˆç›®å‰æˆ‘çš„ç†è§£æ˜¯`mut`çš„å˜é‡åªèƒ½å¼•ç”¨ä¸€æ¬¡ï¼Œå€Ÿå‡ºå»å°±æ²¡äº†ï¼‰

è¿™ç§ç­–ç•¥æ˜¯ä¸ºäº†è®©å¯å˜æ€§éå¸¸å¯æ§ï¼Œä¸ºäº†é¿å…ä¸€ä¸‹å‡ ä¸ªè¡Œä¸ºï¼š

+ è¶…è¿‡ä¸¤ä¸ªæŒ‡é’ˆåœ¨åŒæ—¶æ¥å…¥ä¸€ä¸ªç›¸åŒçš„æ•°æ®ï¼ˆå¤„ç†å¹¶å‘é—®é¢˜ï¼‰
+ è¶…è¿‡ä¸€ä¸ªæŒ‡é’ˆæ‰§è¡Œå†™æ“ä½œ
+ æ²¡æœ‰åŒæ­¥æ¥å…¥æ•°æ®çš„æœºåˆ¶

```rust
fn main() {
    let mut s1 = String::from("hello");
    s1.push_str(", world");
    let mut s4 = &mut s1;
    s4.push_str(", rust");

    // è¿™é‡Œçš„s1ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™çš„ç†ç”±å°±æ˜¯s1æ˜¯ä¸å¯å˜çš„å˜é‡ï¼Œmutå·²ç»è¢«å‡ºå€Ÿäº†
    // println!("The length of '{}' is {}", s1, len);
    // è¿™é‡Œèƒ½çœ‹åˆ°hello world rust
    println!("the str -> {}", s4);
}
```

**å¦‚ä½•å¤„ç†è¿™ç§éœ€è¦å¤šä¸ªmutçš„åœºæ™¯å‘¢ï¼Ÿ**

æ ¹æ®æ‰€æœ‰è€…çš„è§„åˆ™ï¼Œåªè¦åœ¨ä¸åŒçš„å‡ ä¸ªä½œç”¨åŸŸå³å¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·å®‰æ’ä»£ç 

```rust
fn main() {
    let mut s1 = String::from("hello");

    // å¦‚æœå†™åœ¨è¿™é‡Œï¼Œmut s4çš„åœ°æ–¹å°±ä¼šæŠ¥é”™
    // å› ä¸º&mut s1è¿™é‡Œå·²ç»è¢«å‡ºå€Ÿäº†
    // let mut s2 = &mut s1;
    {
        // å†™åœ¨ç‹¬ç«‹çš„ä½œç”¨åŸŸé‡Œé¢å°±ä¸ä¼šæŠ¥é”™
        let s2 = &mut s1;
        println!("s2 -> {}", s2);
    }

    let mut s4 = &mut s1;
    // println!("the str is {}, {}", s2, s4);

    println!("the str -> {}", s4);
}
```

å¦å¤–ï¼Œå¦‚æœæ˜¯é`mut`çš„å¤šä¸ªå¼•ç”¨ï¼Œåœ¨rustä¸­æ˜¯å¯ä»¥è¢«æ¥å—çš„ï¼Œä½†æ˜¯è¦æ³¨æ„æ˜¯åœ¨å“ªé‡Œç”¨çš„ï¼Œ**å¦‚æœæœ€åä¸€æ¬¡è°ƒç”¨å®Œï¼Œå¯¹åº”çš„å¼•ç”¨è¢«å›æ”¶äº†ï¼Œé‚£ä¹ˆå†å»èµ‹å€¼å…¶å®æ˜¯ä¸ä¼šæŠ¥é”™çš„**ï¼Œè¿™ä¸ªå¾ˆé‡è¦æˆ‘ä»¬ç»“åˆä¾‹å­çœ‹ä¸‹ï¼š

æˆ‘ç†è§£çš„è§„åˆ™ï¼š

1. ~~å¦‚æœ`mut`å¼•ç”¨åˆ›å»ºæ—¶ï¼Œè¿˜æœ‰å¼•ç”¨æ²¡è¢«æ”¶å›ä¸å…è®¸å‡ºå€Ÿ~~
2. ~~æœ‰äº†`mut`å¼•ç”¨ä¸å…è®¸å…¶ä»–å‡ºå€Ÿ~~
3. ä½¿ç”¨å±€éƒ¨ä½œç”¨åŸŸï¼Œåˆ©ç”¨`æ‰€æœ‰è€…è§„åˆ™`å¯ä»¥é¢å¤–å‡ºå€Ÿ

```rust
fn main() {
    let mut s1 = String::from("hello");

    let s2 = &s1;
    let s3 = &s1;
    // å¦‚æœprintåœ¨è¿™é‡Œæ˜¯ä¸ä¼šæŠ¥é”™çš„
    // å› ä¸ºè¿™é‡Œprintæ˜¯s2å’Œs3æœ€åè¢«ä½¿ç”¨çš„
    // æ‰€ä»¥ä½¿ç”¨å®Œs2, s3ä¼šè¢«å›æ”¶ï¼Œåé¢
    // å†å‡ºå€Ÿmutçš„s1æ˜¯å¯ä»¥çš„
    println!("the str is {}, {}", s2, s3);

    let mut s4 = &mut s1;
    // å¦‚æœprintåœ¨è¿™é‡Œæ˜¯ä¸å…è®¸å‡ºå€Ÿçš„
    // å› ä¸ºs2å’Œs3è¿˜æ˜¯å‡ºå€ŸçŠ¶æ€ï¼Œs1è¢«s2å’Œs3æŒ‡å‘ï¼Œè¿™ä¸ªæ—¶å€™ä¸å…è®¸å‡ºå€Ÿ
    // println!("the str is {}, {}", s2, s3);
    println!("the str -> {}", s4);
}
```

#### 6.2.5 æ‚¬æ‘†çš„å¼•ç”¨

å‡½æ•°æ²¡æœ‰å¿…è¦è¿”å›ä¸€ä¸ªæ— æ•ˆçš„å¼•ç”¨å€¼ï¼Œè¿™ä¸ªåœ°æ–¹å…¶å®æˆ‘ç†è§£å®˜æ–¹çš„æ„æ€å°±æ˜¯ï¼Œå› ä¸ºå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæˆ‘ä»¬çš„ä½œç”¨åŸŸå†…çš„å˜é‡ä¼šé”€æ¯ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¦‚æœä½¿ç”¨å¼•ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯**å¼•ç”¨æ˜¯æœ‰æ•ˆçš„**ï¼Œå¦‚æœè¿™ä¸ªåŸå¼•ç”¨é”€æ¯äº†ï¼Œé‚£å°±ä¸æ˜¯æœ‰æ•ˆçš„ï¼Œæ‰€ä»¥ç¼–è¯‘æ—¶å€™ä¼šæŠ¥é”™ï¼š

```rust
fn dangle() -> &String {
    let s = String::from("hello");

    // è¿™é‡Œä¼šæŠ¥é”™
       &s
}

// æ­£ç¡®å†™æ³•
fn dangle() -> String {
    let s = String::from("hello");

    s
}
```

**å®˜æ–¹çš„å¼•ç”¨è§„åˆ™**

+ ä»»ä½•æ—¶å€™åªèƒ½æœ‰ä¸€ä¸ª`mut`çš„å¼•ç”¨å’Œè‹¥å¹²ä¸ª`immutable`çš„å¼•ç”¨
+ å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„

### 6.3 åˆ‡ç‰‡ç±»å‹

åˆ‡ç‰‡ç±»å‹æ˜¯å¦ä¸€ç§ä¸éœ€è¦æ‰€æœ‰è€…çš„æ•°æ®ç±»å‹ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿ç»­å†…å­˜çš„ä¸€æ®µè¿ç»­çš„æ•°æ®ä¸­ï¼Œè¯»å–ä¸€éƒ¨åˆ†æ•°æ®æ‰€ç”¨çš„ã€‚

æˆ‘ä»¬å…ˆåœ¨æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœéœ€è¦è·å–ä¸€å¥è¯ä¸­ç¬¬ä¸€ä¸ªå•è¯ç»“å°¾çš„ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦æ€ä¹ˆæ“ä½œå‘¢ï¼Œå¾ˆç®€å•ï¼Œå¯ä»¥é€šè¿‡**éå†**çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹éå†çš„ä»£ç ï¼š

ã€ä»£ç æ€è·¯æ¢³ç†ã€‘ï¼š

1. éå†æ‰€æœ‰å­—ç¬¦ä¸²
2. å­—ç¬¦ä¸²ä¸º" "çš„æ—¶å€™è¾“å‡ºå¯¹åº”çš„ç´¢å¼•å€¼

ã€å…³é”®ä»£ç æ¢³ç†ã€‘ï¼š

1. `first_word`è¿™ä¸ªå‡½æ•°ä¸éœ€è¦æ‰€æœ‰è€…ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨`å¼•ç”¨ç±»å‹`å°±å¥½

2. `as_bytes`å…¶ç”¨æ³•çš„æ„æ€å°±æ˜¯ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå˜ä¸ºå­—ç¬¦çš„åˆ‡ç‰‡ï¼Œå³è¿™é‡Œä¼šå¾ªç¯ä¸€ä¸ªæ•°ç»„
   
   > Returns a byte slice of this `String`'s contents.

3. éå†æ•°ç»„çš„æ–¹æ³•ï¼Œåˆ©ç”¨è¿­ä»£å™¨æ¥å®ç°ï¼Œè¿­ä»£å™¨çš„ä½¿ç”¨æ–¹æ³•æ˜¯`.iter().enumerate()`å³å¯å®ç°è¿­ä»£å™¨ï¼Œä¸€ä¸ªä¸€ä¸ªè¾“å‡ºå¯¹åº”çš„å€¼ï¼Œç±»ä¼¼`next`

```rust
fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&s); // word will get the value 5
    println!("word -> {}", word);

    // ä½¿ç”¨å®Œæˆä¹‹åï¼Œå°†å¯¹åº”çš„å­—ç¬¦ä¸²ç½®ä¸ºç©º
    s.clear(); 
}

fn first_word(s: &String) -> usize {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }

    s.len()
}
```

**æ€è€ƒ**ï¼šé€šè¿‡ä¸Šè¿°æ–¹æ³•æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¸ªæ—¶å€™éœ€è¦è·å–ç¬¬äºŒç¬¬ä¸‰ä¸ªå•è¯çš„ç´¢å¼•ï¼Œé‚£å…¶å®è¿™ä¸ªæ–¹æ³•ä¼šè¶Šæ¥è¶Šå†—é•¿å’Œå¤æ‚ï¼Œå…¶å®æƒ³æƒ³åœ¨JSä¸­å¦‚æœæˆ‘ä»¬è¦æ‰¾åˆ°ç¬¬äºŒç¬¬ä¸‰ä¸ªå•è¯æ€ä¹ˆåŠï¼Œé€šè¿‡`"  "`æ¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œåˆ‡å‰²å³å¯~ï¼Œæ‰€ä»¥å…¶å®Rustä¹Ÿæœ‰è¿™ç§åˆ‡ç‰‡ç±»å‹çš„æ¦‚å¿µ

#### 6.3.1 å­—ç¬¦ä¸²åˆ‡ç‰‡

å›å¿†ä¸‹ä¹‹å‰ï¼ŒåšçŒœæ•°å­—æ¸¸æˆçš„æ—¶å€™çš„Rangeçš„ä½¿ç”¨æ–¹æ³•`[1..3]`ä»£è¡¨ä»1~3çš„åŒºé—´ï¼Œå…¶å®è¿™å°±æ˜¯åˆ‡ç‰‡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç ï¼Œé€šè¿‡`..`è¿™ç§æ–¹å¼ï¼Œæ¥è·å–åŒºåŸŸä¸­çš„`[0, 5)`è¿™ä¸ªåŒºé—´å†…çš„æ‰€æœ‰å­—ç¬¦ï¼Œå…·ä½“å¯ä»¥ç¿»è¯‘æˆJSä¸­çš„`a.slice(0, 5)`

```rust
fn main() {
    let mut s = String::from("hello world");
    let hello = &s[0..5];
    let world = &s[6..11];

    println!("hello -> {}, world -> {}", hello, world); 
}
```

![](.\images\slice.jpg)

**æ³¨æ„ç‚¹**

1. ä½¿ç”¨åˆ‡ç‰‡ç±»å‹ï¼Œç›®å‰ç®€å†™ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œå’Œåˆ‡ç‰‡åˆ°æœ«å°¾å¯ä»¥é€šè¿‡ç®€å†™çš„æ–¹æ³•
   
   ```rust
   fn main() {
       let mut s = String::from("hello world");
   
       let hello = &s[..5];
       let world = &s[6..];
   
       println!("hello -> {}, world -> {}", hello, world);
   }
   ```

2. å­—ç¬¦ä¸²ç±»å‹åˆ‡ç‰‡ä¹‹åçš„ç±»å‹å˜ä¸ºäº†`&str`è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬éœ€è¦æ³¨æ„ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¹‹å‰çš„`first_word`å‡½æ•°å¦‚ä¸‹
   
   ```rust
   // è¿™é‡Œå‡½æ•°çš„è¿”å›å€¼éœ€è¦æ˜¯&str
   fn first_word(s: &String) -> &str {
       let bytes = s.as_bytes();
   
       for (i, &item) in bytes.iter().enumerate() {
           if item == b' ' {
               return &s[0..i];
           }
       }
   
       &s
   }
   ```

3. å¼•ç”¨ç±»å‹åœ¨è¢«ä½¿ç”¨ä¹‹å‰å…¶æ‰€æœ‰è€…å¿…é¡»å­˜åœ¨
   
   ```rust
   fn main() {
       let mut s = String::from("hello world");
   
       // è¿™ä¸ªfirst_wordæ˜¯2ä¸­çš„æ–¹æ³•
       let word = first_word(&s); // word will get the value 5
       // å¦‚æœclearåœ¨è¿™é‡Œï¼Œé‚£ä¹ˆå› ä¸ºåé¢wordä½¿ç”¨çš„æ˜¯sçš„å¼•ç”¨
       // æ‰€ä»¥åœ¨è¿™é‡Œæ¸…ç©ºåså°±æ²¡æœ‰å€¼äº†
       // å› æ­¤ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™
       // s.clear();
       println!("word -> {}", word);
       s.clear(); 
   }
   ```

ã€æ€è€ƒã€‘

`æ³¨æ„ç‚¹3`ä¸­ï¼Œæˆ‘è§‚å¯Ÿåˆ°æŠ¥é”™æ˜¯ï¼šmutç±»å‹ä¸èƒ½å‡ºå€Ÿç»™immutableç±»å‹ï¼Œæ‰€ä»¥æˆ‘å°±åœ¨æƒ³ï¼Œéš¾é“æˆ‘æ”¹äº†ä¸€æ³¢ç±»å‹ï¼Œè¿™ä¸ªåœ°æ–¹è¿™ç§å¥‡æ€ªçš„é—®é¢˜å°±èƒ½è¢«ç»•è¿‡äº†å—~æ‰€ä»¥æˆ‘è¿›è¡Œäº†ç±»å‹çš„é­”æ”¹

```rust
fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&mut s); // word will get the value 5
    //
    s.clear(); 
    println!("word -> {}", word);

}

fn first_word(s: &mut String) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[0..i];
        }
    }

    s
}
```

ä½†æ˜¯å…¶å®æˆ‘ä»¬å‘ç°è¿™é‡Œè¿˜æ˜¯æŠ¥é”™çš„ï¼Œ`cannot borrow `s` as mutable more than once at a time`å› ä¸ºå…¶å®è¿™ä¸ªåœ°æ–¹çœ‹åˆ°clearå®šä¹‰çš„æ—¶å€™ï¼Œæ˜¯`&self`æ˜¯ä¸€ä¸ª`mut`ç±»å‹ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬å…¶å®æ˜ç™½äº†ï¼Œä¸€ä¸ªå˜é‡æœ€å¤šåˆ›é€ ä¸€ä¸ª`mut`ç±»å‹çš„å¼•ç”¨ï¼Œå…¶å®è¿˜æ˜¯è¢«è§„åˆ™æ‹¦ä½äº†!!

![image-20211218141749542](.\images\clear.png)

#### 6.3.2 Stringå­—é¢é‡åˆ‡ç‰‡

åˆšæ‰`6.3.1`ä¸­çš„åˆ‡ç‰‡æŒ‡çš„æ˜¯é€šè¿‡`String`ç±»æ¥è¿›è¡Œæ„é€ çš„ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯é€šè¿‡`String`å­—é¢é‡æ¥è¿›è¡Œæ„é€ çš„å‘¢ï¼Ÿä¼šå‘ç”Ÿä»€ä¹ˆäº‹å‘¢ï¼Ÿæˆ‘ä»¬æ¥ä¸‹å»æ¥çœ‹~

å­—ç¬¦ä¸²å­—é¢é‡ï¼Œç°åœ¨å…¶å®ç±»å‹æ˜¯`&str`çš„å¼•ç”¨ï¼Œæ‰€ä»¥å…¶å®,å¯¹å­—é¢é‡å®šä¹‰çš„åˆ‡ç‰‡ï¼Œæ˜¯å¯¹å…¶**å¼•ç”¨çš„åˆ‡ç‰‡**ï¼Œå½“ç„¶å­—é¢é‡çš„åˆ‡ç‰‡ä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå¯ä»¥çœ‹`get_word`è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä½œä¸ºåˆ‡ç‰‡æ¥å—å‚æ•°ï¼Œå‚æ•°çš„ç±»å‹ä¸º`&str`

```rust
fn main() {
    let mut s2 = "Hello World";
    s2 = "Rust Hello World";

    let s3 = &s2[..5];
    let s4 = get_word(&s2[..11]);

    println!("s3 -> {}, s4 -> {}", s3, s4); // s3 -> Rust , s4 -> Rust
}

fn get_word(s: &str) -> &str {
    let bytes = s.as_bytes();

    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    s
}
```

#### 6.3.3 å…¶ä»–åˆ‡ç‰‡

å…¶ä»–åˆ‡ç‰‡ä¾‹å¦‚æ•°ç»„çš„åˆ‡ç‰‡å…¶å®ä¹Ÿä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å…¶è¿›è¡Œå¼•ç”¨åˆ‡ç‰‡å³å¯~

```rust
fn main () {
    let a = [1, 2, 3, 4, 5];
    let slice = &a[1..3];
}
```

### 6.4 æ€»ç»“

æœ¬ç« å­¦ä¹ äº†æ‰€æœ‰è€…ï¼Œå€Ÿç”¨åˆ‡ç‰‡çš„æ¦‚å¿µï¼Œç¡®ä¿äº†åœ¨rustç¼–è¯‘è¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚åŒæ—¶ä¹Ÿæ¢³ç†äº†ä¸€ä¸‹rustçš„å†…å­˜ç®¡ç†æ§åˆ¶å’Œä½¿ç”¨ï¼Œä»¥åŠä¸å…¶ä»–è¯­è¨€åœ¨å†…å­˜ç®¡ç†ä¸Šçš„åŒºåˆ«ã€‚æ‰€æœ‰è€…çš„å½±å“rustä»£ç çš„è¿è¡Œï¼Œæ˜¯è´¯ç©¿éåŠæ•´ä¸ªrustå­¦ä¹ è€…ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¥½å¥½ç†è§£

## 7. ä½¿ç”¨Structsæ¥ç»“æ„åŒ–ç›¸å…³æ•°æ®

### å†™åœ¨å‰é¢

ç»“æ„ä½“æ•°æ®ç±»ä¼¼é¢å‘å¯¹è±¡ä¸­çš„å¯¹è±¡ï¼Œå°†å¤šä¸ªæœ‰æ„ä¹‰çš„å­—æ®µä¸”ç›¸å…³çš„æ•°æ®èšåˆåœ¨ä¸€èµ·ã€‚æœ¬ç« å°†å¯¹æ¯”å…ƒç»„å’Œç»“æ„ä½“ï¼Œæˆ‘ä»¬å°†ç¤ºèŒƒï¼Œå¦‚ä½•å®šä¹‰å’Œä½¿ç”¨ç»“æ„ä½“ï¼Œå°†å®šä¹‰ä¸€ç³»åˆ—æœ‰å…³è”çš„å‡½æ•°ï¼ˆç‰¹åˆ«æ˜¯å…¶ä¸­ä¸€äº›ç›¸å…³è”çš„å‡½æ•°ï¼Œç§°ä¸ºæ–¹æ³•ï¼‰ï¼Œæ¥è¯´æ˜å…¶ä¸ä¸€ä¸ªç»“æ„ä½“ç±»å‹ä¹‹é—´çš„å…³ç³»ã€‚å¦å¤–ï¼Œç»“æ„ä½“å’Œæšä¸¾å€¼å¯ç”¨äºåˆ›å»ºåœ¨æˆ‘ä»¬ä»£ç ä¸­ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œè¿™æ ·ä¾¿äºåœ¨Rustç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œç±»å‹æ£€éªŒã€‚

### 7.1 å®šä¹‰å’Œä½¿ç”¨ç»“æ„ä½“çš„ä¾‹å­

#### 7.1.1 å®šä¹‰å’Œç®€å•ä½¿ç”¨

**å¯¹æ¯”å…ƒç»„**ï¼šç›¸æ¯”è¾ƒå…ƒç»„ï¼Œå…ƒç»„çš„æ¯ä¸€é¡¹çš„ç±»å‹ç¡®å®å¯ä»¥ä¸åŒï¼Œä½†æ˜¯ä½ **å¹¶ä¸èƒ½å¾ˆç›´è§‚çš„æ˜ç™½æ¯ä¸€é¡¹ç±»å‹å¯¹åº”æ•°æ®èƒŒåçš„æ„ä¹‰**ï¼Œè€Œç»“æ„å¯ä»¥è®©ä½ ç»™**æ¯ä¸€ä¸ªæ•°æ®å‘½å**ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¾ˆæ˜ç™½æ¯ä¸€ä¸ªæ•°æ®å®ƒå®é™…è¡¨ç¤ºçš„æ„ä¹‰ã€‚

**å®šä¹‰æ–¹å¼**ï¼šä½¿ç”¨`struct`å…³é”®å­—ï¼Œä¹‹åè·Ÿä¸Šå¯¹åº”çš„ç±»å‹çš„åç§°ï¼Œä¹‹åé€šè¿‡`{}`æ¥è§„å®šç»“æ„ä½“ä¸­æ‹¥æœ‰å‚æ•°çš„ç±»å‹ï¼Œå…¶å®å’Œ`typescript`ä¸­çš„`interface`å®šä¹‰æœ‰ç‚¹åƒï¼Œåªä¸è¿‡æ˜¯æŠŠ`interface` æ”¹æˆäº†`struct`

**ä½¿ç”¨å§¿åŠ¿**ï¼šåˆ›å»ºå¯¹åº”ç»“æ„ä½“çš„å®ä¾‹ï¼Œå…¶æ–¹æ³•æ˜¯éœ€è¦æŒ‡å‡ºå…·ä½“æ¯ä¸ªå‚æ•°çš„å€¼ã€‚åˆ›å»ºå®ä¾‹çš„è¿‡ç¨‹ï¼šï¼ˆ1ï¼‰å£°æ˜ç»“æ„ä½“çš„åç§°ï¼ˆ2ï¼‰åœ¨å¤§æ‹¬å·ä¸­é€šè¿‡`key: value`é”®å€¼å¯¹çš„æ–¹å¼æ¥å®šä¹‰å·²ç»å­˜åœ¨ä¸`struct`å£°æ˜ä¸­çš„`key`å¹¶å¡«å……ç¬¦åˆå…¶ç±»å‹çš„å€¼ï¼ˆ3ï¼‰æˆ‘ä»¬åˆ›å»ºç»“æ„ä½“åæˆ‘ä»¬åªå…³å¿ƒè¿™ä¸ªåç§°çš„å€¼æƒ³å­˜åœ¨è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œè€Œä¸å…³å¿ƒå…¶å­˜å‚¨çš„é¡ºåº

**å‚æ•°ä½¿ç”¨**ï¼šå¦‚æœæˆ‘ä»¬éœ€è¦ä»ç»“æ„ä½“ä¸­è·å–ç›¸å…³çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`.`è¯­æ³•ï¼Œæ”¹å˜è§£æ„ä½“çš„å‚æ•°ä¸»è¦éœ€è¦æœ‰ä¸¤æ­¥ï¼šï¼ˆ1ï¼‰è®¾ç½®å¯¹åº”çš„ç»“æ„ä½“ä¸º`mut`ç±»å‹ï¼ˆ2ï¼‰ä½¿ç”¨`.`è¯­æ³•æ¥å°†å¯¹åº”çš„ç»“æ„ä½“é‡æ–°èµ‹å€¼

**æ³¨æ„ç‚¹**ï¼šå¦‚æœæˆ‘ä»¬éœ€è¦æ”¹å˜ä¸€ä¸ªè§£æ„ä½“ä¸­çš„æŸä¸€é¡¹ï¼Œé‚£ä¹ˆä»–ä¸€å®šæ˜¯æ•´ä¸ªç»“æ„ä½“æ˜¯å¯å˜çš„ï¼ŒRustä¸å…è®¸æˆ‘ä»¬åªè®©å…¶ä¸­å‡ é¡¹æ˜¯å¯å˜çš„ï¼Œè€Œæ•´ä¸ªç»“æ„ä½“æ˜¯ä¸å¯å˜çš„ï¼Œè¿™ä¸ªå’ŒJSæœ‰å¾ˆå¤§çš„ä¸ä¸€æ ·

```rust
// ç»“æ„ä½“çš„å®šä¹‰
struct User{
    active: bool,
    username: String,
    age: u32,
    email: String
}

fn main() {
    // ä½†æ˜¯æ¯”è¾ƒå¥‡æ€ªçš„æ˜¯
    // è¿™é‡Œæ„é€ çš„Userè¿™ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯é‡Œé¢çš„attrç«Ÿç„¶ç¼–è¾‘å™¨é‡Œé¢
    // æ²¡æœ‰ä»£ç æç¤º
    // ç»“æ„ä½“çš„ä½¿ç”¨
    let mut user = User {
        active: true,
        username: String::from("Tom"),
        email: String::from("tom@163.com"),
        age: 18
    };

    user.email = String::from("loveJerry@163.com");

    // è·å–è§£æ„ä½“ä¸­å…·ä½“çš„å€¼
    println!("user email -> {}", user.email) // user email -> loveJerry@163.com
}
```

#### 7.1.2 åˆ©ç”¨å‡½æ•°ä¾¿æ·åˆ›å»ºç»“æ„ä½“å®ä¾‹

å½“æˆ‘ä»¬ä¸€ä¸ª**ç»“æ„ä½“ä¸­æœ‰å¾ˆå¤šç›¸åŒå­—æ®µçš„å€¼ï¼ˆæŒ‡çš„æ˜¯èµ‹å€¼ï¼‰**ï¼Œ**ä½¿ç”¨å­—æ®µåˆå§‹åŒ–çš„æ„é€ å‡½æ•°çš„æ–¹å¼**ï¼Œä¼šæ›´åŠ æ–¹ä¾¿ã€‚è¿™ä¸ªè¯­æ³•å…¶å®ç›®å‰å’ŒJSä¸­çš„å¯¹è±¡å‚æ•°çš„çœç•¥å†™æ³•æ˜¯ç›¸åŒçš„ã€‚

Rustä¹Ÿæ”¯æŒæˆ‘ä»¬ä½¿ç”¨ç±»ä¼¼ä¸€ä¸ªæ„é€ å‡½æ•°çš„æ–¹å¼æ¥åˆ›å»ºä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹ã€‚

ï¼ˆ1ï¼‰è¿™ç§åœºæ™¯é€‚åˆæˆ‘ä»¬éœ€è¦æ‰¹é‡åˆ›å»ºä¸€äº›å®ä¾‹ï¼Œä½†æ˜¯å…¶ä¸­æœ‰å¾ˆå¤šå€¼å…¶å®æ˜¯**é»˜è®¤æˆ–è€…è®©å¯ä»¥å¤ç”¨**çš„åœºæ™¯ï¼Œè¿™ç§åœºæ™¯ä¸‹æ˜¯ä¸€ç§æ›´åŠ ä¾¿æ·çš„æ–¹å¼ã€‚

ï¼ˆ2ï¼‰å½“å‚æ•°åå’Œéœ€è¦ä¼ å…¥è§£æ„ä½“ä¸­çš„å‚æ•°çš„åæ˜¯ç›¸åŒçš„æ—¶å€™ï¼Œå¯ä»¥`email: email`çš„æ­¥éª¤ï¼Œç›´æ¥åœ¨ç»“æ„ä½“ä¸­èµ‹å€¼é€šè¿‡`email`å³å¯

å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š

```rust
struct User{
    active: bool,
    username: String,
    age: u32,
    email: String,
    sign_in_count: u32
}

fn main() {
    let jerry = build_user(String::from("jerry"), 18, String::from("jerry@163.com"));
    println!("jerry name -> {}, jerry email -> {}", jerry.username, jerry.email);
}

fn build_user(name: String, age: u32, email: String) -> User {
    User {
        // ä½¿ç”¨å‚æ•°èµ‹å€¼çš„ç®€å†™æ–¹å¼
        username,
        email,
        age,
        active: true,
        sign_in_count: 1
    }
}
```

é€šè¿‡ä¸Šè¿°çš„æ–¹å¼ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`User`è§£æ„ï¼Œæˆ‘ä»¬åªéœ€è¦ä¼ å…¥`name`ï¼Œ`age`å’Œ`email`å­—æ®µå³å¯

#### 7.1.3 ä½¿ç”¨Struct Updateè¯­æ³•æ¥ä»åˆ«çš„ç»“æ„ä½“åˆ›å»ºæ–°çš„ç»“æ„ä½“

è¿™ä¸ªè¯­æ³•å…¶å®å’ŒJSä¸­çš„æ‰©å±•è¿ç®—ç¬¦çš„è¯­æ³•æ˜¯ç›¸åŒçš„ï¼Œè¿™é‡Œä½¿ç”¨çš„è¯­æ³•æ˜¯`..`(è¿™é‡Œæ˜¯ä¸¤ä¸ªç‚¹å“ˆ~JSé‡Œé¢æ˜¯3ä¸ªç‚¹)ï¼Œä½†æ˜¯ä»–è¿™é‡Œå†™åœ¨å‰é¢çš„`key`ä»–çš„ä¼˜å…ˆçº§ä¼šæ›´é«˜ã€‚

**æ³¨æ„ç‚¹**

1. é™¤äº†æ²¡æœ‰ä½¿ç”¨åˆ°çš„å­—æ®µï¼Œå…¶ä»–å­—æ®µéƒ½æ˜¯ä»`jerry`å€Ÿç”¨åˆ°`Dog`çš„ï¼Œå…¶ç­‰åŒäº`=`
2. å› ä¸ºå­—æ®µæ˜¯å€Ÿç”¨çš„ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¿™ç§æ›´æ–°è¯­æ³•åï¼Œè°ƒç”¨`jerry.email`ï¼ˆæ‰€æœ‰è¿™äº›å·²ç»å€Ÿç”¨å‡ºå»çš„å­—æ®µï¼‰ï¼Œruståœ¨ç¼–è¯‘çš„æ—¶å€™å°±ä¼šæŠ¥é”™

```rust
struct User{
    active: bool,
    username: String,
    age: u32,
    email: String,
    sign_in_count: u32
}

fn main() {
    let jerry = build_user(String::from("jerry"), 18, String::from("jerry@163.com"));

    let dog = User {
        // è¿™é‡Œusernameå†™åœ¨å‰é¢ï¼Œæ‰€ä»¥usernameç”¨çš„æ˜¯Dog
        // å…¶ä»–çš„éƒ½æ˜¯å€Ÿç”¨jerryçš„
        username: String::from("Dog"),
        ..jerry
    };
    // è¿™é‡Œä¼šæŠ¥é”™ï¼Œå¦‚æœæ‰“å¼€æ³¨é‡Šçš„è¯
    // å› ä¸ºè¿™é‡Œé™¤äº†usernameï¼Œå…¶ä»–å­—æ®µéƒ½ä»jerry -> dogæ˜¯ä¸ªmoveçš„è¿‡ç¨‹
    // println!("jerry name -> {}, jerry email -> {}", jerry.username, jerry.email);

    // dog name -> Dog, dog email -> jerry@163.com
    println!("dog name -> {}, dog email -> {}", dog.username, dog.email);
}

fn build_user(username: String, age: u32, email: String) -> User {
    User {
        username,
        email,
        age,
        active: true,
        sign_in_count: 1
    }
}
```

#### 7.1.4 æ²¡æœ‰å‘½åçš„å…ƒç»„è§£æ„æ¥åˆ›å»ºå¤šç§ç±»å‹

**å®šä¹‰**ï¼šé€šè¿‡å…ƒç»„å®šä¹‰çš„ç»“æ„ä½“ç±»å‹ï¼Œå…¶ç§°ä¸ºå…ƒç»„ç»“æ„ã€‚

**ä½œç”¨**ï¼šå…ƒç»„ç»“æ„ç”±äºæ²¡æœ‰å¯¹æ¯ä¸ªå­—æ®µè¿›è¡Œå‘½åï¼Œå…¶ä¸€èˆ¬ç”¨æ¥å¯¹**æ•´ä¸ª**å…ƒç»„ç±»å‹ä¸€ä¸ªå‘½åï¼Œæ¥åŒºåˆ†ä¸åŒçš„å…ƒç»„ç±»å‹ï¼Œé€šè¿‡æ•´ä¸ª**ç»“æ„ä½“ç»´åº¦**ï¼Œè€Œä¸æ˜¯**å­—æ®µç»´åº¦**ã€‚

**å®šä¹‰æ–¹æ³•**ï¼šé€šè¿‡`struct`å…³é”®å­—ã€`ç»“æ„ä½“åç§°`(è·Ÿåœ¨structå…³é”®è¯å)ã€å…ƒç»„å®šä¹‰ä¸‰éƒ¨åˆ†ç±»å®šä¹‰ã€‚

**ä½¿ç”¨å§¿åŠ¿**ï¼š

ã€å®ä¾‹åŒ–ã€‘ä½¿ç”¨`ç»“æ„å` + `()`ä¼ å‚çš„æ–¹å¼å®ä¾‹åŒ–

ã€è·å–å€¼ã€‘é€šè¿‡`.`è¯­æ³•ï¼Œå’Œå…ƒç»„å–æ•°ä¸€æ ·

ã€è§£æ„æ–¹æ³•ã€‘éœ€è¦ä½¿ç”¨Structæ¥è¿›è¡Œè§£æ„ï¼Œç›´æ¥çœ‹ä¾‹å­æŠŠï¼Œæˆ‘æ„Ÿè§‰æˆ‘ç”¨è¯­è¨€å½¢å®¹ä¸å‡ºæ¥

```rust
struct Color(i32, i32, i32);
struct Point(i32, i32, i32);

fn main() {
    let black = Color(0, 0, 0);
    let white = Color(255, 255, 255);

    // éœ€è¦é€šè¿‡è¿™ç§æ–¹å¼è§£æ„
    let Color(black_r, black_g, black_b) = black;

    let origin = Point(0, 0, 0);
    // ä¹Ÿå¯ä»¥ä½¿ç”¨.å…³é”®å­—æ¥è°ƒç”¨å¯¹åº”å…ƒç»„ä¸­çš„å€¼
    let x = origin.0;

    println!("r -> {}, g -> {}, b -> {}", black_r, black_g, black_b); // r -> 0, g -> 0, b -> 0
}
```

#### 7.1.5 æ²¡æœ‰ä»»ä½•å­—æ®µçš„å•ä½ç»“æ„ä½“

**å®šä¹‰**ï¼šå…¶å®è®²çš„å°±æ˜¯ï¼Œ**ä¸€ä¸ªç©ºçš„ç»“æ„ä½“**ã€‚ï¼ˆæˆ‘ä»¬å…¶å®æœ‰æ—¶å€™åªéœ€è¦ä¸€ä¸ªç±»å‹ä½çš„æ ‡å¿—ï¼Œä½†æ˜¯å…¶å®ä½ è¯´ä»–æœ‰å€¼å’Œæ²¡å€¼æœ‰æ²¡æœ‰å…³ç³»ï¼Œä¹Ÿæ˜¯ä¹Ÿæ²¡æœ‰ï¼Œæˆ‘ä»¬çŸ¥é“çŸ¥é“è¿™ä¸ªç±»ä¼¼æšä¸¾çš„ç±»å‹æ˜¯è¿™ä¹ˆä¸ªä¸œè¥¿å°±è¡Œ, æˆ‘ä»¬ä¹Ÿä¸éœ€è¦å»å®ç°ä»–ã€‚ï¼‰

**å®šä¹‰æ–¹æ³•**ï¼šä½¿ç”¨`struct`å…³é”®å­—

```rust
// é€šè¿‡ï¼›æ¥ä»£è¡¨å®šä¹‰ç»“æŸ
struct AlwaysEqual;

fn main (){
    let subject = AlwaysEqual;    
}
```

**æ³¨æ„ç‚¹**ï¼š

Q1ï¼š è¿™é‡Œå¯èƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å®šä¹‰å¯¹è±¡ä¸­çš„å­—æ®µéƒ½æ˜¯`String`ç±»å‹ï¼Œæˆ‘ä»¬ç”¨`&str`ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿ

A1ï¼š æˆ‘ä»¬æƒ³è¦ç»“æ„ä½“çš„æ‰€æœ‰è€…æ˜¯ç»“æ„ä½“æœ¬èº«ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨å¼•ç”¨ç±»å‹ï¼Œå› ä¸ºè¿™æ ·æ‰€æœ‰ç”¨åˆ°ç»“æ„ä½“ä¸­çš„æ•°æ®ï¼Œå…¶åªè¦è¢«ä½¿ç”¨ï¼Œç»“æ„ä½“å°±ä¸ä¼šè¢«GC

Q2ï¼š å¦‚æœæˆ‘ä»¬ä¸€å®šè¦å­˜å‚¨çš„æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹å‘¢ï¼Ÿ

A2ï¼š é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç»™å¯¹åº”çš„å¼•ç”¨ç±»å‹ï¼Œå£°æ˜ç”Ÿå‘½å‘¨æœŸï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬ç°åœ¨è¿˜æ²¡å­¦åˆ°ã€‚

### 7.2 ä½¿ç”¨å¼•ç”¨ç±»å‹çš„ä¸€ä¸ªä¾‹å­

**ç›®æ ‡**ï¼šå®ç°ä¸€ä¸ªé•¿æ–¹å½¢é¢ç§¯è®¡ç®—çš„åŠŸèƒ½

#### 7.2.1 ä½¿ç”¨å‡½æ•°åˆ†å¼€ä¼ å‚

æˆ‘ä»¬ç¬¬ä¸€ç§æœ€ç›´æ¥å®¹æ˜“æƒ³åˆ°çš„ï¼Œå°±æ˜¯å°†`width`å’Œ`height`ä½œä¸ºä¸¤ä¸ªå‚æ•°ä¼ å…¥ï¼Œè¿™ç§æ¯”è¾ƒç®€å•ï¼Œä¸è¿‡å¤šèµ˜è¿°äº†

```rust
fn main() {
    let width = 30;
    let height = 40;

    let areaRlt = area(&width, &height);

    println!("area -> {}", areaRlt)
}

fn area(x: &u32, y: &u32) -> u32 {
    x * y
}
```

#### 7.2.2 ä½¿ç”¨å…ƒç»„ä¼ å‚

æˆ‘ä»¬å°†`width`å’Œ`height`é€šè¿‡å…ƒç»„å°è£…ï¼Œç„¶åé€šè¿‡å…ƒç»„è§£æ„å¾—åˆ°ä¸åŒçš„æ•°æ®æ¥è®¡ç®—é¢ç§¯ã€‚

**ç¼ºç‚¹**ï¼šæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šï¼Œå“ªä¸ªå‚æ•°æ˜¯é•¿ï¼Œå“ªä¸ªå‚æ•°åæ¬¾ï¼Œè™½ç„¶æˆ‘ä»¬å°†ä¸¤ä¸ªå‚æ•°æ•´åˆæˆäº†ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯å…¶å‚æ•°çš„æ„ä¹‰å¹¶ä¸æ¸…æ™°ã€‚

```rust
fn main() {
    let width = 30;
    let height = 40;

    let areaRlt2 = areaTuples((&width, &height));
    println!("area2 -> {}", areaRlt2);
}


fn areaTuples(dimesion: (&u32, &u32)) -> u32 {
    let (width, height) = dimesion;

    width * height
}
```

#### 7.2.3 é‡æ„å‚æ•°é€šè¿‡ç»“æ„ä½“ï¼Œå¢åŠ å‚æ•°çš„æ„ä¹‰

ç”±äºå…ƒç»„å¯¹æ•°æ®æ²¡æœ‰ç‰¹æ®Šçš„å®šä¹‰ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç»“æ„ä½“çš„æ•°æ®ç»“æ„æ¥æ ‡è®°æ•°æ®ï¼Œä»£æ›¿å…ƒç»„ã€‚

æˆ‘ä»¬å°†é•¿å’Œå®½åˆ†åˆ«æ ‡è®°ä¸º`width`å’Œ`height`ï¼Œåˆ†åˆ«å®šä¹‰ä¸º`u32`ç±»å‹ï¼Œé€šè¿‡å°†`width`å’Œ`height`ä½œä¸º`Dimension`çš„å‚æ•°ä¼ å…¥

åœ¨areaå‡½æ•°ä¸­æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç„¶åé€šè¿‡`.`è¯­æ³•å¾—åˆ°å¯¹åº”çš„å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬**æ•…æ„ä½¿ç”¨**`&Dimension`æ¥å¯¹åº”ä½¿ç”¨åˆ›å»ºçš„Dimensionçš„å¼•ç”¨ï¼ˆè™½ç„¶è¿™é‡Œçœ‹èµ·æ¥æ²¡é‚£ä¹ˆå¿…è¦ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™ä¸ªå‚æ•°è¢«å¾ˆå¤šåœ°æ–¹å…±äº«çš„è¯ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ª`&`å¼•ç”¨ï¼Œåé¢çš„ä»£ç ä¼šè¢«å€Ÿç”¨æŠ˜ç£¨ï¼‰ï¼Œåœ¨å‡½æ•°ä¸­æˆ‘ä»¬ä½¿ç”¨`.width`å’Œ`.height`æ¥å–å€¼ï¼Œç›¸è¾ƒäºå…ƒç»„ï¼Œè‚¯å®šæ˜¯æ›´å…·æœ‰äºä¸€çš„

```rust
struct Dimension {
    width: u32,
    height: u32
}

fn main() {
    let width = 30;
    let height = 40;

    let areaRlt3 = area(&Dimension{
        width,
        height,
    });
    println!("area3 -> {}", areaRlt3)
}
fn area(prop: &Dimension) -> u32 {
    let width = prop.width;
    let height = prop.height;

    width * height
}
```

#### 7.2.4 ä½¿ç”¨è¡ç”Ÿç‰¹æ€§å¢åŠ å‡½æ•°çš„åŠŸèƒ½æ€§

è¿™é‡Œå‘æˆ‘ä»¬ä»‹ç»äº†è¡ç”Ÿç‰¹æ€§ï¼Œ`derive`çš„ç”¨æ³•ã€‚

åŸæ–‡ä¸­ä¸¾çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é€šè¿‡`println!`è¿™ä¸ªå®æ‰“å°ç»“æ„ä½“ï¼Œç›®å‰æ˜¯ä¸è¡Œçš„ã€‚ç›®å‰ä¼šæŠ¥é”™

```bash
error[E0277]: `Dimension` doesn't implement `std::fmt::Display`
=help: the trait `std::fmt::Display` is not implemented for `Dimension`
= note: in format strings you may be able to use `{:?}` (or {:#?} for pretty-print) instead
= note: this error originates in the macro `$crate::format_args_nl` (in Nightly builds, run with
-Z macro-backtrace for more info)
```

å…¶æ„æ€å°±æ˜¯ï¼Œæ²¡æœ‰å®ç°`Display`è¿™ä¸ªæ–¹æ³•ï¼Œå¯¹äºç³»ç»Ÿè‡ªå¸¦çš„ç»å¤§å¤šæ•°ç±»å‹æ¥è¯´éƒ½å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯å¯¹äºç»“æ„ä½“æ¥è¯´ï¼Œå…¶å®æ²¡æœ‰å®ç°`Displayæ–¹æ³•å› æ­¤å±•ç¤ºä¸å‡ºæ¥`ã€‚ç„¶åçœ‹åé¢çš„`help`,ä»–å…¶å®ç»™å‡ºäº†å‡ ä¸ªè§£å†³åŠæ³•ï¼šä½¿ç”¨`{:?}/{:#?}`æ¥ä»£æ›¿`Display`å‡½æ•°ä½œä¸ºè¾“å‡ºï¼Œè¿™ä¸ªæ—¶å€™å‡½æ•°ä¼šæ‰§è¡ŒDebugç‰¹æ€§

ä½†æ˜¯å½“æˆ‘ä»¬åŠ ä¸Šå¯¹åº”çš„`{:?}`ä¹‹åï¼Œåˆå‡ºç°æŠ¥é”™:

```bash
help: the trait `Debug` is not implemented for `Dimension`
note: add `#[derive(Debug)]` to `Dimension` or manually `impl Debug for Dimension`
```

å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬ç›®å‰æ²¡æœ‰å®ç°`Debug`,Rustç›®å‰åŠŸèƒ½å‡½æ•°ä¸­æˆ‘ä»¬å¢åŠ `#[devrive(Debug)]`å°±å¯ä»¥å¼•å…¥`Debug`ç‰¹æ€§

æ‰€ä»¥æœ€ç»ˆæˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼šï¼ˆ1ï¼‰å¢åŠ `#[derive(Debug)]`ï¼ˆ2ï¼‰åœ¨æ‰“å°çš„æ—¶å€™ä½¿ç”¨`{:?}/{:#?}`ä»£æ›¿`{}`(å…¶ä¸­`{:#?}`è¾“å‡ºçš„ç‰¹æ€§ä¼šå¸¦æœ‰æ ¼å¼)

```rust
#[derive(Debug)]
struct Dimension {
    width: u32,
    height: u32
}

fn main() {
    let demension = Dimension{
        width,
        height,
    };
    println!("debug -> {:?}", demension)
}
```

åœ¨è¿™é‡Œï¼Œç›®å‰å®˜ç½‘è¿˜å‘Šè¯‰æˆ‘ä»¬äº†ä¸€ä¸ª`debug`çš„åŠæ³•ï¼Œä½¿ç”¨å®`dbg!`,ä»–ä¹Ÿå¯ä»¥ç›´æ¥æ‰“å‡º`Debug`å¯¹åº”çš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªæ³¨æ„çš„æ˜¯ï¼Œ`dbg!`æ˜¯ä¸€ä¸ªä¼šè¿”å›æ‰€æœ‰è€…çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å¥—åœ¨è¡¨è¾¾å¼å†…ï¼Œä¸ä¼šåº”ç”¨æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°æœ¬èº«çš„æ‰€æœ‰è€…ï¼Œæ‰€æœ‰çš„è¿™ç±»è¡ç”ŸåŠŸèƒ½éƒ½æ”¾åœ¨äº†é™„å½•ä¸­ï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥è¿›å…¥[é™„å½•C](https://doc.rust-lang.org/book/appendix-03-derivable-traits.html)

### 7.3 æ–¹æ³•è¯­æ³•

æ–¹æ³•å’Œå‡½æ•°ç±»ä¼¼ï¼Œä»–ä»¬éƒ½æ˜¯é€šè¿‡`fn`å…³é”®è¯æ¥è¿›è¡Œå®šä¹‰çš„ï¼Œä»–ä¹Ÿèƒ½æ¥å—å‚æ•°å’Œè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ä»»æ„ä½ç½®è°ƒç”¨ã€‚æ–¹æ³•ä¸åŒäºå‡½æ•°çš„åœ°æ–¹åœ¨äºï¼Œä»–ä»¬éœ€è¦å®šä¹‰åœ¨ç»“æ„ä½“çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦å¤–ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯`self`ä»£è¡¨è¿™ä¸ªå®ä¾‹çš„å¼•ç”¨ã€‚

#### 7.3.1 å®šä¹‰æ–¹æ³•

**å®šä¹‰æ–¹æ³•çš„æ­¥éª¤**ï¼š

1. ä½¿ç”¨`impl`å…³é”®å­—æ¥å°†`struct`çš„å‚æ•°å®šä¹‰å’Œå¯¹åº”çš„å®ç°å…³è”ï¼ˆè¿™é‡Œimplå’Œstructåé¢å¯¹åº”çš„ç»“æ„ååº”è¯¥è¦ä¸€æ ·æ‰èƒ½å…³è”èµ·æ¥ï¼‰ã€‚
2. é€šè¿‡`fn`å…³é”®å­—æ¥å®šä¹‰æ–¹æ³•
3. æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º`&self`æ¥æ¥å—å®ä¾‹ä¸Šä¸‹æ–‡ï¼ˆå¿…é¡»ï¼‰
4. å¦‚æœæˆ‘ä»¬æƒ³è¦å»æ”¹å˜`self`ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨`&mut self`
5. rustå¹¶ä¸ä¼šè‡ªå·±å»å®ç°`setter`å’Œ`getter`æ–¹æ³•éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å†™ï¼Œæ¥å®ç°å˜é‡çš„ç§æœ‰åŒ–

```rust
#[derive(Debug)]
struct Dimension {
    width: u32,
    height: u32
}

impl Dimension {
    fn width(&self) -> bool {
        self.width > 0
    }

    fn height(&self) -> bool {
        self.height > 0
    }

    fn area(&self) -> u32 {
        let mut area: u32 = 0;

        if self.width() && self.height() {
            area = self.width * self.height;
        }

        area
    }
}

fn main() {
    let width = 30;
    let height = 40;

    let demension = Dimension{
        width,
        height,
    };
    println!("area -> {}", demension.area())
}
```

#### 7.3.2 åœ¨ä½•å¤„ä½¿ç”¨`->`è¿ç®—ç¬¦

åœ¨`C/C++`è¯­è¨€ä¸­ï¼Œä½¿ç”¨`.`æ¥è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œä½¿ç”¨`->`æ¥è°ƒç”¨å¼•ç”¨å¯¹è±¡æŒ‡é’ˆçš„æ–¹æ³•ï¼Œæ‰€ä»¥ä½ éœ€è¦åŒºåˆ†åˆ°åº•ä½¿ç”¨çš„å¯¹è±¡æ˜¯çœŸçš„å¯¹è±¡ï¼Œè¿˜æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚

åœ¨Rustä¸­æˆ‘ä»¬æ²¡æœ‰ç±»ä¼¼`->`è¿ç®—ç¬¦çš„è¯­æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨`.`è¯­æ³•å³å¯`object.someting()`å’Œ`&object.something()`å°±å¯ä»¥ï¼Œåœ¨Rustä¸­`&self`, `&mut self`å’Œ`self`è°ƒç”¨æ–¹æ³•çš„å§¿åŠ¿éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ ·çœ‹èµ·æ¥æ¸…æ¥šä¸å°‘ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½ä¹Ÿèƒ½æ¸…æ™°çš„çŸ¥é“è¿™å‡ ä¸ªä¸œè¥¿çš„åŒºåˆ«

#### 7.3.3 æ›´å¤šå‚æ•°çš„æ–¹æ³•

ä¹‹å‰è¯´è¿‡äº†ï¼Œåœ¨ç»“æ„ä½“çš„æ–¹æ³•ä¸­ï¼Œå…¶å®é™¤äº†`self`å‚æ•°å¤–è¿˜å¯ä»¥ä¼ å¤šä¸ªå…¶ä»–å‚æ•°ï¼Œè¿™é‡Œå®˜ç½‘å®ç°äº†ä¸€ä¸ª`can_hold`æ–¹æ³•æ¥æè¿°ï¼Œæ˜¯å¦ä¸€ä¸ªçŸ©é˜µå¯ä»¥åŒ…æ‹¬å¦å¤–ä¸€ä¸ªçŸ©é˜µï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬å¤–éƒ¨è°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œå¯¹åº”åˆ°å®é™…`impl`å®ç°å†…éƒ¨ï¼Œå…¶å®å°±æ˜¯å‚æ•°ç´¢å¼•+1çš„å…³ç³»ï¼ˆå› ä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`self`ï¼‰

```rust
#[derive(Debug)]
struct Dimension {
    width: u32,
    height: u32
}

impl Dimension {
    fn width(&self) -> bool {
        self.width > 0
    }

    fn height(&self) -> bool {
        self.height > 0
    }

    fn area(&self) -> u32 {
        let mut area: u32 = 0;

        if self.width() && self.height() {
            area = self.width * self.height;
        }

        area
    }

    fn can_hold(&self, dimension: &Dimension) -> bool {
        &self.width > &dimension.width && &self.height > &dimension.height
    }
}

fn main() {
    let rect1 = Dimension {
        width: 30,
        height: 50
    };

    let rect2 = Dimension {
        width: 20,
        height: 15
    };

    let rect3 = Dimension {
        width: 25,
        height: 10
    };

    println!("Can rect 1 hold rect2 ? {}", rect1.can_hold(&rect2)); // Can rect 1 hold rect2 ? true
    println!("Can rect 2 hold rect3 ? {}", rect2.can_hold(&rect3)); // Can rect 2 hold rect3 ? false
}
```

#### 7.3.4 ç»“æ„ä½“ä¸­çš„å‡½æ•°

è¿™é‡Œå…¶å®åŸæ–‡åº”è¯¥ç¿»è¯‘æˆç›¸å…³å‡½æ•°ï¼Œå…¶å®è®²çš„å°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯æœ‰`&self`ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„ï¼Œè¿™ç§æ˜¯ä½œä¸ºç»“æ„ä½“æ–¹æ³•ï¼ˆå³éœ€è¦å®ä¾‹åŒ–åæ‰èƒ½è°ƒç”¨çš„ï¼‰ï¼Œä½†æ˜¯ç±»ä¼¼JSä¸­å¯¹è±¡çš„`é™æ€æ–¹æ³•`çš„è¿™ç§ï¼Œå°±æ˜¯ä¸éœ€è¦**å®ä¾‹åŒ–å³å¯è°ƒç”¨çš„å‡½æ•°**å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿ

+ åœ¨`impl`ä¸­å®šä¹‰å…³è”å‡½æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¼ `self`
+ åœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨`::`è¯­æ³•
+ ä¸€èˆ¬ç”¨æ¥ä½œä¸ºæ„é€ å‡½æ•°ç»™å‡º

```rust
#[derive(Debug)]
struct Dimension {
    width: u32,
    height: u32
}

impl Dimension {
    fn width(&self) -> bool {
        self.width > 0
    }

    fn height(&self) -> bool {
        self.height > 0
    }

    fn area(&self) -> u32 {
        let mut area: u32 = 0;

        if self.width() && self.height() {
            area = self.width * self.height;
        }

        area
    }

    fn can_hold(&self, dimension: &Dimension) -> bool {
        &self.width > &dimension.width && &self.height > &dimension.height
    }

    fn square(width: u32) -> Dimension {
        Dimension {
            width,
            height: width
        }
    }
}

fn main() {
    // é€šè¿‡::è¯­æ³•åˆ›å»ºé™¤äº†ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œä¹‹åå®ä¾‹è°ƒç”¨areaæ–¹æ³•è®¡ç®—é¢ç§¯
    println!("square area -> {}", Dimension::square(3).area())
}
```

#### 7.3.5 å¤šä¸ªimplå®ç°

å¦‚æœå¯¹åŒä¸€ä¸ªç»“æ„ä½“ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¤šä¸ª`impl`ä¼šæ€ä¹ˆåŠï¼Œå…¶å®ä¹Ÿä¸ä¼šæ€ä¹ˆæ ·ï¼Œä¼šå°†å¤šä¸ª`impl`ä¸­çš„å†…å®¹åˆå¹¶ï¼Œä½†æ˜¯**å¦‚æœå­˜åœ¨å®šä¹‰äº†åŒåçš„ç»“æ„ä½“æ–¹æ³•**ï¼Œä¼š**æŠ¥é”™æç¤ºä½ å¤šä¸ª`impl`ä¸­å¯¹åº”çš„æ–¹æ³•è¢«é‡å¤å®šä¹‰äº†**

## 8  æšä¸¾å’Œæ¨¡å¼åŒ¹é…

### å†™åœ¨å‰é¢

åœ¨æœ¬ç« ä¸­æˆ‘ä»¬å°†çœ‹åˆ°æšä¸¾ç±»ï¼ˆenumï¼‰ï¼Œæœ¬ç« å†…å®¹ä¸»è¦åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼š

1. å®šä¹‰å’Œä½¿ç”¨æšä¸¾å€¼ï¼Œæ¥è§£å†³ä»£ç ä¸­çš„"é­”æ³•æ•°å­—"çš„é—®é¢˜
2. äº†è§£`Option`è¿™ç§ç‰¹æ®Šçš„æšä¸¾
3. ä½¿ç”¨`match`è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…
4. ä½¿ç”¨`if let`ç»“æ„ï¼Œä½œä¸ºå¦ä¸€ç§æ–¹ä¾¿ã€ç®€æ´å¯ç”¨çš„æ–¹æ¡ˆå¤„ç†ä»£ç ä¸­çš„æšä¸¾å€¼

### 8.1 å®šä¹‰æšä¸¾

**å¹²å•¥ç”¨çš„**ï¼šæšä¸¾å°±æ˜¯æˆ‘ä»¬å°†ä¸€ä¸ªå˜é‡æœ‰æ‰€æœ‰å¯èƒ½çš„å€¼éƒ½åˆ—ä¸¾å‡ºæ¥çš„ä¸€ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼å¢åŠ äº†ä»£ç çš„è¯­ä¹‰åŒ–ï¼Œä¹Ÿèƒ½è®©ä»£ç ä¸­çš„é­”æ³•æ•°å­—å‡å°‘ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ã€‚æ–‡ä¸­è®²äº†ä¸€ä¸ªIPçš„äº‹æƒ…ï¼Œå°±æ˜¯æˆ‘ä»¬å¯èƒ½é‡åˆ°IPçš„ç±»å‹æœ‰IPV4å’ŒIPV6ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ç©·å°½çš„ã€‚

**å®šä¹‰æ–¹æ³•**ï¼šé€šè¿‡`enum`æ¥å®šä¹‰

```rust
enum EngineCylinder {
    V4,
    V6,
    V8,
    V12,
}
```

#### 8.1.1 æšä¸¾å€¼çš„ä½¿ç”¨

**ä½¿ç”¨æ–¹æ³•**ï¼šä½¿ç”¨`::`è¯­æ³•æ¥è°ƒç”¨å¯¹åº”çš„ç±»å‹

```rust
fn main() {
    // è¿™é‡Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸¤ä¸ªæšä¸¾çš„å®ä¾‹
    let v6Engine = EngineCylinder::V6;
    let v8Engine = EngineCylinder::V8;
}
```

**æ³¨æ„ç‚¹**ï¼š

1. æšä¸¾æ˜¯ä¸€ä¸ªç±»ä¼¼`type`çš„æ¦‚å¿µï¼Œä»–åªæ˜¯å‘Šè¯‰ä½ ï¼Œå¯èƒ½è¿™ä¸ªæ•°æ®å½“å‰æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œæˆ–è€…æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå¹¶ä¸ä»£è¡¨å…¶æœ¬èº«æ˜¯ä»€ä¹ˆæ•°æ®ã€‚
2. åœ¨ç±»å‹å’Œå‡½æ•°å‚æ•°çš„å®šä¹‰ä¸Šï¼Œè¿™é‡Œçš„`v6Engine`å’Œ`v8Engine`å…¶å®å®ƒå¯¹åº”çš„ç±»å‹éƒ½æ˜¯æšä¸¾`EngineCylinder`ï¼Œ`v6`å’Œ`v8`åªæ˜¯ä»–å¯¹åº”çš„å®ä¾‹çš„å€¼è€Œå·²ï¼Œæ‰€ä»¥å…¶å®**æšä¸¾ç±»**å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»å‹ï¼Œå…¶å¯ä»¥ä½œä¸ºå‡½æ•°çš„å‚æ•°å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸º`struct`ä¸­ä¸€ä¸ªé”®å€¼å¯¹åº”çš„ç±»å‹ã€‚
3. å’Œ`struct`ç±»ä¼¼ï¼Œå¦‚æœè¦`println`æ‰“å°å¯¹åº”çš„å€¼çš„è¯ï¼Œéœ€è¦`derive[Debug]`

**ä¾‹å­ï¼š**

è¿™é‡Œæˆ‘ä»¬ä¸º`Engine`å®šä¹‰äº†ä¸‰ä¸ªå­—æ®µï¼šåŠŸç‡`power`,æ°”ç¼¸æ•°`cylinderNumber`ï¼Œæ’é‡`cc`å’Œå‘åŠ¨æœºåç§°`name`ï¼ˆå¯¹åº”çš„å€¼æˆ‘ä¹±å†™çš„ï¼‰

```rust
#[derive(Debug)]
enum EngineCylinder {
    V4,
    V6,
    V8,
    V12,
}

struct Engine {
    cylinderNumber: EngineCylinder,
    power: u32,
    cc: u32,
    name: String
}

fn main() {
    let v6Engine = EngineCylinder::V6;
    let v8Engine = EngineCylinder::V8;

    checkEngine(v6Engine);
    checkEngine(v8Engine);

    let engine = Engine {
        cylinderNumber: EngineCylinder::V6,
        power: 261,
        name: String::from("3.0T"),
        cc: 2956
    };

}

fn checkEngine(engine: EngineCylinder) {
    println!("engine is -> {:?}", engine)
}
```

åœ¨å®šä¹‰æšä¸¾çš„æ—¶å€™ï¼Œå¦‚æœæšä¸¾çš„å€¼å†™çš„å¤ªçŸ­ï¼Œå¯èƒ½ä¼šè®©æšä¸¾çš„è¯­ä¹‰åŒ–ä¹Ÿä¸å¤ªæ¸…æ¥šï¼Œå¦‚æœå†™çš„å¤ªé•¿ï¼Œå¯èƒ½å¯¼è‡´æšä¸¾æœ¬èº«ç”¨èµ·æ¥å¤ªéº»çƒ¦ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡**åœ¨æšä¸¾çš„æ—¶å€™ä¼ å…¥å‚æ•°çš„æ–¹å¼**ï¼Œæ¥è®©æšä¸¾å€¼æ›´åŠ çš„æ¸…æ™°ï¼Œç›´æ¥è®©æšä¸¾å€¼å’Œå¯¹åº”çš„å€¼ç›¸å…³è”ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œç›®å‰æœ‰ä¸‰ä¸ªæ±½è½¦å“ç‰Œï¼Œå‰åˆ©ã€é¢†å…‹ã€è”šæ¥ï¼Œä»–ä»¬å„è‡ªæœ‰ä¸åŒçš„è½¦å‹ï¼Œè¿™é‡Œçš„é¢†å…‹05å’Œé¢†å…‹03ï¼Œé€šè¿‡è·Ÿåœ¨æšä¸¾å€¼åé¢çš„`String`å°±å¯ä»¥åŒºåˆ†å‡ºï¼Œå…·ä½“æ˜¯å“ªä¸ªè½¦å‹ï¼Œéå¸¸å¥½ç”¨ï¼Œ**å°†ä¸€ä¸ªæšä¸¾è¿›è¡Œäº†æ‰©å±•ã€‚æšä¸¾å€¼æ˜¯å’Œåé¢çš„å­—ç¬¦ä¸²ç›¸å¯¹åº”çš„**ã€‚

åœ¨è¿™ä¸ªæšä¸¾åé¢çš„ç±»å‹ä¹Ÿå¯ä»¥æ˜¯è‡ªå·±å®šä¹‰çš„ç»“æ„ä½“ï¼Œä»–çš„ä½œç”¨ï¼Œå°±æ˜¯è®©ä½ å°†æŸä¸ªæšä¸¾å’ŒæŸä¸ªå€¼å…³è”èµ·æ¥ï¼Œå½“ç„¶è¿™ä¸ªåœ°æ–¹ï¼Œæ‰€æœ‰å®šä¹‰çš„æšä¸¾å€¼ï¼Œå…¶å˜ç§éƒ½å¯ä»¥æ˜¯ä¸ä¸€æ ·çš„

```rust
#[derive(Debug)]
enum CarBrand {
    Geely(String),
    LINCO(String),
    NIO(String)
}

enum Message {
    // æ²¡æœ‰ä»»ä½•æ•°æ®å…³è”
    Quit,
    // å‘½åäº†ä¸€ä¸ªç»“æ„ä½“ç±»å‹
    Move { x: i32, y: i32 },
    // å…³è”äº†ä¸€ä¸ªStringç±»å‹
    Write(String),
    // å…³è”äº†ä¸€ä¸ªåŒ…å«3ä¸ªi32çš„å…ƒç»„ç»“æ„
    ChangeColor(i32, i32, i32),
}

fn main() {
    let geelyIcon = CarBrand::Geely(String::from("Icon"));
    let linco05 = CarBrand::LINCO(String::from("05"));
    let linco01 = CarBrand::LINCO(String::from("01"));

    println!("05 -> {:?}, 01 -> {:?}", linco05, linco01);
}
```

å¦ä¸€ç§ç©æ³•ï¼š**å®šä¹‰çš„æšä¸¾ç±»å‹å¯ä»¥å…³è”å„ç§ä¸åŒç±»å‹çš„æ•°æ®**ï¼Œä¸‹é¢çš„`Message`å’Œå®šä¹‰å¤šä¸ª`struct`æ•ˆæœä¸Šæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œå¯¹äºè¿™æ ·å®šä¹‰çš„æšä¸¾æ¥è¯´ï¼Œå…¶å¯¹åº”çš„ä¸Šå±‚çš„ç±»å‹éƒ½æ˜¯`Message`,è€Œå¦‚æœä½ å®šä¹‰äº†å¤šä¸ªç»“æ„ä½“ç±»å‹ï¼Œé‚£ä»–ä»¬éƒ½æ˜¯ä¸åŒçš„ç»“æ„ä½“ã€‚å’Œ`struct`ç±»ä¼¼ï¼Œåˆ©ç”¨`impl`æ–¹æ³•ä¹Ÿå¯ä»¥ä¸ºæšä¸¾ä¸­ç‰¹æ®Šçš„ç±»ï¼Œå®šä¹‰å¯¹åº”çš„æ–¹æ³•ã€‚

```rust
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

impl Message {
    fn invoke (&self) {
        println!("123")
    }
}

fn main () {
    let write_message = Message::Write(String::from("123"));
    write_message.invoke(); // 123
}
```

#### 8.1.2 Optionæšä¸¾å’Œä»–è¶…è¶ŠNullçš„ä¼˜åŠ¿

Optionç±»å‹è¢«ç”¨äºå¾ˆå¤šåœºæ™¯ï¼Œå› ä¸ºä¸€ä¸ªå€¼å¯èƒ½æ˜¯ä¸€äº›ç±»å‹ï¼ˆå°±æ˜¯ç”±å¤–éƒ¨å†³å®šï¼‰ï¼Œä¹Ÿå¯èƒ½å•¥ä¹Ÿä¸æ˜¯ã€‚Optionç±»å‹ç›®å‰å°±æ˜¯ä¸ºäº†å¤„ç†ä¸€äº›é€šç”¨åœºæ™¯è®¾è®¡çš„ã€‚è¿™ç§æ•°æ®è§£æ„çš„æ„ä¹‰åœ¨äºå‘Šè¯‰ç¼–è¾‘å™¨ä½ æ˜¯å¦æ˜¯åˆç†å¤„ç†äº†æ‰€æœ‰çš„åœºæ™¯ï¼Œé¿å…åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆé€šç”¨åœºæ™¯ä¸‹çš„ä¸€äº›bug

ç›®å‰Rustä¸åƒå…¶å®ƒè¯­è¨€ä¸€æ ·ï¼Œç›®å‰æ˜¯æ²¡æœ‰`Null`è¿™ä¸ªæ•°æ®ç±»å‹çš„ï¼Œå› ä¸ºæ–‡ä¸­è®¤ä¸ºå…¶å®æŠŠ`Null`èµ‹å€¼ç»™é`Null`å¾—å…ƒç´ ï¼Œå…¶æœ¬èº«å°±æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œæ²¡æœ‰å­˜åœ¨å¾—æ„ä¹‰ï¼Œé‚£ä¹ˆé—®é¢˜æ¥å¦‚æœæˆ‘ä»¬éœ€è¦ç»™é»˜è®¤å€¼ï¼Œä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰å¾—å€¼ï¼Œæˆ‘ä»¬éœ€è¦æ€ä¹ˆå»è¡¨ç¤ºå‘¢ï¼Ÿ

```rust
enum Option<T> {
    None,
    Some(T)
}

fn main () {
    let some_number = Some(5);
    let some_string = Some("a string");
    let absent_number: Option<i32> = None;
}
```

**æ³¨æ„ç‚¹**

1. ä½¿ç”¨`Option`å¾—ç›®çš„æ˜¯ä¸ºäº†æ¨¡æ‹Ÿï¼Œä¸€ä¸ªå€¼å¯èƒ½ä¼šæœ‰ä¹Ÿå¯èƒ½ä¼šæ²¡æœ‰å¾—è¿™ä¸ªåœºæ™¯
2. ä½¿ç”¨`Some`å’Œ`None`å¯ä»¥ä¸ä½¿ç”¨`Option::`ï¼Œåœ¨rustä¸­ä¼šè‡ªåŠ¨æ˜ å°„åˆ°`std::options::Option`ä¸Š
3. `Some`å…·æœ‰ç±»å‹æ¨æ–­å¾—ä½œç”¨ï¼Œä¼šæ ¹æ®`Some`ä¸­ä¼ å…¥å¾—å…ƒç´ ï¼Œè‡ªåŠ¨æ¨æ–­å¯¹åº”å¾—ç±»å‹
4. `<T>`è¯­æ³•æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼Œå’Œå…¶ä»–è¯­è¨€ä¸­å·®ä¸å¤šï¼Œåé¢ä¼šç»†è®²å¾—
5. Rustéœ€è¦æˆ‘ä»¬å¯¹æ‰€æœ‰å¾—å‚æ•°è¿›è¡Œæ¨æ–­ï¼Œæ¯”å¦‚`let absent_number: Option<i32> = None;`ï¼Œæˆ‘ä»¬å¦‚æœä»…ä»…å³è¾¹æ˜¯`None`å¾—è¯ï¼Œå…¶å®rustè¿˜æ˜¯ä¸çŸ¥é“ä½ è¿™ä¸ªç±»å‹åˆ°åº•æ˜¯å•¥ï¼Œéœ€è¦äººä¸ºå®šä¹‰ä¸º`Option<i32>`

**ä½¿ç”¨Optionçš„å€¼**

å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œä½¿ç”¨Optionä¹‹åï¼Œå› ä¸ºä½ çš„å€¼é™¤äº†æ˜¯`i32`è¿˜æœ‰å¯èƒ½æ˜¯`None`æ‰€ä»¥ç¼–è¯‘å™¨å°±è®¤ä¸ºä½ è¿™ä¸ªåœ°æ–¹å¦‚æœæ˜¯`None`å’Œ`i32`ç›¸åŠ ï¼Œç±»å‹ä¸Šæ˜¯æœ‰é—®é¢˜çš„ä¼šæŠ¥é”™ï¼Œè™½ç„¶è®²äº†å¾ˆå¤šåŸç†ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰è®²å…·ä½“å¦‚ä½•è§£å†³ï¼Œåªæ˜¯è¯´è®©ä½ çœ‹æ–‡æ¡£[Rust Option æ–‡æ¡£](https://doc.rust-lang.org/std/option/enum.Option.html)ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹å§ï¼Œç†è®ºä¸Šåˆ¤æ–­å‡ºç±»å‹ä¹‹åï¼Œç”¨`match`å…³é”®å­—æ¥å†³å®šæ¥ä¸‹æ¥è¦åšä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€ç« æ¥çœ‹`match`

```rust
fn main () {
    let x: i32 = 5;
    let some_number: Option<i32> = Some(5);
    let some_string = Some("a string");
    let absent_number: Option<i32> = None;

    // è¿™é‡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºi32å’ŒOption<i32>ä¸èƒ½ç›¸åŠ 
    let rlt = x + some_number;
}
```

### 8.2 matchæ§åˆ¶æµæ“ä½œç¬¦

#### 8.2.1 matchè¯­æ³•çš„å†™æ³•

åœ¨Rustä¸­æœ‰ä¸€ä¸ªåŠŸèƒ½å¾ˆå¼ºçš„`match`æ§åˆ¶æµæ“ä½œç¬¦ï¼Œä»–å…è®¸ä½ å¯¹ä¸€ä¸ªå€¼è¿›è¡Œä¸€ç³»åˆ—çš„æ¯”è¾ƒï¼Œç„¶ååŸºäºæ¯”è¾ƒç»“æœï¼Œæ‰§è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚

è¿™ç§æ¨¡å¼å¯¹æ¯”å¯ä»¥æ˜¯å¯¹æ¯”ç»“æ„ä½“çš„å€¼ï¼Œå˜é‡åï¼Œé€šé…ç¬¦å’Œå…¶ä»–å„ç§ä¸œè¥¿ã€‚

æ–‡ä¸­çš„ä¾‹å­æ˜¯æ ¹æ®ç¡¬å¸çš„å¤§å°æè´¨æ¥åˆ†è¾¨ç¡¬å¸çš„é¢é¢ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ ¹æ®åœ°åçŒœåŸå¸‚çš„ä¾‹å­ï¼Œæ¥ä¸¾ä¾‹å¯èƒ½ä¼šæ›´åŠ ç”ŸåŠ¨ï¼š

```rust
#[derive(Debug)]
enum ScenicSpot {
    // é•¿åŸ
    GreatWall,
    /// è¥¿æ¹–
    WestLake,
    // ä¹å±±å¤§ä½›
    LeshanGiantBuddha,
}

fn main() {
    let spot = ScenicSpot::WestLake;
    let city = get_spot_city(&spot);

    println!("city -> {}", city);
}

fn get_spot_city(spot: &ScenicSpot) -> String {
    match spot {
        ScenicSpot::GreatWall => String::from("åŒ—äº¬"),
        ScenicSpot::LeshanGiantBuddha => {
            String::from("å››å·")
        },
        ScenicSpot::WestLake => String::from("æ­å·"),
    }
}
```

**æ³¨æ„ç‚¹**

1. åœ¨`get_spot_city`è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`match`å…³é”®å­— + éœ€è¦æ¯”è¾ƒçš„å˜é‡ + `{}`è¯­æ³•æ¥è§„å®šæ¯”è¾ƒçš„æ“ä½œ
2. ä¸åŒçš„æ¯”è¾ƒä¹‹é—´ï¼Œé€šè¿‡`,`æ¥åˆ†å‰²ï¼Œå¦‚æœæ¯ä¸ªåˆ¤æ–­ä¸­æœ‰å¤šè¡Œä»£ç ï¼Œå¯ä»¥ç”¨`{}`æ¥è¿›è¡Œå¤šéƒ¨æ“ä½œï¼ŒåŒ…ä¸€ä¸‹ï¼Œå…¶å®è¿™é‡Œå°±æ˜¯ä¸€ä¸ªå‡½æ•°
3. åªæœ‰`match`å‘½ä¸­äº†é‚£ä¸€æ¡è§„åˆ™ï¼Œæ‰ä¼šè¿›å…¥åˆ°åç»­çš„å‡½æ•°ä½“ä¸­

#### 8.2.2 å¯¹ç»‘å®šäº†å¯¹åº”å€¼çš„æšä¸¾è¿›è¡ŒåŒ¹é…

ä¹‹å‰è®²è¿‡çš„å°±æ˜¯æšä¸¾å€¼ï¼Œå…¶å®å¯ä»¥é€šè¿‡ç»™ä¸€ä¸ªå€¼ï¼Œæ¥åšç»†åˆ†çš„ï¼Œé‚£ä¹ˆè¿™ç§ç±»å‹çš„æšä¸¾å€¼è¦å¦‚ä½•é€šè¿‡`match`è¯­æ³•æ¥ç»†åˆ†å‘¢ï¼Œè¿™é‡Œ`match`å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶å‚æ•°æ¥å—çš„å€¼ï¼Œå°±æ˜¯ç°åœ¨è¿™ä¸ª`value`åœ¨å½“å‰åˆ¤æ–­æ¡ä»¶ä¸‹çš„å€¼ï¼Œæ‰€ä»¥å¯ä»¥å†™ä¸€æ®µé€»è¾‘åˆ¤æ–­å…·ä½“çš„å¦‚ä¸‹ï¼š

```rust
#[derive(Debug)]
struct Car {
    brand: String,
    version: String, 
    max_speed: u32,
    name: String
}

#[derive(Debug)]
struct Airplane {
    company: String,
    max_speed: u32,
    price: u32
}

#[derive(Debug)]
enum Vehicle {
    Walk,
    LandTraffic(Car),
    AirTraffic(Airplane)
}

fn get_traffic_tool(tool: &Vehicle) -> String {
    match tool {
        Vehicle::AirTraffic(state) => {
            println!("ç©ºè¿å…¬å¸ä¸º -> {}", state.company);
            String::from("åé£æœºå•¦~")
        },
        Vehicle::LandTraffic(state) => {
            println!("ä»Šå¤©å -> {}", state.name);
            String::from("åè½¦å•¦~")
        },
        Vehicle::Walk => String::from("èµ°è·¯é”»ç‚¼èº«ä½“~ä¹Ÿä¸é”™")
    }
}
```

#### 8.2.3 åŒ¹é…Option<T>

ä¹‹å‰åœ¨`8.1`ä¸­è®²Optionçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´å› ä¸º`Option<T>`ä¸­å¯èƒ½åŒ…å«`None`æ‰€ä»¥æ— æ³•å’Œå¯¹åº”çš„ç¡®å®šçš„`u32`ç±»å‹ç›¸åŠ ï¼Œè¿™é‡Œæä¾›è¿‡`match`å¯ä»¥åˆ¤æ–­å‡ºå½“ä»–ä¸æ˜¯`None`çš„æ—¶å€™æ¥è¿›è¡Œç›¸åŠ ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­

```rust
fn main () {
    let x: i32 = 5;
    let some_number: Option<i32> = Some(5);
    let some_string = Some("a string");
    let absent_number: Option<i32> = None;

    let rlt: Option<i32> = match some_number {
        None => None,
        Some(state) => Some(state + x)
    };

    println!("rlt -> {:?}", rlt);
}
```

**æ³¨æ„ç‚¹**

1. æ“ä½œåçš„å€¼ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰çš„ä¹Ÿä¸ºOptionï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡`Option`åŒ…ä¸€ä¸‹
2. ä¸ºä»€ä¹ˆ`Some(5)`ä¼šå‘½ä¸­`Some`è§„åˆ™ï¼Œå› ä¸ºä»–ä»¬éƒ½æ¶‰åŠåŒä¸€ä¸ªå˜ä½“ï¼Œåªä¸è¿‡ä»–ä»¬å¾—å€¼ä¸åŒï¼Œæ‰€ä»¥èƒ½å¤ŸåŒ¹é…ä¸Š
3. å¯¹`None`çš„å€¼ä¹Ÿè¦åˆ¤æ–­ï¼Œå¦‚æœ`match`æ²¡æœ‰å¯¹å€¼å¾—æ‰€æœ‰å¯èƒ½åšåˆ¤æ–­å¾—è¯ï¼Œä¼šæŠ¥é”™ï¼ˆå°½å¯èƒ½å……åˆ†å¾—è¿›è¡ŒåŒ¹é…ï¼‰

é€šè¿‡`match` + `enum`åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ˜¯éå¸¸æœ‰ç”¨å¾—ï¼Œä½ å°†ä¼šçœ‹åˆ°

#### 8.2.4 æ•è·æ‰€æœ‰ç±»å‹å’Œ`_`å ä½ç¬¦

```rust
use rand::Rng;

fn match_number() -> String {
    let rand_num = rand::thread_rng().gen_range(1..10);

    let rlt_message = match rand_num {
        5 => String::from("äºŒç­‰å¥–"),
        3 => String::from("ä¸€ç­‰å¥–"),
        _ => String::from("ä½ æ²¡ä¸­å¥–")
    };

    rlt_message
}

fn main() {
    println!("game res -> {}", match_number());
}
```

**æ³¨æ„ç‚¹**

1. å‰ä¸¤è¡Œä»£ç ç”¨æ¥æŒ‡å‡ºäº†3å’Œ5åŒ¹é…ä¸Šå¾—æ¡ä»¶ï¼Œåé¢å¾—ç¬¬ä¸‰ä¸ªæ¡ä»¶ç”¨æ¥åŒ¹é…å…¶ä»–å‰©ä¸‹å¾—æ‰€æœ‰å¯èƒ½
2. ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡æœ€åçš„ä¸œè¥¿æ¥ä½œä¸ºå…œåº•

### 8.3 ç”¨`if let `å®ç°ç®€æ´çš„æ§åˆ¶æµ

ä½¿ç”¨`if let`è¿™ä¸ªè¯­æ³•å¯ä»¥è®©ä½ ç®€å•å¤„ç†å°±æ˜¯`match`åœºæ™¯ä¸‹ï¼Œåªéœ€è¦ä¸€æ¬¡åŒ¹é…çš„åœºæ™¯ï¼Œè€Œå¿½ç•¥å…¶ä½™å‰©ä¸‹çš„æ‰€æœ‰å¯èƒ½ï¼Œæ¯”å¦‚ä»¥æˆ‘ä»¬åˆšæ‰ç›¸åŠ çš„ä¾‹å­ä¸ºä¾‹ï¼š

```rust
fn main () {
    let x: i32 = 5;
    let some_number: Option<i32> = Some(5);
    let some_string = Some("a string");
    let absent_number: Option<i32> = None;

    // è¿™é‡Œæˆ‘ä»¬éœ€è¦åŒæ—¶å¤„ç†Noneå’ŒSomeè¿™ä¸¤ç§åŒ¹é…ä¸Šçš„æƒ…å†µ
    let rlt: Option<i32> = match some_number {
        None => None,
        Some(state) => Some(state + x)
    };

    println!("rlt -> {:?}", rlt);
}
```

å¦‚æœä½¿ç”¨`if let`è¯­æ³•æˆ‘ä»¬åªéœ€è¦å¤„ç†å…¶ä¸­ä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„åœºæ™¯å³å¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦å¤„ç†`None`çš„æ¡ä»¶

```rust
fn main() {
    let x = None;
    let y = Some(5);
    get_add_result(&x);  // æ•°å­—æ˜¯æ— æ•ˆçš„
    get_add_result(&y); // è¾“å…¥çš„å€¼åŠ 6åæ˜¯ -> 11
}

fn get_add_result (x: &Option<u32>) {
    if let Some(state) = x {
        let s = 6;
        println!("è¾“å…¥çš„å€¼åŠ 6åæ˜¯ -> {}", s + state);
    } else {
        println!("æ•°å­—æ˜¯æ— æ•ˆçš„")
    }
}
```

**æ³¨æ„ç‚¹**

1. `if let`è¿™ç§è¯­æ³•å…¶å®ç”¨æ³•ä¸Šä½ ç†è§£å°±æ˜¯å’Œ`if`ä¸€æ ·ï¼Œå¹¶ä¸èƒ½åƒ`match`ä¸€æ ·ç›´æ¥æœ‰è¿”å›å€¼
2. `else`ç±»ä¼¼ä¹‹å‰çš„`_`ç”¨äºå¤„ç†é™¤äº†é€‰ä¸­çš„é‚£ä¸€ç§åœºæ™¯å¤–çš„æ‰€æœ‰åœºæ™¯

### 8.4 æ€»ç»“

è¿™ä¸€å¼ å“¦æˆ‘ä»¬å±•ç¤ºäº†å„ç§æšä¸¾å€¼`enum`çš„åˆ›å»ºã€`Option<T>`ç±»å‹çš„åˆ›å»ºï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹æšä¸¾å€¼åšå‡ºåˆ¤æ–­æ—¶`match`çš„ç”¨æ³•å’Œ`if let`çš„ç²¾ç®€å†™æ³•ã€‚ç°åœ¨åœ¨ä½ çš„Rustç¨‹åºä¸­å¯ä»¥é€šè¿‡ç»“æ„ä½“å’Œæšä¸¾æ¥è¡¨è¾¾å„ç§è§‚å¿µï¼Œé€šè¿‡åˆ›å»ºä½ è‡ªå·±çš„ç±»å‹æ¥ä¿è¯APIçš„ç±»å‹å®‰å…¨ã€‚ç¼–è¯‘å™¨å°†èƒ½ç¡®ä¿ä½ çš„å‡½æ•°èƒ½å¤Ÿå¾—åˆ°ä½ æƒ³è¦çš„å€¼ã€‚ä¸ºäº†èƒ½è®©ä½ æ›´å¥½çš„è®¾è®¡å‡ºå¥½ç”¨çš„APIï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿›å…¥Rustçš„æ¨¡å—ç³»ç»Ÿã€‚

## 9. åœ¨å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨åŒ…ã€ç®±å’Œæ¨¡å—æ¥ç®¡ç†é¡¹ç›®

### å†™åœ¨å‰é¢

ç›®å‰æˆ‘ä»¬æ‰€æœ‰ç¼–å†™çš„ä»£ç éƒ½æ˜¯åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œéšç€é¡¹ç›®å¢åŠ ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»£ç åˆ‡åˆ†æˆå¤šä¸ªæ¨¡å—å’Œå¤šä¸ªæ–‡ä»¶ã€‚ä¸€ä¸ª**åŒ…ï¼ˆpackageï¼‰**å¯ä»¥åŒ…å«å¤šä¸ªäºŒè¿›åˆ¶çš„**ç®±ï¼ˆCratesï¼‰**ï¼Œéšç€åŒ…çš„å¢å¤§ä¹Ÿå¯ä»¥æ‹†æˆå¤šä¸ªç‹¬ç«‹çš„ç®±ï¼ˆcratesï¼‰ä»¥åŠå¯é€‰çš„ä¸€ä¸ªç®±ï¼ˆCratesï¼‰ã€‚æœ¬ç« ä¸»è¦å°±æ˜¯è®²è¿°äº†å…³äºåŒ…ç®¡ç†ç›¸å…³çš„å†…å®¹ï¼Œå¯¹äºéå¸¸å¤§çš„é¡¹ç›®æ¥è¯´ï¼Œä¸€äº›ç›¸å…³çš„åŒ…å¯ä»¥éœ€è¦å…±åŒå‡çº§ï¼Œcargoæä¾›äº†workspaceçš„æ¦‚å¿µä¼šåœ¨åç»­è®²è§£ã€‚

é™¤äº†å‡½æ•°é›†ä¹‹å¤–ï¼Œå°è£…ä¸€äº›å‡½æ•°çš„å®è·µï¼Œè®©ä½ çš„ä»£ç èƒ½å¤Ÿæ›´å®¹æ˜“å¤ç”¨ï¼Œä¸€æ—¦ä½ å®ç°äº†ä¸€ä¸ªæ“ä½œå…¶ä»–ä»£ç å¯ä»¥é€šè¿‡å…¬å¼€çš„æ¥å£ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å…³å¿ƒå†…éƒ¨å®ç°ï¼ˆéœ€è¦è®©å¤–éƒ¨è°ƒç”¨çš„ä½¿ç”¨puiblicï¼Œå…¶ä»–éƒ¨åˆ†ç§æœ‰åŒ–privateï¼‰ã€‚

ç›¸å…³çš„è§‚ç‚¹è¿˜æœ‰ä½œç”¨åŸŸï¼šæ— è®ºæ˜¯ç¼–è¯‘å™¨è¿˜æ˜¯coderï¼Œåœ¨åˆ›å»ºä½œç”¨åŸŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æˆ‘ä»¬çš„å˜é‡ã€å‡½æ•°ã€ç»“æ„ä½“ã€æšä¸¾ç­‰åœ¨ä½œç”¨åŸŸå†…å¤–å“ªé‡Œç”Ÿæ•ˆï¼Œæ˜¯å¦ä¼šæœ‰å‘½åå†²çªçš„æƒ…å†µã€‚

rust**ç®¡ç†æ¨¡å—ç³»ç»Ÿ**ä¸»è¦åŒ…æ‹¬ï¼š

1. Packagesï¼ˆåŒ…ï¼‰: cargoçš„æ¨¡å—ç‰¹æ€§ï¼Œè®©ä½ èƒ½æ„å»ºã€æµ‹è¯•å’Œåˆ†äº«ç®±ï¼ˆcratesï¼‰
2. Cratesï¼ˆç®±ï¼‰ï¼šä¸€ä¸ªåº“æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶çš„æ¨¡å—æ ‘
3. Modulesï¼ˆæ¨¡å—ï¼‰ï¼šè®©ä½ æ§åˆ¶ç»„ç»‡ç»“æ„ã€ä½œç”¨åŸŸå’Œç§æœ‰è·¯å¾„ï¼ˆå…¶å®æˆ‘ç†è§£è¿™é‡Œå°±æ˜¯ä»£ç äº†ï¼‰
4. Pathsï¼ˆè·¯å¾„ï¼‰ï¼šä¸€ç§å‘½åé¡¹ç›®çš„æ–¹å¼ï¼Œä¾‹å¦‚ç»“æ„ä½“ã€å‡½æ•°æˆ–è€…æ¨¡å—

æœ¬ç« ä¸»è¦è®²è§£çš„å°±æ˜¯æ¨¡å—çš„äº¤äº’ï¼Œæ€ä¹ˆæ ·åœ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨ï¼Œæœ€åå°†è®²è§£ä¸€ä¸‹æ¨¡å—ç³»ç»Ÿå¦‚ä½•ä½¿ç”¨ã€‚

### 9.1 åŒ…å’Œç®±

ä¸€ä¸ªç®±ï¼ˆcrateï¼‰æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æˆ–è€…ä¸€ä¸ªåº“ã€‚`crate root`æ˜¯rustç¼–è¯‘å™¨å¼€å§‹è¿è¡Œå’Œæ‰“åŒ…ä½ çš„æ¨¡å—çš„æºæ–‡ä»¶ã€‚

ä¸€ä¸ªåŒ…(package)æ˜¯æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªç®±ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„åŠŸèƒ½ã€‚ï¼ˆä¸€ä¸ªpackageåŒ…å«äº†ä¸€ä¸ªcargo.tomlæ–‡ä»¶ï¼Œç”¨äºæè¿°å¦‚ä½•æ„å»ºè¿™äº›ç®±ï¼‰ã€‚

**åˆ›å»ºä¸€ä¸ªæ–°çš„packageå·¥ç¨‹**

```bash
cargo new lesson_8_package
```

![](E:\Learn\learn-rust\images\04-package.png)

æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶å·²ç»åŒ…æ‹¬äº†`cargo.toml`æ–‡ä»¶ï¼Œå…¶ç”¨æ¥è¡¨ç¤ºå½“å‰çš„è¿™ä¸ªåŒ…ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹cargo.tomlè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œå…¶å¯¹åº”çš„åŒ…åå’Œå·¥ç¨‹åæ˜¯ä¸€æ ·ï¼Œ**ç„¶å`main.rs`è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ç®±çš„rootæ–‡ä»¶**ï¼Œç„¶åï¼Œ**`src/lib.rs`æ–‡ä»¶è¢«è®¤ä¸ºæ˜¯ç®±çš„åº“æ–‡ä»¶**ã€‚ä¹‹å‰æˆ‘ä»¬å†™çš„ä»£ç éƒ½æ˜¯åªæœ‰ä¸€ä¸ª`main.rs`å¦‚æœåç»­æˆ‘ä»¬çš„ä»£ç åˆæœ‰`marin.rs`åˆæœ‰`lib.rs`é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æœ‰ä¸¤ä¸ªç®±äº†ï¼Œä¸€ä¸ªç”¨äºæ„å»ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸€ä¸ªç”¨äºå¤„ç†åº“æ–‡ä»¶ã€‚

![](E:\Learn\learn-rust\images\05-toml.png)

**å¦‚ä½•ä¸€ä¸ªpackageä¸­æœ‰å¤šä¸ªäºŒè¿›åˆ¶æ–‡ä»¶**ï¼šåˆ›å»ºä¸€ä¸ª`src/bin`æ–‡ä»¶å¤¹ï¼Œå…¶ä¸‹çš„æ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä¼šè¢«åˆ†å‰²æˆä¸€ä¸ªäºŒè¿›åˆ¶ç®±æ–‡ä»¶

### 9.2 å®šä¹‰æ¨¡å—æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰åŒ–

å‡ ä¸ªå…³é”®å­—ï¼š

**paths**ï¼šå…è®¸ä½ å»å‘½åæ¯ä¸€ä¸ªæƒ³è¦åˆ†äº«çš„åŠŸèƒ½

**use**ï¼šå¼•å…¥å¯¹åº”è·¯å¾„çš„åŠŸèƒ½åˆ°ä½œç”¨åŸŸä¸­

**pub**ï¼šä½¿åŠŸèƒ½ä¸ºå…¬ç”¨åŠŸèƒ½

**as**ï¼šç»™æ–¹æ³•å–åˆ«åï¼ˆæˆ‘çŒœå’Œimport asä¸€æ ·ï¼‰

**ä¸ºä»€ä¹ˆè¦æ¨¡å—åŒ–ï¼Ÿ**

æ¨¡å—åŒ–é€šè¿‡ç®±æ¥ç»„ç»‡ä»£ç å…·æœ‰æ›´å¥½çš„å¯è¯»æ€§å’Œå¤ç”¨æ€§ã€‚æ¨¡å—ä¹Ÿç”¨æ¥æ§åˆ¶é¡¹ç›®ç§æœ‰åŒ–ï¼Œå¯ä»¥å®šä¹‰ä»€ä¹ˆæ˜¯å¯ä»¥æš´éœ²ç»™å¤–éƒ¨çš„ï¼ˆpublicï¼‰å’Œåªæœ‰å†…éƒ¨èƒ½ä½¿ç”¨çš„æ–¹æ³•ï¼ˆprivateï¼‰

#### 9.2.1 æ¨¡å—çš„å®šä¹‰

æ³¨æ„ç‚¹ï¼š

1. ä½¿ç”¨`mod`å…³é”®å­—æ¥ä»£è¡¨è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªmodules
2. å¯ä»¥ä½¿ç”¨`cargo new --lib xxxx`æ¥åˆ›å»ºlib
3. `lib`æ–‡ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ª`lib.rs`ä¼šè¢«ç¼–è¯‘å™¨è®¤ä¸ºæ˜¯ä¸€ä¸ªæ¨¡å—
4. æ¨¡å—æ˜¯å¯ä»¥åµŒå¥—çš„,å…¶æ˜¯ä¸€ä¸ªæ ‘ç»“æ„ï¼Œå¦‚æœä¸€ä¸ªAæ¨¡å—å†…éƒ¨åŒ…å«äº†ä¸€ä¸ªBæ¨¡å—ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´Bæ˜¯Açš„å­æ¨¡å—

```rust
#[cfg(test)]
mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
        fn seat_at_table() {}
    }

    mod serving {
        fn take_order() {}

        fn serve_order() {}

        fn take_payment() {}
    }
}
```

#### 9.2.2 ç®±çš„æ ‘ç»“æ„

å¯¹åº”çš„è¯¥ç®±çš„æ ‘ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œ`hosting`å’Œ`serving`æ˜¯`front_of_house`çš„å­æ¨¡å—

```
crate
 â””â”€â”€ front_of_house
     â”œâ”€â”€ hosting
     â”‚   â”œâ”€â”€ add_to_waitlist
     â”‚   â””â”€â”€ seat_at_table
     â””â”€â”€ serving
         â”œâ”€â”€ take_order
         â”œâ”€â”€ serve_order
         â””â”€â”€ take_payment
```

### 9.3 åœ¨æ¨¡å—æ ‘å¯¹æ¯ä¸€é¡¹çš„å¼•ç”¨

#### 9.3.1 ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„çš„ä½¿ç”¨

è°ƒç”¨è·¯å¾„ä¸Šå¯¹åº”çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼š

1. ç»å¯¹è·¯å¾„æ–¹æ³•ï¼šåœ¨ç®±çš„æ ¹æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨`crate`å…³é”®å­—å’Œç®±çš„åç§°æ¥è°ƒç”¨å¯¹åº”çš„æ–¹æ³•
2. ç›¸å¯¹è·¯å¾„æ–¹æ³•ï¼šåœ¨å½“å‰æ¨¡å—ä¸­ä½¿ç”¨`self`å’Œ`super`å…³é”®å­—æ¥ä½¿ç”¨ç›¸å…³çš„æ–¹æ³•

**æ³¨æ„**ï¼š

1. åœ¨è°ƒç”¨ç»å¯¹æˆ–è€…ç›¸å¯¹è·¯å¾„çš„æ—¶å€™ï¼Œä¸€èˆ¬ä½¿ç”¨å¤šäº†ä¸ª`::`æ¥å¯¹ç›¸åº”çš„è¯†åˆ«ç¬¦åšåŒºåˆ†

2. å¦‚ä½•åŒºåˆ«å¦‚ä½•ä½¿ç”¨ç»å¯¹è·¯å¾„è¿˜æ˜¯ç›¸å¯¹è·¯å¾„ï¼Ÿ
   
   > å–å†³äºä½ å°è£…ä»£ç çš„å½¢å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™ä¸ª*eat_at_restaurant*è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœä½ æ˜¯å’Œä¸Šé¢çš„`front_of_house`æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­çš„é‚£ä¹ˆç»å¯¹è·¯å¾„éœ€è¦ä¿®æ”¹ï¼Œç›¸å¯¹è·¯å¾„ä¸ç”¨ä¿®æ”¹ï¼Œä½†æ˜¯å¦‚æœä½ è¦æ‹†æˆä¸¤ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆç»å¯¹è·¯å¾„ä¸ç”¨ä¿®æ”¹ï¼Œè€Œç›¸å¯¹è·¯å¾„éœ€è¦ä¿®æ”¹ã€‚

3. å®˜æ–¹å»ºè®®å¤šä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œå› ä¸ºä»£ç å®šä¹‰å’Œæ¯ä¸€é¡¹éƒ½æ›´å€¾å‘äºç‹¬ç«‹å®šä¹‰ã€‚

```rust
pub fn eat_at_restaurant() {
    // ç»å¯¹è·¯å¾„è°ƒç”¨
    crate::front_of_house::hosting::add_to_waitlist();
    // ç›¸å¯¹è·¯å¾„è°ƒç”¨
    front_of_house::hosting::add_to_waitlist();
}
```

è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬ç¼–è¯‘ä¸Šè¿°ä»£ç ï¼Œä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º**åœ¨Rustä¸­é»˜è®¤è®¤ä¸ºæ¨¡å—æ˜¯ç§æœ‰çš„ï¼Œæˆ‘ä»¬ä¸èƒ½æ¥å…¥ç§æœ‰çš„æ¨¡å—**ï¼Œåœ¨rustä¸­æ‰€æœ‰åœ¨ç§æœ‰è¾¹ç•Œä¸­è¿è¡Œçš„é¡¹ç›®ï¼ˆ**å‡½æ•°ï¼Œæ–¹æ³•ï¼Œç»“æ„ä½“ï¼Œæšä¸¾ï¼Œæ¨¡å—å’Œå¸¸é‡**ï¼‰éƒ½æ˜¯**é»˜è®¤ä¸ºç§æœ‰åŒ–çš„**ã€‚

```bash
error[E0603]: module `hosting` is private
  --> src\lib.rs:27:28
   |
27 |     crate::front_of_house::hosting::add_to_waitlist();
   |                            ^^^^^^^ private module
   |
note: the module `hosting` is defined here
  --> src\lib.rs:2:5
   |
2  |     mod hosting {
   |     ^^^^^^^^^^^

For more information about this error, try `rustc --explain E0603`.
error: could not compile `lesson_8_package` due to previous error
```

#### 9.3.2 ä½¿ç”¨pub å…³é”®å­—æ¥æš´éœ²ç›¸å…³æ–¹æ³•

æˆ‘ä»¬å¯ä»¥é€šè¿‡`pub`å…³é”®å­—ï¼Œå°†æ¨¡å—ä¸­çš„éƒ¨åˆ†å­æ¨¡å—ä»¥åŠæ–¹æ³•å‘å¤–è¿›è¡Œæš´éœ²ï¼Œæ‰€ä»¥ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹å›¾æ‰€ç¤º

```rust
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {
            println!("add to wait list");

            self::seat_at_table();
        }
        fn seat_at_table() {
            println!("seat at table");
        }
    }

    mod serving {
        fn take_order() {
            println!("take order");
        }
        fn serve_order() {
            println!("serve order");
        }
        fn take_payment() {
            println!("take payment");
        }
    }
}

pub fn eat_at_restaurant() {
    crate::front_of_house::hosting::add_to_waitlist();
    front_of_house::hosting::add_to_waitlist();
}
```

**æ³¨æ„ç‚¹**ï¼šå› ä¸ºæ˜¯é»˜è®¤æ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†`hosting`å’Œ`add_to_waitlist`éƒ½å¢åŠ `pub`å…³é”®å­—ï¼Œä¸ç„¶ç¼–è¯‘è¿˜æ˜¯ä¼šæŠ¥é”™

ç›®å‰ä¸Šè¿°ä»£ç å·²ç»èƒ½å¤Ÿæ­£å¸¸ç¼–è¯‘äº†~

#### 9.3.3 ä½¿ç”¨`super`å…³é”®å­—è°ƒç”¨ç›¸å¯¹è·¯å¾„æ–¹æ³•

å¦‚æœä¸€ä¸ªå­æ¨¡å—æƒ³è°ƒç”¨å…„å¼Ÿæ¨¡å—æˆ–è€…çˆ¶æ¨¡å—çš„ä¸€äº›é¡¹ç›®æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨`super`å…³é”®å­—ï¼Œå…¶ä½œç”¨ç±»ä¼¼shellä¸­çš„`..`åˆ°ä¸Šä¸€ä¸ªä½œç”¨åŸŸçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨ç›¸å…³çš„é¡¹ç›®ã€‚

ä»¥ä¸Šè¿°`9.3.2`ä¸­ï¼Œå¦‚æœå­æ¨¡å—`serving`æƒ³è¦è°ƒç”¨`hosting`ä¸­çš„æ–¹æ³•ï¼Œç°åœ¨å°±éœ€è¦ä½¿ç”¨`super`å…³é”®å­—ã€‚

```rust
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {
            println!("add to wait list");
            self::seat_at_table();
        }
        fn seat_at_table() {
            println!("seat at table");
        }
    }

    mod serving {
        fn take_order() {
            println!("take order");
            // ç”¨superåˆ°çˆ¶çº§
            // ç„¶åè°ƒç”¨çˆ¶çº§hostingä¸­çš„add_to_waitlist
            super::hosting::add_to_waitlist();
        }
        fn serve_order() {
            println!("serve order");
        }
        fn take_payment() {
            println!("take payment");
        }
    }
}
```

#### 9.3.4 å°†structå’Œenumè®¾ç½®ä¸ºå…¬å¼€çš„

**structæ¨¡å—çš„æ³¨æ„ç‚¹**

1. structåœ¨è®¾ç½®ä¸º`pub`çš„æ—¶å€™ï¼Œç›¸åº”çš„éœ€è¦å¯¹å¤–æš´éœ²çš„å±æ€§ä¹Ÿéœ€è¦ç”¨`pub`å…³é”®å­—å£°æ˜
2. åœ¨å®ç°å¯¹åº”çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœè¯¥æ–¹æ³•éœ€è¦å‘å¤–æš´éœ²ä¹Ÿéœ€è¦å¢åŠ `pub`

```rust
mod back_of_house {
    pub struct Breakfast {
        pub toast: String,
        // è¿™é‡Œä½¿ç”¨çš„æ—¶å€™seasonal_fruitæ˜¯ä¸å¯ä»¥ä½¿ç”¨çš„ï¼Œå› ä¸ºæ˜¯ç§æœ‰å˜é‡
        seasonal_fruit: String,
    }

    impl Breakfast {
            pub fn summer(toast: &str) -> Breakfast {
                Breakfast {
                    toast: String::from(toast),
                    // è¿™ä¸ªseasonal_fruitæ˜¯ç§æœ‰å˜é‡
                    // è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰è¿™ä¸ªsummeræ–¹æ³•
                    // æˆ‘ä»¬å¯èƒ½ä¸€è¾ˆå­éƒ½æ²¡åŠæ³•åˆ›å»ºBreakfast
                    // å› ä¸ºseasonal_fruitæ˜¯ä¸å¯è®¿é—®çš„
                    seasonal_fruit: String::from("Peach"),
                }
            }

            pub fn tell_fruit_food(&self) {
                // å®ä¾‹æ–¹æ³•é€šè¿‡selfå¯ä»¥è°ƒåˆ°å†…éƒ¨çš„ç§æœ‰å˜é‡
                println!("fruit is -> {}", self.seasonal_fruit);
            }
       }
    }
}

pub fn eat_at_restaurant() {
    crate::front_of_house::hosting::add_to_waitlist();
    front_of_house::hosting::add_to_waitlist();

    let mut meal = back_of_house::Breakfast::summer("Rye");

    // è¿™é‡Œmeal.seasonal_fruitæ˜¯æ— æ³•è¢«è®¿é—®çš„ï¼Œå› ä¸ºæ˜¯ç§æœ‰å˜é‡
    meal.toast = String::from("Wheat");
    println!("I'd like {} toast, please", meal.toast);
}
```

**enumæ¨¡å—æ³¨æ„ç‚¹**

1. æšä¸¾å€¼åœ¨ä½œä¸ºæ¨¡å—ç§æœ‰åŒ–ä¸­åªéœ€è¦å°†å¯¹åº”çš„æšä¸¾å€¼è®¾ç½®ä¸º`pub`å³å¯ï¼Œä¸éœ€è¦å¯¹ä¸‹é¢æ¯ä¸ªæšä¸¾å€¼å®šä¹‰ä¸º`pub`

```rust
mod back_of_house {
    // ...
    pub enum Appetizer {
        Soup,
        Salad
    }

    impl Breakfast {
        pub fn summer(toast: &str) -> Breakfast {
            Breakfast {
                toast: String::from(toast),
                // è¿™ä¸ªseasonal_fruitæ˜¯ç§æœ‰å˜é‡
                seasonal_fruit: String::from("Peach"),
            }
        }

        pub fn tell_fruit_food(&self) {
            println!("fruit is -> {}", self.seasonal_fruit);
        }
    }
}

pub fn eat_at_restaurant() {
    let mut appetizer = back_of_house::Appetizer::Soup;
}
```

ç°åœ¨æˆ‘ä»¬å·²ç»ä¼šå®šä¹‰å¯¹åº”çš„æ¨¡å—äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ä½¿ç”¨`use`å…³é”®å­—ï¼Œä½¿ç”¨å…³é”®å­—æ¥ä½¿ç”¨å¯¹åº”çš„æ¨¡å—

### 9.4 ä½¿ç”¨useå…³é”®å­—å°†åŒ…å¼•å…¥åˆ°ä½œç”¨åŸŸä¸­

#### 9.4.1 ä½¿ç”¨useå…³é”®å­—å°†æš´éœ²æ¨¡å—å¼•å…¥ä½œç”¨åŸŸ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`use`å…³é”®å­—ï¼Œåˆ›å»ºè·¯å¾„å’Œä½œç”¨åŸŸä¹‹é—´çš„è¿æ¥ã€‚ä¹‹å‰çš„ä»£ç ä¸­çš„`Breakfast`ç»“æ„ä½“å’Œ`hosting`å­æ¨¡å—ï¼Œéƒ½éœ€è¦é€šè¿‡ç»å¯¹è·¯å¾„ä¸€è‡´å¼•ç”¨çˆ¶æ¨¡å—ï¼Œè¿™æ ·å†™èµ·æ¥ååˆ†æµªè´¹æ—¶é—´ï¼Œä»£ç ä¹Ÿä¸å¤ªæ¸…æ¥šï¼ˆæ¯”è¾ƒå†—ä½™ï¼‰ï¼Œå¯ä»¥é€šè¿‡`use`å…³é”®å­—æ¥ç®€åŒ–ï¼š

```rust
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {
            println!("add to wait list");
            self::seat_at_table();
        }
        fn seat_at_table() {
            println!("seat at table");
        }
    }

    mod serving {
        fn take_order() {
            println!("take order");
            super::hosting::add_to_waitlist();
        }
        fn serve_order() {
            println!("serve order");
        }
        fn take_payment() {
            println!("take payment");
        }
    }
}

mod back_of_house {
    pub struct Breakfast {
        pub toast: String,
        seasonal_fruit: String,
    }

    pub enum Appetizer {
        Soup,
        Salad
    }

    impl Breakfast {
        pub fn summer(toast: &str) -> Breakfast {
            Breakfast {
                toast: String::from(toast),
                // è¿™ä¸ªseasonal_fruitæ˜¯ç§æœ‰å˜é‡
                seasonal_fruit: String::from("Peach"),
            }
        }

        pub fn tell_fruit_food(&self) {
            println!("fruit is -> {}", self.seasonal_fruit);
        }
    }
}

// å°†hostæ³¨å…¥åˆ°è¿™ä¸ªä½œç”¨åŸŸä¸­
// å°†Breakfastæ³¨å…¥åˆ°è¿™ä¸ªä½œç”¨åŸŸä¸­
// å°†Appetizeræ³¨å…¥åˆ°æœ¬ä½œç”¨åŸŸä¸­
use crate::front_of_house::hosting;
use crate::back_of_house::Breakfast;
use crate::back_of_house::Appetizer;

pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
    hosting::add_to_waitlist();
    hosting::add_to_waitlist();

    let mut meal = Breakfast::summer("Rye");

    meal.toast = String::from("Wheat");

    let mut appetizer = Appetizer::Soup;

    println!("I'd like {} toast, please", meal.toast);
}
```

#### 9.4.2 ç¼–å†™ç¬¦åˆä¹ æƒ¯çš„useè·¯å¾„

**ä¸ºä»€ä¹ˆè¦è§„èŒƒçš„å†™å¼•å…¥è·¯å¾„ï¼Ÿ**

1. å½“æˆ‘ä»¬ä½¿ç”¨`use`å†™åé¢çš„è·¯å¾„çš„æ—¶å€™ï¼Œå°½é‡å†™åˆ°æœ€è¿‘æ¨¡å—ï¼ˆç¦»å½“å‰æ–¹æ³•æ¥è¯´æœ€è¿‘çš„é‚£ä¸ªä½œç”¨åŸŸï¼‰çš„åœ°å€ï¼Œä¸å»ºè®®å°†æ•´ä¸ªè·¯å¾„å†™å®Œæ•´ï¼Œä¸åˆ©äºåæœŸåŠ ä½¿ç”¨çš„æ”¾ï¼Œå¹¶ä¸”ä¸»å­åŸŸçš„åˆ’åˆ†ä¹Ÿä¸å¤ª æ¸…æ™°ã€‚
2. å¦‚æœä¸¤ä¸ªå…ƒç´ æœ‰ç›¸åŒçš„éœ€è¦å¼•å‡ºçš„ä¸œè¥¿ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬å¼•å…¥è·¯å¾„ä»…ä»…å†™åˆ°é‚£ä¸ª`struct`æˆ–è€…å…¶ä»–é¡¹ï¼Œå¯èƒ½ä¼šæœ‰é‡åå†²çªã€‚

#### 9.4.3 ç”¨`as`å…³é”®å­—ä¸ºæ¨¡å—æä¾›ä¸€ä¸ªæ–°çš„åå­—

`9.4.2`ä¸­è¯´å¦‚æœå­˜åœ¨å¯¼å‡ºçš„ä¸¤ä¸ªæ¨¡å—é‡åæ€ä¹ˆåŠï¼Œå¯ä»¥ä½¿ç”¨`as`å…³é”®å­—ï¼Œå°†å¯¼å‡ºçš„æ¨¡å—å†…å®¹è¿›è¡Œâ€œæ”¹åâ€

```rust
// åç»­ä½¿ç”¨Resultçš„åœ°æ–¹æ”¹æˆFmtResultå³å¯
use std::fmt::Result as FmtResult;

fn main() {
    println!("Hello, world!");
}
```

#### 9.4.4 ä½¿ç”¨`pub use`å¯¼å‡ºå‘½å

å½“ä½¿ç”¨`use`å¼•å…¥æ¨¡å—çš„æ—¶å€™ï¼Œå¯èƒ½è¿™ä¸ª`name`åœ¨ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸä¸­æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`pub use`è®©æˆ‘ä»¬å¼•ç”¨çš„æ¨¡å—åœ¨ä»£ç ä½œç”¨åŸŸä¸­å¼å…¬å¼€å¯ç”¨çš„ã€‚å½“ä½¿ç”¨äº†`pub use`ä¹‹åå¤–éƒ¨ä»£ç å¯ä»¥ä½¿ç”¨ç›¸åº”çš„æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨`pub use`åªæœ‰åœ¨ä»–è‡ªå·±çš„ä½œç”¨åŸŸä¸­èƒ½å¤Ÿä½¿ç”¨ç›¸å…³`use`çš„æ–¹æ³•

#### 9.4.5 ä½¿ç”¨å¤–éƒ¨åŒ…

ä½¿ç”¨å¤–éƒ¨åŒ…çš„æ­¥éª¤ï¼š

1. åœ¨`cargo.toml`æ–‡ä»¶ä¸­å¢åŠ éœ€è¦å¼•å…¥ä¾èµ–çš„åŒ…åå’Œç‰ˆæœ¬
   
   ```toml
   [package]
   name = "lesson_8_package"
   version = "0.1.0"
   edition = "2021"
   
   # See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
   
   [dependencies]
   rand="0.8.3"
   ```

2. åœ¨å¯¹åº”çš„ä½œç”¨åŸŸä¸­ï¼Œé€šè¿‡`use`å…³é”®è¯å°†å¯¹åº”çš„æ¨¡å—è¿›è¡Œå¯¼å…¥
   
   ```rust
   use rand::Rng;
   
   fn main() {
       let rand_number = rand::thread_rng().gen_range(1..10);
   }
   ```

#### 9.4.6 ä½¿ç”¨é›†æˆè·¯å¾„æ¥æ¸…é™¤å¤§çš„`use`åˆ—è¡¨

å¦‚æœæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªåŒ…ä¸­çš„å¤šä¸ªé¡¹ç›®ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬é€šè¿‡å•ä¸€çš„`use`å»å†™çš„è¯ï¼Œå¦‚æœå¼•å…¥100ä¸ªé¡¹ç›®ï¼Œå¯èƒ½å°±è¦å†™å‚ç›´çš„100è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®å¯ä»¥ä½¿ç”¨èšé›†çš„æ–¹å¼æ¥å†™ï¼Œå…·ä½“çš„æˆ‘ä»¬å¯ä»¥å‚è€ƒä»¥ä¸‹çš„ä¾‹å­ï¼š

```rust
// èšåˆä¹‹å‰çš„å†™æ³•
mod lib;

use lib;
use lib::front_of_house;
use lib::eat_at_restaurant;

// èšåˆä¹‹åçš„å†™æ³•

// è¿™é‡Œçš„selfä»£è¡¨libæœ¬èº«ï¼Œåé¢ç±»ä¼¼importæ—¶å€™çš„è§£æ„çš„å†™æ³•
use lib::{ self as my_lib, eat_at_restaurant, front_of_house };
```

#### 9.4.7 å…¨å±€æ“ä½œç¬¦

å¦‚æœæˆ‘ä»¬æƒ³å¼•å…¥æ‰€æœ‰å…¬å¼€çš„é¡¹ç›®åœ¨å½“å‰ä½œç”¨åŸŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`*`ä½¿ç”¨è¿™ä¸ªå…¨å±€æ“ä½œç¬¦çš„ä¾‹å­å¦‚ä¸‹ï¼š

```rust
mod lib;
use lib::*;

fn main() {
    println!("Hello, world!");
    eat_at_restaurant();
    let mut appetizer = back_of_house::Breakfast::summer("Brand");
    front_of_house::hosting::add_to_waitlist();
}
```

**è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨å…¥ï¼Œå¦‚æœå¤šä¸ªæ¨¡å—éƒ½æ˜¯å…¨éƒ¨å¯¼å…¥ä¼šä¸ä¼šæœ‰é‡åçš„å†²çªæƒ…å†µ**ï¼ˆæ…ç”¨ï¼‰

### 9.5 åˆ†ç¦»æ¨¡å—åœ¨å¤šä¸ªå…¶ä»–æ–‡ä»¶ä¸­

ç›®å‰æ‰€æœ‰çš„æ¨¡å—éƒ½æ˜¯å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢çš„ï¼Œä½†æ˜¯å°†ä¸€äº›é€šç”¨çš„å‡½æ•°æ–¹æ³•æ‹†å‡ºæ¥å…¶æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†åœ¨åˆ«çš„æ–‡ä»¶ä¸­å¤ç”¨ï¼Œå¦‚ä½•åœ¨åˆ«çš„æ–‡ä»¶ä¸­å¤ç”¨å‘¢ï¼Ÿ

1. ä½¿ç”¨`mod`å…³é”®å­—ç”³æ˜å¯¹åº”çš„æ–‡ä»¶ï¼ˆæ–‡ä»¶åæ˜¯ä»€ä¹ˆå£°æ˜çš„å°±æ˜¯ä»€ä¹ˆï¼‰
2. ä½¿ç”¨`use`å…³é”®å­—ï¼Œå°†æ¨¡å—ä¸­çš„éƒ¨åˆ†é¡¹ç›®å¼•å…¥åˆ°ç›¸åº”ä½œç”¨åŸŸä¸­

```rust
// main.rs
// ä¹‹å‰å†™å‡½æ•°çš„æ–‡ä»¶åä¸ºlib.rs æ‰€ä»¥è¿™é‡Œæ˜¯mod lib
mod lib;

use lib::front_of_house;
use lib::eat_at_restaurant;

fn main() {
    println!("Hello, world!");
    eat_at_restaurant();
    front_of_house::hosting::add_to_waitlist();
}
```

### æ€»ç»“

rustè®©æˆ‘ä»¬å»åˆ‡åˆ†è‡ªå·±çš„æ–‡ä»¶é€šè¿‡å¤šä¸ªç®±ï¼Œç„¶åä¸€ä¸ªç®±ä¸­å¯ä»¥åˆ‡åˆ†å¤šä¸ªæ¨¡å—ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å¼•ç”¨å¤šä¸ªæ¨¡å—ä¸­çš„é¡¹ç›®ã€‚ ä½ å¯ä»¥é€šè¿‡ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„çš„æ–¹å¼å¼•ç”¨ç›¸åº”çš„åŒ…ï¼Œé€šè¿‡`use`ä½œç”¨åŸŸæ¥è®²å¯¹åº”çš„æ¨¡å—å¼•å…¥åˆ°ä½œç”¨åŸŸä¸­ã€‚æ¨¡å—çš„ä»£ç é»˜è®¤æ˜¯ç§æœ‰åŒ–çš„ï¼Œä½ å¯ä»¥é€šè¿‡`pub`å…³é”®å­—æ¥ä½¿å…¶å˜æˆå…¬æœ‰åŒ–ã€‚

## 10. å¸¸ç”¨é›†åˆ

### å†™åœ¨å‰é¢

Rustæ ‡å‡†åº“åŒ…å«ç€ä¸€ç§é›†åˆçš„æ•°æ®ç»“æ„ï¼Œç§°ä¹‹ä¸ºé›†åˆã€‚é›†åˆå’Œå…¶ä»–æ•°æ®ç»“æ„ä¸ä¸€æ ·çš„åœ°æ–¹åœ¨äºï¼Œé›†åˆå¯ä»¥åŒ…å«å¤šç§ä¸åŒçš„æ•°æ®è§£æ„äºä¸€èº«ã€‚ä¸æ•°ç»„å’Œå…ƒç»„ä¸åŒï¼Œé›†åˆæ˜¯å­˜åœ¨å †ä¸­çš„ï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶ä»–ä¸éœ€è¦çŸ¥é“æ•°æ®çš„å¤§å°ï¼Œåœ¨ç¨‹åºè·‘èµ·æ¥çš„æ—¶å€™å¯èƒ½å¢åŠ æˆ–è€…ç¼©å‡å¯¹åº”çš„å¤§å°ã€‚

å› æ­¤ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€‰æ‹©åˆé€‚çš„é›†åˆï¼Œæ˜¯ä¸€ç§æŠ€å·§ã€‚æœ¬ç« ä¸­å°†è®¨è®ºä¸‰ç§rustä¸­å¸¸ç”¨çš„é›†åˆï¼š

+ å‘é‡ï¼šå…è®¸å­˜å‚¨å˜é‡åœ¨ç›¸é‚»çš„ä½ç½®
+ å­—ç¬¦ä¸²é›†åˆï¼šæœ¬ç« å°†å¯¹Stringç±»å‹è¿›å…¥æ·±åˆ»çš„æ¢è®¨
+ hashmapï¼šå…è®¸ä½¿ç”¨ç‰¹æ®Šçš„é”®æ¥å…³è”å€¼ï¼Œæ›´é€šç”¨çš„æ•°æ®è§£æ„ç§°ä¸ºmap

### 10.1 é€šè¿‡å‘é‡æ¥å­˜å‚¨åˆ—è¡¨å€¼

ç¬¬ä¸€ç§é›†åˆç±»å‹ç§°ä¸ºå‘é‡ï¼Œç”¨`Vec<T>`æ¥è¡¨ç¤ºï¼Œå‘é‡æ˜¯ä¸€ç§å¯ä»¥å­˜å‚¨å¤šä¸ªå€¼çš„å•ä¸€æ•°æ®ç»“æ„ï¼Œåœ¨å†…å­˜ä¸­å¤šä¸ªå€¼æ˜¯å½¼æ­¤è´´è¿‘å­˜å‚¨çš„ã€‚**å‘é‡åªèƒ½å­˜å‚¨ç›¸åŒæ•°æ®ç±»å‹çš„å€¼**ï¼Œå½“ä½ æœ‰å¤šä¸ªç›¸åŒç±»å‹çš„åˆ—è¡¨éœ€è¦å­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨ä»–ã€‚

#### 10.1.1 åˆ›å»ºä¸€ä¸ªæ–°çš„å‘é‡

æˆ‘ä»¬é€šè¿‡`Vec::new`æ¥åˆ›å»ºä¸€ä¸ªå‘é‡å®ä¾‹ã€‚å› ä¸ºå‘é‡åªèƒ½æ¥æ”¶ä¸€ç§æ•°æ®ç±»å‹çš„ç»“æ„ï¼Œæ‰€ä»¥é€šè¿‡æ³›å‹æ¥è®¾ç½®è¿™ä¸ªå‘é‡å¯ä»¥æ¥æ”¶æ•°æ®çš„ç±»å‹ä¸º`i32`ã€‚åœ¨æ›´å¸¸ç”¨çš„ä»£ç ä¸­ï¼Œ**ä¸€æ—¦ä½ æ’å…¥äº†ç›¸å…³çš„å€¼ï¼ŒRustå¯ä»¥è‡ªåŠ¨æ¨æ–­å‡ºä½ æƒ³å­˜å‚¨å€¼çš„ç±»å‹**ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦å»è¿›è¡Œç±»å‹çš„å£°æ˜ã€‚ç›¸è¾ƒäº`Vec<T>`é€šè¿‡`vec!`å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰åˆå§‹å€¼çš„å‘é‡ï¼Œä¼šæ›´åŠ çš„æ–¹ä¾¿ï¼Œå…¶å†™æ³•å¦‚ä¸‹ï¼š

```rust
fn main() {
    let mut v: Vec<i32> = Vec::new();
    let mut v2 = vec![1, 2, 3];
}
```

**æ³¨æ„ç‚¹**

Q1ï¼š Vecå’ŒArrayçš„åŒºåˆ«

A1ï¼š Vecå¯ä»¥é€šè¿‡`push`ç›´æ¥æ‰©å±•ï¼Œå…¶æ‰©å±•çš„åŸç†æ˜¯é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†è€çš„ç©ºé—´å¤åˆ¶åˆ°æ–°çš„å†…å­˜ç©ºé—´ä¸Šï¼Œè€Œ`Array`æ˜¯è¿ç»­çš„ç©ºé—´ï¼Œæ‰€ä»¥è¦æå‰å£°æ˜é•¿åº¦ï¼Œé˜²æ­¢è¶Šç•Œã€‚



#### 10.1.2 æ›´æ–°å‘é‡å€¼

é€šè¿‡`push`çš„æ–¹å¼æ¥ä¸ºå‘é‡å¢åŠ å…ƒç´ ã€‚

```rust
fn main() {
    let mut v: Vec<i32> = Vec::new();
    v.push(3);

    let mut v2 = vec![1, 2, 3];
    // å¦‚æœè¿™é‡Œ
    v2.push(4);
}
```
**æ³¨æ„ç‚¹**

éœ€è¦ç±»å‹ç›¸åŒï¼Œå¦‚æœæˆ‘è¿™ä¸ªæ—¶å€™æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œä¼šå¦‚ä¸‹é”™è¯¯æŠ¥é”™

>  expected integer, found struct `std::string::String`



#### 10.1.3 åˆ é™¤å‘é‡å…ƒç´ 

**åˆ é™¤æ•´ä¸ªå‘é‡**ï¼šå‘é‡ä¹Ÿéµå®ˆæ‰€æœ‰è€…åŸåˆ™ï¼Œå½“å…¶åœ¨æ‰€æœ‰è€…åŒºå¤–çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥GCå›æ”¶æ•´ä¸ªå‘é‡ï¼Œå¹¶ä¸”å…¶ä¸­çš„å†…å®¹ä¹Ÿä¼šè¢«å›æ”¶äº†ã€‚



#### 10.1.4 è¯»å–å‘é‡å…ƒç´ 

æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¯»å–å‘é‡çš„å€¼ï¼š1. é€šè¿‡ç´¢å¼• 2. åˆ©ç”¨æä¾›çš„`get`æ–¹æ³•ã€‚

å› ä¸ºæˆ‘ä»¬å·²ç»å£°æ˜äº†å‘é‡çš„ç±»å‹ï¼Œæ‰€ä»¥å¾—åˆ°å€¼çš„ç±»å‹æ˜¯ååˆ†æ¸…æ¥šçš„ã€‚

```rust
fn main() {
    let mut v: Vec<i32> = Vec::new();
    v.push(3);

    let mut v2 = vec![1, 2, 3];
    v2.push(4);

    let thrid: &i32 = &v2[2];
    println!("{}", thrid);

    let fourth = v2.get(2);

    match fourth {
        Some(value) => println!("value -> {}", value),
        None => println!("no value")
    }
}
```

**æ³¨æ„ç‚¹**

1. ç´¢å¼•çš„æ–¹å¼å–å€¼æ˜¯ä»0å¼€å§‹çš„

2. ä½¿ç”¨ç´¢å¼•æ–¹å¼æ‹¿åˆ°çš„æ˜¯å€Ÿç”¨çš„å€¼ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å¼•ç”¨ï¼Œéœ€è¦åŠ ä¸Š`&`

3. åˆ©ç”¨`get`æ–¹æ³•æ‹¿åˆ°çš„å€¼æ˜¯`Option<&T>`ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨`match`æˆ–`if let`è¯­æ³•è¿›è¡Œæ“ä½œ

4. **å¯¹äºä¸å­˜åœ¨çš„å¼•ç”¨**ï¼Œä½¿ç”¨ç´¢å¼•çš„æ–¹å¼è·å–å¯¹åº”çš„å€¼å¯èƒ½ä¼šå¯¼è‡´ç¨‹åºçš„å´©æºƒï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™å¼•ç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼ï¼Œä½†æ˜¯å¦‚æœé€šè¿‡`get`æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè¿”å›ä¸€ä¸ª`None`

5. å¦‚æœä¸€ä¸ªå€¼å·²ç»è¢«å€Ÿç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™å†å‘å‘é‡æ·»åŠ å…ƒç´ è¿™ä¸ªæ—¶å€™ä¼šæŠ¥é”™

   > cannot borrow `v2` as mutable because it is also borrowed as immutable. 

   ```rust
   fn main() {
       let mut v2 = vec![1, 2, 3];
       let thrid = &v2[2];
   
       v2.push(4);  // è¿™é‡Œä¼šæŠ¥é”™
   }
   
   // è§£å†³åŠæ³•
fn main() {
       let mut v2 = vec![1, 2, 3];
   
       // å‰åŠ‚åŠæ³•æ˜¯
       {
           let thrid = &v2[2];
           println!("{}", thrid);
       }
   
       v2.push(4);
   }
   ```
   
   **è§£å†³åŠæ³•**ï¼šå°†`push`è¯­å¥å‰ç½®æˆ–è€…ä½¿ç”¨æ‰€æœ‰è€…ï¼Œå°†å¯¹åº”çš„å¼•ç”¨å…ˆé‡Šæ”¾ï¼Œå…¶åŸå› æ˜¯ï¼Œè¿™ç§åœºæ™¯ä¸‹éœ€è¦æ‰©å±•å‘é‡å®¹ç§¯ï¼Œä½†æ˜¯å› ä¸º`v2[2]`å·²ç»è¢«å€Ÿç”¨ï¼Œä¸èƒ½ç§»åŠ¨å…¶ç©ºé—´åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ç»´æŒåŸçŠ¶ï¼Œ`push`æ–¹æ³•ä¸èƒ½å¢åŠ å…ƒç´ äº†ã€‚

#### 10.1.5 å‘é‡ä¸­å€¼çš„è¿­ä»£ç‰¹æ€§

ä½¿ç”¨`for...inè¯­æ³•`å¯ä»¥é€šè¿‡è¿­ä»£å™¨çš„æ–¹å¼éå†ç›¸åº”çš„å¯è¿­ä»£ç±»å‹ã€‚

```rust
fn main () {
    // å¯¹v2çš„å¼•ç”¨è¿›è¡Œéå†
    for item in &v2 {
        // è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨forå¾ªç¯
        // å¯¹v2è¿›è¡Œéå†æ“ä½œ
        println!("value => {}", item);
    }
}
```

å¦‚æœæƒ³å¯¹å¯¹åº”éå†çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œ**å¯ä»¥ä½¿ç”¨`*`è¿ç®—ç¬¦æ”¾åœ¨å¯¹åº”çš„å˜é‡ä¹‹å‰ï¼Œå³å¯å¯¹å¼•ç”¨ç±»å‹è¿›è¡Œä¿®æ”¹**ï¼š

```rust
fn main() {
    let mut v2 = vec![1, 2, 3];

    for i in &mut v2 {
        *i = *i * 100 / 2;
    }

    for item in &v2 {
        println!("value => {}", item);
        // value => 50
        // value => 100
        // value => 150
    }
}
```

**æ³¨æ„ç‚¹**ï¼š

+ å¦‚æœéœ€è¦å¯¹å¯¹åº”çš„å˜é‡è¿›è¡Œä¿®æ”¹ï¼Œç±»ä¼¼`javascript`ä¸­çš„`map`çš„ç”¨æ³•ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹å‡ ç‚¹
  + ä½¿ç”¨`mut`åœ¨å¼•ç”¨å˜é‡ä¹‹å‰
  + ä½¿ç”¨`*`åœ¨å¯¹åº”çš„å˜é‡ä¹‹å‰ï¼Œè¿™æ˜¯ä¸€ç§æŒ‡é’ˆçš„ç”¨æ³•ï¼Œ åœ¨åç»­ç« èŠ‚ä¼šè®²åˆ°
  + å¯¹å¯¹åº”çš„å˜é‡è¿›è¡Œæ“ä½œï¼Œéœ€è¦ä½¿ç”¨`*i`åœ¨ç­‰å¼å·¦å³ä¸¤è¾¹



#### 10.1.6 ä½¿ç”¨æšä¸¾ç±»å‹æ¥å­˜å‚¨å¤šç±»å‹

å¦‚æœå‘é‡åªç”¨æ¥å­˜å‚¨ä¸€ç§ç±»å‹çš„å€¼ï¼Œåœ¨ä½¿ç”¨ä¸Šä¼šä¸å¤ªæ–¹ä¾¿ã€‚å¹¸è¿çš„æ˜¯ï¼Œæšä¸¾çš„è¡ç”Ÿç±»å‹å¯ä»¥è®©æˆ‘ä»¬å®šä¹‰å¤šç§ä¸åŒçš„ç±»å‹ï¼Œä¹‹åæ‰€æœ‰æšä¸¾çš„è¡ç”Ÿç±»éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬éœ€è¦åœ¨å‘é‡ä¸­å­˜å‚¨ä¸åŒç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰æšä¸¾ç±»ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰æšä¸¾ç±»çš„è¡ç”Ÿç±»å‹ï¼Œæ¥åŒºåˆ†ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œè¿™æ ·æ‰€æœ‰å­˜å‚¨åœ¨è¿™ä¸ªå‘é‡ä¸­çš„ç±»å‹éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯æˆ‘ä»¬å®šä¹‰çš„è¿™ä¸ªæšä¸¾ç±»ã€‚

```rust
pub mod EnumTypesTest {
    #[derive(Debug)]
    pub enum SpreadSheetCell {
        Int(i32),
        Float(f64),
        Text(String)
    }
    

    pub fn useMultiTypes () {
        // è¿™ä¸ªå‘é‡ä¸­æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯SpreadSheetCell
        let row = vec![
            SpreadSheetCell::Int(3),
            SpreadSheetCell::Float(3.14),
            SpreadSheetCell::Text(String::from("string"))
        ];

        for item in &row {
            println!("types -> {:?}", item);
        }
    }
}
```

Ruståœ¨ç¼–è¯‘æ—¶éœ€è¦çŸ¥é“å¯¹åº”å­˜å‚¨å…ƒç´ çš„ç±»å‹ï¼Œä»¥è‡³äºçŸ¥é“å®é™…åœ¨è¿è¡Œæ—¶éœ€è¦åœ¨å †ä¸­åˆ†é…å¤šå°‘å†…å­˜ã€‚ç¬¬äºŒä¸ªä¼˜åŠ¿æ˜¯rustå¯ä»¥æ¨æ–­å‡ºè¿™ä¸ªå‘é‡ä¸­å­˜å‚¨å…ƒç´ çš„ç±»å‹ã€‚



#### 10.1.7 å‘é‡çš„å…¶ä»–APIç”¨æ³•

å…·ä½“çš„apiå¯ä»¥å‚è€ƒç›¸å…³çš„apiæ–‡æ¡£ï¼š[Struct Vec](https://doc.rust-lang.org/std/vec/struct.Vec.html)

1. åˆ‡ç‰‡

   ```rust
   fn read_slice(slice: &[usize]) {
       // ...
   }
   
   let v = vec![0, 1];
   read_slice(&v);
   ```

2. åˆ†é…å®¹é‡

   ```rust
   // å’Œallocä¸€æ ·åˆ†é…10ä¸ªå­˜å‚¨ç©ºé—´
   let mut vec = Vec::with_capacity(10);
   
   // lenè·å–å·²å­˜å‚¨æ•°æ®çš„é•¿åº¦
   assert_eq!(vec.len(), 0);
   // capacityè·å–åˆ†é…ç©ºé—´çš„é•¿åº¦
   assert_eq!(vec.capacity(), 10);
   
   // These are all done without reallocating...
   for i in 0..10 {
       vec.push(i);
   }
   assert_eq!(vec.len(), 10);
   assert_eq!(vec.capacity(), 10);
   ```

3. å…ƒç´ çš„æ“ä½œ

   ```rust
   // push
   let mut vec = vec![1, 2];
   vec.push(3);
   assert_eq!(vec, [1, 2, 3]);
   
   // popå¼¹å‡ºå…ƒç´ 
   let mut vec = vec![1, 2, 3];
   assert_eq!(vec.pop(), Some(3));
   assert_eq!(vec, [1, 2]);
   
   // appendåˆå¹¶ä¸¤ä¸ªå‘é‡
   // å°†ç¬¬ä¸€ä¸ªå‘é‡å’Œç¬¬äºŒä¸ªå‘é‡åˆå¹¶ï¼Œå¹¶ä¸”æ¸…ç©ºç¬¬äºŒä¸ªiå‘é‡
   let mut vec = vec![1, 2, 3];
   let mut vec2 = vec![4, 5, 6];
   vec.append(&mut vec2);
   assert_eq!(vec, [1, 2, 3, 4, 5, 6]);
   assert_eq!(vec2, []);
   
   // æ¸…ç©ºæ•°ç»„
   // drainå’Œspliceæœ‰ç‚¹åƒï¼ŒåŸå‘é‡ä¿å­˜åˆ‡ç‰‡ä¹‹å‰çš„å†…å®¹ï¼Œä¸¢æ‰åˆ‡ç‰‡ä¹‹åçš„å†…å®¹
   let mut v = vec![1, 2, 3];
   let u: Vec<_> = v.drain(1..).collect();
   assert_eq!(v, &[1]);
   assert_eq!(u, &[2, 3]);
   
   // A full range clears the vector
   v.drain(..);
   assert_eq!(v, &[]);
   
   //clearç›´æ¥æ¸…ç©ºå¯¹åº”çš„å‘é‡
   let mut v = vec![1, 2, 3];
   
   v.clear();
   
   assert!(v.is_empty());
   ```



### 10.2 é€šè¿‡Stringå­˜å‚¨UTF-8æ–‡æœ¬

æœ¬å°èŠ‚å°†æ›´æ·±åº¦ä½¿ç”¨Stringç±»å‹ï¼Œrustä½¿ç”¨è€…å› ä¸ºä»¥ä¸‹ä¸‰ä¸ªåŸå› å¯¼è‡´å¯¹stringä½¿ç”¨å›°éš¾ï¼š

+ Rustå€¾å‘äºå»æŠ›å‡ºå¯èƒ½çš„é”™è¯¯
+ Stringç±»å‹å¯èƒ½æ¯”å¾ˆå¤šcoderæƒ³è±¡çš„æ›´å¤æ‚
+ UTF-8

æ‰€ä»¥å½“ä½ ä»å…¶ä»–è¯­è¨€è½¬è¿‡æ¥å¼€å‘rustï¼Œå‘ç°ä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚æœ¬èŠ‚å°†è®¨è®ºStringçš„åˆ›å»ºã€æ›´æ–°å’Œè¯»å†™



#### 10.2.1 ä»€ä¹ˆæ˜¯String

åœ¨rustä¸­åªæœ‰ä¸€ç§stringç±»å‹ï¼Œå…¶ç±»å‹ä¸º`str`ï¼Œé€šå¸¸åœ¨å€Ÿç”¨çš„æ—¶å€™å†™ä½œ`&str`å€Ÿç”¨å¯¹åº”çš„å¼•ç”¨ã€‚

`String`ç±»é€šè¿‡rustçš„æ ‡å‡†åº“æä¾›è€Œä¸æ˜¯åˆå§‹æ•°æ®ç»“æ„ï¼Œæ˜¯å¯æ‰©å±•çš„ï¼Œè€Œå¯å˜çš„UTF-8çš„stringç±»å‹ã€‚

æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„æ˜¯`String`æˆ–`&str`åˆ‡ç‰‡ï¼Œåœ¨Rustæ ‡å‡†åº“ä¸­è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„Stringç±»å‹æ¯”å¦‚`OsString`ã€`OsStr`ã€`CString`ç­‰ã€‚



#### 10.2.2 Stringçš„åˆ›å»º

Stringçš„åˆ›å»ºç›®å‰æœ‰ä¸‰ç§æ–¹å¼ï¼š

+ ä½¿ç”¨`new`æ–¹æ³•
+ ä½¿ç”¨`from`æ–¹æ³•
+ ä½¿ç”¨`str`è‡ªå¸¦çš„`to_string`æ–¹æ³•

```rust
pub mod StringDemo {
    pub fn StringCreate() {
        let mut s = String::new();

        let data = "new string";

        let s1 = data.to_string();

        let s2 = String::from(data);

        println!("s1 -> {}, s2 -> {}", s1, s2)
    }
}
```



#### 10.2.3 Stringçš„æ›´æ–°

Stringä½œä¸ºä¸€ç§é›†åˆç±»å‹ä¹Ÿæœ‰å’Œå‘é‡`Vec`ç±»ä¼¼çš„æ‹¼æ¥æ“ä½œï¼š

+ ä½¿ç”¨`push`æ–¹æ³•
+ ä½¿ç”¨`+`ï¼šè¿™ç§æ–¹æ³•å¯ä»¥æ˜¯`str`çš„å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›´æ¥str
+ ä½¿ç”¨`format!`æ–¹æ³•ï¼šç±»ä¼¼æ—¶æ®·å¼˜æ¨¡æ¿å­—ç¬¦ä¸²å°†å¤šä¸ªStringè¿›è¡Œæ‹¼æ¥

```rust
pub mod StringDemo {
   pub fn string_update() {
        let mut s = String::from("hello");
        let s2 = String::from(" world\n");

        s += &s2;

        s.push_str(" are you ok?");

        s += " pidan";

        println!("s -> {}", s)
       
        let s4 = "tic";
        let s5 = "tac";
        let s6 = "toe";

        let concat = format!("{}-{}-{}", s4, s5, s6);

        println!("{}", concat);
   }
}
```



#### 10.2.4 å­—ç¬¦ä¸²ç´¢å¼•

åœ¨å¾ˆå¤šå˜æˆè¯­è¨€ä¸­ï¼Œé€šè¿‡ç´¢å¼•æ¥è·å–å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦çœ‹ä¼¼æ˜¯ä¸€ä¸ªå¸¸è§„æ“ä½œï¼Œä½†æ˜¯åœ¨rustä¸­è¿™ä¹ˆåšä¼šæŠ¥é”™ï¼ˆ**rustçš„Stringä¸èƒ½é€šè¿‡ç´¢å¼•è·å–å¯¹ç”¨çš„å­—ç¬¦å€¼**ï¼‰ã€‚

**ä¸èƒ½è¿™ä¹ˆæ“ä½œçš„ç†ç”±æ˜¯**ï¼š

+ ç›®å‰UTF-8ä¸­æœ‰çš„å­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œæ¯”å¦‚ä¸­æ–‡æˆ–è€…ä¿„æ–‡å…¶å®é™…å ç”¨äº†ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ç›´æ¥é€šè¿‡ç´¢å¼•å…¶å®æ˜¯æ‹¿ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦çš„ï¼Œå› ä¸ºéƒ½æ˜¯é€šè¿‡äºŒè¿›åˆ¶å­˜å‚¨çš„ã€‚
+ å’Œç”µè„‘ç³»ç»Ÿå­˜å‚¨çš„å­—ç¬¦ç±»å‹æœ‰å…³ï¼Œåœ¨ä¸åŒå­—ç¬¦é›†å’Œæ ‡é‡ä¸‹è¡¨ç°ä¸åŒ
+ å’ŒRust Stringçš„æ€§èƒ½æœ‰å…³ï¼ŒRustçš„ç´¢å¼•è·å–å…ƒç´ çš„å¤æ‚åº¦å¹¶ä¸æ˜¯O(1)å› ä¸ºå¹¶ä¸çŸ¥é“è¿™ä¸ªé›†åˆæœ‰å¤šå¤§ã€‚



#### 10.2.5 åˆ‡ç‰‡ç±»å‹

ä½¿ç”¨ç´¢å¼•æ˜¯æ— æ³•è·å–åˆ°å¯¹åº”çš„å­—ç¬¦çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ˜¯ç”¨`range`åˆ‡ç‰‡çš„æ–¹å¼æ¥è·å–ç›¸åº”çš„å­—ç¬¦

```rust
pub fn slice_string() {
    let mut s = String::from("Hello world");
    let s2 = &s[1..2];

    println!("s2 -> {}", s2); // e
    println!("s2 -> {}", &s[0..1]); // e

    let firstChar = s.get(0..1);

    if let Some(pat) = firstChar {
        println!("char -> {}", pat);
    }
}
```



#### 10.2.6 å­—ç¬¦ä¸²è¿­ä»£éå†

é€šè¿‡`chars`å’Œ`bytes`å¯ä»¥å¯¹å­—ç¬¦å’Œå­—èŠ‚è¿›è¡Œéå†ï¼Œç»“åˆ`for..in`çš„æ–¹æ³•

```rust
for c in "à¤¨à¤®à¤¸à¥à¤¤à¥‡".chars() {
    println!("{}", c);
}

for b in "à¤¨à¤®à¤¸à¥à¤¤à¥‡".bytes() {
    println!("{}", b);
}
```



#### 10.2.7 å­—ç¬¦ä¸²å¹¶ä¸ç®€å•

æ€»çš„æ¥è¯´Stringæ˜¯éå¸¸å¤æ‚çš„ã€‚åœ¨Rustä¸­é€‰æ‹©åœ¨Rustçš„ç¨‹åºä¸­æ­£ç¡®å¤„ç†Stringæ•°æ®çš„é»˜è®¤è¡Œä¸ºï¼Œæ¯”å¦‚è€ƒè™‘ç›´æ¥å¤„ç†UFT-8çš„æ•°æ®ã€‚è¿™ç§æƒè¡¡å¯¼è‡´ç›¸è¾ƒäºå…¶ä»–è¯­è¨€å¢åŠ äº†Stringçš„å¤æ‚æ€§ã€‚ä½†æ˜¯å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼Œå½“ä½ åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œä½ ä¸ç”¨å»å¤„ç†ä»¥ä¸‹ACSIIå­—ç¬¦çš„å¼‚å¸¸é—®é¢˜ã€‚



### 10.3 é”®å€¼å¯¹å…³è”å­˜å‚¨Hash Map

æœ€åä¸€ç§é€šç”¨çš„é›†åˆç±»å‹ç§°ä¸ºHashMapã€‚HashMapçš„å®šä¹‰ä¸º`HashMap<K, V>`ç”¨æ¥å­˜å‚¨é”®å€¼çš„ç±»å‹`K`å’Œå€¼çš„ç±»å‹`V`ã€‚

é€šè¿‡hashç®—æ³•æ¥å†³å®šå­˜å‚¨åœ¨å†…å­˜ä¸­çš„é”®å€¼æ˜¯ä»€ä¹ˆæ ·å­ã€‚è®¸å¤šç¼–ç¨‹è¯­è¨€æ”¯æŒè¿™ç§ç±»å‹çš„æ•°æ®è§£æ„ï¼Œå¯èƒ½æœ‰ä¸åŒçš„åå­—æ¥æè¿°è¿™ç§ç»“æ„æ¯”å¦‚hashï¼Œmapï¼Œå¯¹è±¡ï¼Œhash è¡¨ã€å­—å…¸ç­‰ã€‚

å½“æˆ‘ä»¬æƒ³è¦é€šè¿‡ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ï¼Œhash mapæ˜¯ä¹‹åˆ†æœ‰ç”¨çš„ï¼Œæœ¬èŠ‚ä¸­æˆ‘ä»¬å°†ä»‹ç»ä¸€äº›åŸºç¡€çš„APIç”¨æ³•ï¼Œä½†æ˜¯æ›´å¤šçš„ç”¨æ³•åœ¨HashMap<K, V>çš„æ ‡å‡†åº“ä¸­å¯ä»¥æŸ¥è¯¢ã€‚



#### 10.3.1 åˆ›å»ºä¸€ä¸ªhashmap

HashMapçš„ä½¿ç”¨æ­¥éª¤ï¼š

+ å¼•å…¥hashmapçš„åŒ…ï¼š`std::collections::HashMap`ï¼Œhashmapä¸åƒVecä¸€æ ·æ˜¯é»˜è®¤å¯¼å…¥çš„éœ€è¦é¢å¤–å¼•å…¥
+ ä½¿ç”¨`new`æ–¹æ³•åˆ›å»º`HashMap`å®ä¾‹
+ åˆ©ç”¨`insert`æ–¹æ³•æ’å…¥å¯¹åº”çš„å€¼

```rust
use std::collections::HashMap;

pub mod hash_learner {
    pub fn create_hash_map {
        let mut scores: HashMap<String, i32> = HashMap::new();

        scores.insert(String::from("tom"), 60);
        scores.insert(String::from("jerry"), 80);
        
        for key in scores.into_iter() {
            let k = key.0;
            let v = key.1;

            println!("k -> {}, v -> {}", k, v);
            // k -> jerry, v -> 80
			// k -> tom, v -> 60
        }
    }
}
```

**æ³¨æ„ç‚¹**ï¼š

1. HashMapæ˜¯å­˜å‚¨åœ¨å †ä¸­çš„
2. HashMapçš„æ‰€æœ‰é”®å¿…é¡»æœ‰ç›¸åŒçš„ç±»å‹
3. HashMapçš„æ‰€æœ‰å€¼å¿…é¡»æœ‰ç›¸åŒçš„ç±»å‹



**åˆ©ç”¨å‘é‡å’Œå…ƒç»„çš„collectæ–¹æ³•æ¥æ„å»ºhash map**

```rust
    pub fn build_with_collect() {
        use std::collections::HashMap;

        let students = vec![String::from("Tom"), String::from("Jerry")];
        let initial_scores = vec![90, 80];

        let score_map: HashMap<_, _> = students
            .into_iter()
            .zip(initial_scores.into_iter())
            .collect();

        for key in score_map.into_iter() {
            let k = key.0;
            let v = key.1;

            println!("k -> {}, v -> {}", k, v);
        }
    }
```

è¿™é‡Œä¸»è¦ç”¨åˆ°äº†è¿­ä»£å™¨çš„ç‰¹æ€§ï¼Œå…·ä½“çš„æ³¨æ„ç‚¹å¦‚ä¸‹ï¼š

+ è¿™é‡Œçš„`HashMap<_, _>`æ˜¯å¿…é¡»çš„ï¼Œå› ä¸º`collect`å¯èƒ½ä¼šäº§ç”Ÿå¤šç§æ•°æ®ç»“æ„ï¼Œrustå¹¶ä¸çŸ¥é“å¯¹åº”çš„å€¼æ˜¯ä»€ä¹ˆæ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å¿…é¡»è®¤ä¸ºå¼ºåˆ¶å‘Šè¯‰ç¼–è¯‘å™¨
+ `zip`æ˜¯è¿­ä»£å™¨çš„ä¸€ç§æ–¹æ³•ï¼Œå°†ä¸¤è¾¹çš„å¯¹åº”ç´¢å¼•çš„å€¼åŒ¹é…èµ·æ¥ã€‚
+ `collect`æ–¹æ³•æ”¶é›†æ•°æ®é€šè¿‡æ•°å­—çš„é›†åˆç±»å‹ï¼ŒåŒ…æ‹¬HashMapã€‚



#### 10.3.2 Hashmapså’Œæ‰€æœ‰è€…

å½“ä¸€ä¸ªå€¼è¢«HashMapæ”¶å½•ä¹‹åï¼Œä»–çš„æ‰€æœ‰è€…å°±å˜æˆäº†HashMapï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±ä¸ç”¨å†å€Ÿç”¨å¯¹åº”çš„å€¼ï¼Œå¦‚æœå€Ÿç”¨äº†å¯¹åº”çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œçœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼š

```rust
pub fn ownership () {
    use std::collections::HashMap;

    let field_name = String::from("Favorite color");
    let field_value = String::from("Blue");

    let mut map = HashMap::new();
    map.insert(field_name, field_value);

    // let item = field_name;
    // è¿™ä¸€è¡Œä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™field_nameå·²ç»è¢«æ”¾å…¥äº†hashmapï¼Œæ‰€ä»¥æ— æ³•å†è¿›è¡Œå‡ºå€Ÿäº†ã€‚
   
}
```

**è§£å†³åŠæ³•**

+ å‡ºå€Ÿç»™hashMapçš„æ—¶å€™ä½¿ç”¨å¼•ç”¨çš„æ–¹å¼è¿›è¡Œå‡ºå€Ÿå³å¯

  ```rust
      pub fn ownership () {
          use std::collections::HashMap;
  
          let field_name = String::from("Favorite color");
          let field_value = String::from("Blue");
      
          let mut map = HashMap::new();
          map.insert(&field_name, field_value);
  
          let item = field_name; // å½“ä½¿ç”¨&field_nameå‡ºå€Ÿçš„æ—¶å€™ï¼Œè¿™é‡Œå°±ä¸ä¼šæŠ¥é”™
      }
  ```

  

#### 10.4.3 æŸ¥è¯¢hashmapä¸­çš„å€¼

ä¸Šé¢çš„å°è¯•ä¸­ï¼Œä½¿ç”¨äº†`.into_iter`æ–¹æ³•ï¼Œè¿›è¡Œéå†ï¼Œè¿™é‡Œå°†ç³»ç»Ÿçš„ä»‹ç»å‡ ä¸ªè·å–hashMapä¸­å€¼çš„æ–¹æ³•ï¼š

+ ä½¿ç”¨`get`æ–¹æ³•è·å–å•ä¸ªå€¼ï¼Œè¿™é‡Œè·å–çš„æ˜¯ä¸€ä¸ª`Option<&K>`
+ ç›´æ¥é€šè¿‡`for...in`è¿›è¡Œéå†ï¼Œè¿™é‡Œè·å–çš„å°±æ˜¯å¯¹åº”çš„å€¼

```rust
pub fn read() {
    use std::collections::HashMap;

    let mut scores = HashMap::new();
    let tom = String::from("tom");
    let jerry = String::from("jerry");

    scores.insert(&tom, 60);
    scores.insert(&jerry, 80);

    let tom_score = scores.get(&tom);
    let jerry_score = scores.get(&jerry);

    println!("tom -> {:?}, jerry -> {:?}", tom_score, jerry_score);

    for (key, value) in &scores {
        println!("key -> {}, value -> {}", key, value);
    }
}
```



#### 10.4.4 æ›´æ–°Hash Map

å°½ç®¡é”®å€¼å¯¹æ˜¯å¯ä»¥ä¸æ–­æ‰©å±•çš„ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªé”®åªèƒ½å…³è”ä¸€ä¸ªå€¼ï¼Œå½“ä½ æ›´æ–°å·²å­˜åœ¨çš„é”®çš„æ—¶å€™ï¼Œä½ éœ€è¦å†³å®šæ€æ ·å»å¤„ç†è¿™ç§åœºæ™¯ï¼Œæ˜¯æ”¾å¼ƒè€çš„å€¼ï¼Œä¿ç•™æ–°çš„ï¼Œè¿˜æ˜¯æ”¾å¼ƒæ–°çš„ä¿å­˜è€çš„ï¼Œè¿˜æ˜¯æ–°è€è”åˆä¸€ä¸‹ã€‚åªæœ‰å½“keyä¸å­˜åœ¨çš„æ—¶å€™ä½ å­˜æ‰ä¼šæ–°åˆ›å»ºä¸€æ¡è®°å½•ã€‚

**è¦†å†™è€çš„å€¼**

å½“æˆ‘ä»¬å¤šæ¬¡ç»™åŒæ ·çš„keyæ’å…¥(`insert`)ä¸åŒçš„å€¼ï¼Œæœ€åä¿ç•™çš„å€¼æ˜¯æœ€åä¸€æ¬¡æ’å…¥çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™è€çš„å€¼å°±ä¼šè¢«è¦†å†™

```rust
pub fn update() {
    use std::collections::HashMap;

    let key = String::from("Tom");
    let mut scores = HashMap::new();

    scores.insert(&key, 50);
    scores.insert(&key, 60);

    println!("overwrite -> {:#?}", scores);
}
```



**å½“é”®ä¸å­˜åœ¨åœºæ™¯æ‰æ’å…¥**

é€šå¸¸åœºæ™¯ï¼Œæˆ‘ä»¬å½“keyä¸å­˜åœ¨çš„æ—¶å€™æ‰æ’å…¥å¯¹åº”çš„å€¼ã€‚å› æ­¤Hash Mapæä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„apiï¼Œ`entry`ã€‚`entry`è¿™ä¸ªAPIä½¿ç”¨åè¿”å›çš„ç±»å‹ä¸º`Entry`ï¼Œå®ƒç”¨äºå‘Šè¯‰ä½¿ç”¨è€…è¿™ä¸ªå€¼æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œä¹‹åè°ƒç”¨`or_insert`æ–¹æ³•æ¥è¿›è¡Œæ’å…¥ï¼Œè¿™ä¸ª`or_insert`æ–¹æ³•æ˜¯`Entry`å®šä¹‰çš„ã€‚

```rust
pub fn update() {
    use std::collections::HashMap;

    let jerry = String::from("jerry");
    let timi = String::from("Timi");
    let mut scores = HashMap::new();


    scores.insert(&jerry, 60);
    scores.entry(&jerry).or_insert(50);
    scores.entry(&timi).or_insert(80);

    println!("overwrite -> {:#?}", scores);
    // jerry 60, timi 90

}
```



**åŸºäºå·²æœ‰å†…å®¹æ›´æ”¹**

è¿˜æœ‰ä¸€ç§åœºæ™¯ç±»ä¼¼jsä¸­çš„`map`ï¼Œå¯¹åŸæ¥çš„hashmapå†…å®¹è¿›è¡Œä¿®æ”¹

```rust
use std::collections::HashMap;

let text = "hello world wonderful world";

let mut map = HashMap::new();

for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count += 1;
}

println!("{:?}", map);
```

è¿™é‡Œçš„countæ˜¯ä¸ª`&mut i32`çš„ç±»å‹ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨`*`è¿ç®—ç¬¦æ¥æ”¹å˜å¼•ç”¨çš„å€¼ã€‚





**Hash å‡½æ•°**

é»˜è®¤çš„hashç”Ÿæˆç®—æ³•æ˜¯`SipHash `æ–¹æ³•ï¼Œå…¶å¯ä»¥é˜²æ­¢DoSæ”»å‡»ã€‚è¿™ç§ç®—æ³•ä¸æ˜¯æœ€å¿«çš„ä½†æ˜¯æœ€å¥½çš„æƒè¡¡äº†å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚



### æ€»ç»“

å‘é‡ã€å­—ç¬¦ä¸²å’Œå“ˆå¸Œè¡¨ï¼Œæä¾›äº†ç¨‹åºä¸­å¤§é‡å¿…è¦çš„åŠŸèƒ½ï¼Œå½“ä½ å­˜å‚¨ã€æ¥å…¥å’Œä¿®æ”¹æ•°æ®çš„æ—¶å€™ã€‚è¿™é‡Œä¹Ÿæœ‰ä¸€äº›ä½ éœ€è¦çŸ¥é“çš„ç»éªŒä¹‹è°ˆï¼š

+ åœ¨å¤§é‡æ•´æ•°åˆ—è¡¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨å‘é‡å’Œè¿”å›ä¸­ä½æ•°ï¼ˆæ’åºå–ä¸­é—´æ•°ï¼‰å’Œåˆ—è¡¨çš„ä¼—æ•°ï¼ˆç»å¸¸å‡ºç°çš„æ•°ï¼Œè¿™ç§ç”¨äº†hashè¡¨ä¹Ÿå¯èƒ½æœ‰ç”¨ï¼‰ã€‚
+ å°†stringè½¬å˜ä¸ºé¢ å€’çš„å­—ç¬¦ã€‚éœ€è¦æ—¶åˆ»å…³æ³¨UTF-çš„ç¼–ç è§„èŒƒï¼Œåœ¨å­—ç¬¦ä¸²æ’åºçš„æ—¶å€™ã€‚
+ ä½¿ç”¨å‘é‡å’Œå“ˆå¸Œè¡¨çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªæ¥å£å…è®¸ç”¨æˆ·å¢åŠ ç”¨æˆ·ååœ¨å…¬å¸ä¸­ã€‚

æ ‡å‡†çš„åº“çš„APIçš„ä½¿ç”¨è¿˜éœ€è¦æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£çš„æ–‡æ¡£ï¼Œæ¥ä¸‹æ¥ä¸€èŠ‚å°†è®¨è®ºé”™è¯¯å¤„ç†æœºåˆ¶ã€‚